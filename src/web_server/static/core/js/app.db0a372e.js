(function(t){function e(e){for(var i,n,r=e[0],l=e[1],c=e[2],u=0,h=[];u<r.length;u++)n=r[u],Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&h.push(o[n][0]),o[n]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);d&&d(e);while(h.length)h.shift()();return a.push.apply(a,c||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],i=!0,r=1;r<s.length;r++){var l=s[r];0!==o[l]&&(i=!1)}i&&(a.splice(e--,1),t=n(n.s=s[0]))}return t}var i={},o={app:0},a=[];function n(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=i,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/static/core/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;a.push(["56d7","chunk-vendors"]),s()})({"00aa":function(t,e,s){},"1cab":function(t,e,s){},"3ba4":function(t,e,s){"use strict";var i=s("4320"),o=s.n(i);o.a},4320:function(t,e,s){},"46ab":function(t,e,s){"use strict";var i=s("bd33"),o=s.n(i);o.a},"56d7":function(t,e,s){"use strict";s.r(e);var i=s("2b0e"),o=s("5f5b"),a=s("2ee4"),n=s.n(a),r=s("2ead"),l=s.n(r),c=s("4a7a"),d=s.n(c),u=s("ad3d"),h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{ref:"button",staticClass:"btn text-info p-0",attrs:{type:"button",title:t.title},on:{click:t.handleBtnClick}},[s("fa-icon",{attrs:{icon:"plus",size:t.size}})],1)},p=[],m={methods:{handleBtnClick(){this.$refs["button"].blur(),this.$emit("click")}},props:{size:{type:String,default:"lg"},title:String}},v=m,_=s("2877"),f=Object(_["a"])(v,h,p,!1,null,null,null),g=f.exports,b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{ref:"button",staticClass:"btn text-danger p-0",attrs:{type:"button",title:t.title},on:{click:t.handleBtnClick}},[s("fa-icon",{attrs:{icon:"trash-alt",size:t.size}})],1)},y=[],C={methods:{handleBtnClick(){this.$refs["button"].blur(),this.$emit("click")}},props:{size:{type:String,default:"lg"},title:String}},w=C,x=Object(_["a"])(w,b,y,!1,null,null,null),k=x.exports,$=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"btn-info-popup"},[s("a",{staticClass:"btn btn-block text-info py-0",on:{click:function(e){t.$refs["info_"+t.uuid].show()}}},[s("fa-icon",{attrs:{icon:["far","question-circle"],size:"lg"}})],1),s("b-modal",{ref:"info_"+t.uuid,staticClass:"text-center",attrs:{id:"info_"+t.uuid,title:t.popup_title,size:t.popup_size,scrollable:"","hide-footer":"","return-focus":t.$root.$children[0].$el}},[t._t("default")],2)],1)},S=[];let I=0;var j={beforeCreate(){this.uuid=I.toString(),I++},props:{popup_size:{type:String,default:"xl"},popup_title:String}},A=j,R=(s("46ab"),Object(_["a"])(A,$,S,!1,null,null,null)),P=R.exports,M=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("select",t._g(t._b({staticClass:"form-control form-control-sm",domProps:{value:t.value}},"select",t.$attrs,!1),t.inputListeners),[t._t("default")],2)},E=[],L={inheritAttrs:!1,props:["value"],computed:{inputListeners:function(){return Object.assign({},this.$listeners,{input:t=>{t.target.blur(),this.$emit("input",t.target.value)}})}}},T=L,O=Object(_["a"])(T,M,E,!1,null,null,null),N=O.exports,D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"d-flex justify-content-center"},[s("div",{staticClass:"spinner-border text-info",class:t.small?"small-spinner":"big-spinner",attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])])])},F=[],z={props:{small:!1}},G=z,V=(s("a989"),Object(_["a"])(G,D,F,!1,null,null,null)),B=V.exports,U=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("fa-icon",{staticClass:"handle",attrs:{icon:"grip-horizontal"}})},q=[],H=(s("701f"),{}),J=Object(_["a"])(H,U,q,!1,null,null,null),Y=J.exports,W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.until?s("span",[t._v(t._s(t._f("duration")(t.momentDuration,"humanize"))+" ("+t._s(t.exactDuration)+")")]):s("span",[t._v(t._s(t._f("duration")(t.momentDuration,"humanize",!0)))])},Q=[],X={props:{from:Date,until:Date},data(){return{now:new Date}},computed:{momentDuration(){return this.until?this.$moment.duration(this.until.getTime()).subtract(this.from.getTime()):this.$moment.duration(this.now.getTime()).subtract(this.from.getTime())},exactDuration(){const t=this.momentDuration.hours(),e=this.momentDuration.minutes(),s=this.momentDuration.seconds(),i=String(t).padStart(2,"0"),o=String(e).padStart(2,"0"),a=String(s).padStart(2,"0");return t>0?`${i}:${o}:${a}`:e>0?`00:${o}:${a}`:`00:00:${a}`}},methods:{updateNow(){this.now=new Date}},created(){setInterval(this.updateNow,1e3)},destroyed(){clearInterval(this.updateNow)}},Z=X,K=Object(_["a"])(Z,W,Q,!1,null,null,null),tt=K.exports,et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row align-items-center"},[t.resourceInfo?[s("div",{staticClass:"col-auto p-0"},[s("div",{staticClass:"property-resource read-only",class:{"btn-sm":t.small}},[t._v("\n        "+t._s(t.dataset.title)+"\n      ")])]),s("div",{staticClass:"col-auto p-0"},[s("div",{staticClass:"property-resource read-only mx-2",class:{"btn-sm":t.small}},[t._v("\n        "+t._s(t.resource.dataset.collection_id)+"\n      ")])]),t.singular||t.readOnly?t._e():s("div",{staticClass:"col-auto pl-0 ml-0 my-1"},[s("button-add",{attrs:{size:"sm",title:"Add another property"},on:{click:function(e){return t.$emit("clone")}}}),t.allowDelete?s("button-delete",{staticClass:"ml-2",attrs:{size:"sm",title:"Remove this property"},on:{click:function(e){return t.$emit("delete")}}}):t._e()],1)]:t._e(),t._l(t.props,(function(e){return[!Array.isArray(e.resources)&&e.inPath?s("div",{staticClass:"col-auto"},[s("fa-icon",{attrs:{icon:"arrow-right"}})],1):t._e(),""!==e.value[0]||t.readOnly?!Array.isArray(e.resources)&&e.inPath?[t.readOnly?s("div",{staticClass:"col-auto p-0"},[s("div",{staticClass:"property-path read-only",class:{"btn-sm":t.small}},[t._v("\n          "+t._s(e.value[0])+"\n        ")])]):s("div",{staticClass:"col-auto p-0"},[s("button",{staticClass:"property-path",class:{"btn-sm":t.small},attrs:{type:"button"},on:{click:function(s){return t.$emit("resetProperty",e.idx)}}},[t._v("\n          "+t._s(e.value[0])+"\n        ")])])]:t._e():s("div",{staticClass:"col-auto p-0 my-1",attrs:{value:e.value[0]}},[s("v-select",{class:{"is-invalid":t.errors.includes("value_"+e.idx)},attrs:{clearable:!1,autocomplete:"off",placeholder:"Choose a referenced collection",options:["__value__"].concat(Object.keys(e.resources).sort())},on:{input:function(s){return t.updateProperty(s,e.idx)}},scopedSlots:t._u([{key:"option",fn:function(i){return s("div",{},["__value__"===i.label?s("div",[s("span",{staticClass:"text-success pr-2"},[t._v("Value")]),s("span",{staticClass:"font-italic text-muted small"},[t._v("Do not follow reference")])]):[s("div",[s("span",{staticClass:"pr-2"},[t._v(t._s(i.label))]),s("span",{staticClass:"font-italic text-muted small"},[t._v(t._s(e.resources[i.label].total))])]),s("div",{staticClass:"small pt-1"},[s("download-progress",{attrs:{"dataset-id":t.resource.dataset.dataset_id,"collection-id":i.label}})],1)]],2)}}],null,!0)})],1),""!==e.value[0]&&"__value__"!==e.value[0]?[Array.isArray(e.resources)?t._e():s("div",{staticClass:"col-auto"},[s("fa-icon",{attrs:{icon:"arrow-right"}})],1),e.value[1]||t.readOnly?t.readOnly?s("div",{staticClass:"col-auto p-0"},[s("div",{staticClass:"property-path read-only",class:{"btn-sm":t.small}},[t._v("\n          "+t._s(e.value[1])+"\n        ")])]):s("div",{staticClass:"col-auto p-0"},[s("button",{staticClass:"property-path",class:{"btn-sm":t.small},attrs:{type:"button"},on:{click:function(s){return t.$emit("resetProperty",e.idx+1)}}},[t._v("\n          "+t._s(e.value[1])+"\n        ")])]):s("div",{staticClass:"col-auto p-0 my-1"},[s("v-select",{class:{"is-invalid":t.errors.includes("value_"+e.idx)},attrs:{clearable:!1,autocomplete:"off",placeholder:"Choose a property",options:Object.keys(e.properties).sort()},on:{input:function(s){return t.updateProperty(s,e.idx+1)}},scopedSlots:t._u([{key:"option",fn:function(i){return s("div",{},[s("div",[t._v(t._s(i.label))]),s("div",{staticClass:"clearfix"},[s("ul",{staticClass:"small font-italic text-info inline-list px-0 pt-1"},[s("li",[t._v("Density: "+t._s(e.properties[i.label].density)+"%")]),e.properties[i.label].isValueType?s("li",[t._v("Has values")]):t._e(),e.properties[i.label].isLink?s("li",[t._v("Has links to another collection")]):t._e()])])])}}],null,!0)})],1)]:t._e()]}))],2)},st=[],it={data(){return{errors:[]}},methods:{validateField(t,e){return e?this.removeError(t):this.addError(t),!!e},addError(t){this.errors.includes(t)||this.errors.push(t)},removeError(t){const e=this.errors.indexOf(t);e>=0&&this.errors.splice(e,1)}}},ot={name:"Property",mixins:[it],props:{property:Array,readOnly:{type:Boolean,default:!1},small:{type:Boolean,default:!1},singular:{type:Boolean,default:!1},allowDelete:{type:Boolean,default:!0},resourceInfo:{type:Boolean,default:!0}},computed:{resource(){return this.$root.getResourceById(this.property[0])},dataset(){const t=this.$root.getDatasets(this.resource.dataset.timbuctoo_graphql,this.resource.dataset.timbuctoo_hsid);return t[this.resource.dataset.dataset_id]},props(){return new Array(Math.floor(this.property.length/2)).fill(null).map((t,e)=>{const s=2*e;return{idx:s,value:this.property.slice(s,s+2),resources:this.getResourcesForIndex(s),properties:this.getPropertiesForIndex(s),inPath:this.readOnly||"__value__"!==this.property[s]}})}},methods:{validateProperty(){return this.errors=[],!this.props.map(t=>{const e="__value__"===t.value[0]||void 0===t.value.find(t=>""===t);return this.validateField(`value_${t.idx}`,e)}).includes(!1)},getReferencedCollections(t){const e={};return t.forEach(t=>e[t]=this.dataset.collections[t]),e},getPropertiesForCollection(t){return this.dataset.collections.hasOwnProperty(t)?this.dataset.collections[t].properties:{}},getResourcesForIndex(t){if(0===t)return this.$root.resources;const e=t>2?this.property[t-2]:this.resource.dataset.collection_id,s=this.getPropertiesForCollection(e)[this.property[t-1]];return this.getReferencedCollections(s.referencedCollections)},getPropertiesForIndex(t){const e=0===t?this.resource.dataset.collection_id:this.property[t];return this.getPropertiesForCollection(e)},updateProperty(t,e){this.$set(this.property,e,t);const s=this.property.length>2?this.property.slice(-2)[0]:this.resource.dataset.collection_id,i=this.property.slice(-1)[0],o=i?this.getPropertiesForCollection(s)[i]:null;o&&o.referencedCollections.length>0&&this.property.push("","")}}},at=ot,nt=Object(_["a"])(at,et,st,!1,null,null,null),rt=nt.exports,lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.downloadedInfo?s("span",{staticClass:"text-success"},[t._v("Downloaded")]):t.downloadingInfo?s("span",{staticClass:"text-info font-italic"},[t._v("\n  Downloading "+t._s(t.downloadingInfo.rows_count)+"/"+t._s(t.downloadingInfo.total)+"\n")]):s("span",{staticClass:"text-danger"},[t._v("Not yet downloaded")])},ct=[],dt={name:"DownloadProgress",props:{datasetId:String,collectionId:String},computed:{downloadedInfo(){return this.$root.downloaded.find(t=>t.dataset_id===this.datasetId&&t.collection_id===this.collectionId)},downloadingInfo(){return this.$root.downloading.find(t=>t.dataset_id===this.datasetId&&t.collection_id===this.collectionId)}}},ut=dt,ht=Object(_["a"])(ut,lt,ct,!1,null,null,null),pt=ht.exports,mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main-card",class:{"is-invalid":t.hasError}},[t.hasHandle?s("handle"):t._e(),s("div",{staticClass:"sticky-top bg-light py-2"},[s("div",{staticClass:"row flex-nowrap align-items-center justify-content-start"},[s("div",{staticClass:"col-auto"},[s("fa-icon",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],attrs:{icon:"chevron-down",size:"2x"}})],1),s("div",{staticClass:"flex-shrink-1 mr-auto",class:[t.isEditing?"col":"col-auto"]},[t.isEditing?s("input",{ref:"editInput",staticClass:"form-control border-0 card-title-input",attrs:{type:"text",required:""},domProps:{value:t.value},on:{blur:function(e){t.editing=!1},input:function(e){return t.$emit("input",e.target.value)}}}):t.label?s("div",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],staticClass:"h2"},[t._v(t._s(t.label))]):s("div",{staticClass:"row",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[s("div",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],staticClass:"h2 col"},[t._v(t._s(t.value))]),s("button",{staticClass:"btn col-auto p-0",class:{invisible:!t.hovering},attrs:{type:"button",title:"Click to Edit"},on:{click:function(e){t.editing=!0}}},[s("fa-icon",{attrs:{icon:"pencil-alt",size:"lg"}})],1)])]),t._t("title-columns")],2),t.hasExtraRow?s("div",{staticClass:"row flex-nowrap align-items-center justify-content-between mt-4"},[t._t("columns")],2):t._e()]),s("b-collapse",{ref:t.id,attrs:{id:t.id,accordion:t.type+"-accordion",visible:t.openCard},on:{show:function(e){return t.$emit("show")},hide:function(e){return t.$emit("hide")},input:function(e){return t.withInput(e)}}},[t._t("default")],2)],1)},vt=[],_t={name:"Card",props:{id:String,type:String,label:String,value:String,openCard:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},hasExtraRow:{type:Boolean,default:!1},hasHandle:{type:Boolean,default:!1}},data(){return{editing:!1,hovering:!1,visible:!1}},computed:{isEditing(){return!this.label&&(this.editing||""===this.value)}},methods:{withInput(t){this.visible=t,t?this.$emit("show"):this.$emit("hide")}},updated(){this.editing&&this.$refs.editInput.focus()}},ft=_t,gt=Object(_["a"])(ft,mt,vt,!1,null,null,null),bt=gt.exports,yt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sub-card",class:{"mt-4":!t.isFirst,"is-invalid":t.hasError}},[t.hasColumns||t.hasCollapse||t.label||t.hasInfo||t.addButton?s("div",{staticClass:"row align-items-center justify-content-between"},[t.hasCollapse?s("div",{staticClass:"col-auto"},[s("fa-icon",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],attrs:{icon:"chevron-down",size:"lg"}})],1):t._e(),t.label?s("div",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.hasCollapse?t.id:{},expression:"hasCollapse ? id : {}"}],staticClass:"col-auto pr-0",class:{"mr-auto":!t.hasInfo&&!t.addButton&&!t.hasMarginAuto}},[s("h3",[t._v(t._s(t.label))])]):t._e(),t.hasInfo?s("div",{staticClass:"col-auto pl-0",class:{"mr-auto":!t.addButton&&!t.hasMarginAuto}},[t._t("info")],2):t._e(),t._t("columns"),t.addButton?s("div",{staticClass:"col-auto ml-auto"},[s("button-add",{attrs:{title:t.addButton},on:{click:function(e){return t.$emit("add")}}})],1):t._e()],2):t._e(),t.hasExtraRow?s("div",{staticClass:"row flex-nowrap align-items-center justify-content-between mt-4"},[t._t("row-columns")],2):t._e(),t.hasCollapse?s("b-collapse",{ref:t.id,attrs:{id:t.id,accordion:t.type+"-accordion",visible:t.openCard},on:{show:function(e){return t.$emit("show")},hide:function(e){return t.$emit("hide")}}},[t._t("default")],2):t._t("default")],2)},Ct=[],wt={name:"SubCard",props:{id:String,type:String,label:String,addButton:String,openCard:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},hasCollapse:{type:Boolean,default:!1},hasInfo:{type:Boolean,default:!1},hasMarginAuto:{type:Boolean,default:!1},hasColumns:{type:Boolean,default:!1},hasExtraRow:{type:Boolean,default:!1},isFirst:{type:Boolean,default:!1}}},xt=wt,kt=Object(_["a"])(xt,yt,Ct,!1,null,null,null),$t=kt.exports,St=s("ecee"),It=s("b702"),jt=s("c074"),At=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",attrs:{id:"app"}},[s("form-wizard",{ref:"formWizard",attrs:{title:"Lenticular Lenses II",subtitle:"Reconcile data for Golden Agents",color:"#efc501",shape:"square"},scopedSlots:t._u([{key:"next",fn:function(e){return 0===e.activeTabIndex&&!t.jobId||[1,2].includes(e.activeTabIndex)?[0!==e.activeTabIndex||t.jobId?t._e():[s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading||"existing"===t.researchForm},nativeOn:{click:function(e){e.preventDefault(),e.stopPropagation(),t.researchForm="existing"}}},[t._v("\n          Existing research\n        ")]),t._v("\n         \n        "),t.hasChanges?s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading||"new"===t.researchForm},nativeOn:{click:function(e){e.preventDefault(),e.stopPropagation(),t.researchForm="new"}}},[t._v("\n          New research\n        ")]):t._e()],[1,2,3].includes(e.activeTabIndex)?[t.hasChanges&&[1,2].includes(e.activeTabIndex)?s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading},nativeOn:{click:function(s){return s.stopPropagation(),t.validateAndSave(e.activeTabIndex)}}},[t._v("\n          Save\n        ")]):t._e(),s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading}},[t._v("\n          Save and next\n        ")])]:t._e()]:void 0}},{key:"finish",fn:function(e){return[t._v("​")]}}],null,!0)},[s("tab-content",{attrs:{title:"Research","before-change":t.validateResearchTab}},[s("tab-content-structure",{attrs:{title:"Research","tab-error":t.tabError,"is-saved":t.isSaved},scopedSlots:t._u([{key:"header",fn:function(){return[t.$root.job?s("div",{staticClass:"col-auto"},[s("span",{staticClass:"badge badge-info"},[t._v("\n              Created "+t._s(t._f("moment")(t.$root.job.created_at,"MMMM Do YYYY, hh:mm:ss"))+"\n            ")])]):t._e()]},proxy:!0}])},[s("research",{attrs:{"job-id":t.jobId,"job-title":t.jobTitle,"job-description":t.jobDescription,"job-link":t.jobLink,"research-form":t.researchForm,"is-updating":t.isUpdating},on:{load:function(e){return t.setJobId(e)},create:function(e){return t.createJob(e)},update:function(e){return t.updateJob(e)}}})],1)],1),s("tab-content",{attrs:{title:"Collections","before-change":t.validateCollectionsTab}},[s("tab-content-structure",{attrs:{title:"Collections","tab-error":t.tabError,"is-saved":t.isSaved},scopedSlots:t._u([{key:"header",fn:function(){return[s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add a Collection",size:"2x"},on:{click:t.addResource}})],1)]},proxy:!0}])},[s("draggable",{attrs:{group:"resources",handle:".handle"},model:{value:t.$root.resources,callback:function(e){t.$set(t.$root,"resources",e)},expression:"$root.resources"}},t._l(t.$root.resources,(function(e,i){return s("resource",{key:e.id,ref:"resourceComponents",refInFor:!0,attrs:{resource:e},on:{duplicate:function(e){return t.duplicateResource(e)},remove:function(e){return t.$root.resources.splice(i,1)}}})})),1)],1)],1),s("tab-content",{attrs:{title:"Alignments","before-change":t.validateAlignmentsTab}},[s("tab-content-structure",{attrs:{title:"Alignments","tab-error":t.tabError,"is-saved":t.isSaved},scopedSlots:t._u([{key:"header",fn:function(){return[s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add an Alignment",size:"2x"},on:{click:t.addMatch}})],1)]},proxy:!0}])},[s("draggable",{attrs:{group:"matches",handle:".handle"},model:{value:t.$root.matches,callback:function(e){t.$set(t.$root,"matches",e)},expression:"$root.matches"}},t._l(t.$root.matches,(function(e,i){return s("match",{key:e.id,ref:"matchComponents",refInFor:!0,attrs:{match:e},on:{duplicate:function(e){return t.duplicateMatch(e)},submit:t.submit,remove:function(e){return t.$root.matches.splice(i,1)},"update:label":function(t){e.label=t},refresh:function(e){return t.refresh(!0)},refreshDownloadsInProgress:function(e){return t.refreshDownloadsInProgress(!0)}}})})),1)],1)],1),s("tab-content",{attrs:{title:"Validation"}},[s("tab-content-structure",{attrs:{title:"Validation","tab-error":t.tabError,"is-saved":t.isSaved}},t._l(t.matchesWithResults,(function(t){return s("match-validation",{key:t.id,attrs:{match:t}})})),1)],1),s("tab-content",{attrs:{title:"Export"}},[s("tab-content-structure",{attrs:{title:"Export","tab-error":t.tabError,"is-saved":t.isSaved}})],1)],1)],1)},Rt=[],Pt=s("310e"),Mt=s.n(Pt),Et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",["new"===t.researchForm||t.jobId?s("div",{staticClass:"border p-4 mt-4 bg-light"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"h3",attrs:{for:"research"}},[t._v("Research Question")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("title")},attrs:{type:"text",id:"research",disabled:t.isUpdating},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),s("small",{staticClass:"form-text text-muted mt-2"},[t._v("\n        Write here your main research question\n      ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("title"),expression:"errors.includes('title')"}],staticClass:"invalid-feedback"},[t._v("\n        Please indicate your research question\n      ")])]),s("div",{staticClass:"form-group"},[s("label",{staticClass:"h3",attrs:{for:"description"}},[t._v("Hypothesis")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("description")},attrs:{id:"description",disabled:t.isUpdating},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}}),s("small",{staticClass:"form-text text-muted mt-2"},[t._v("\n        Describe here your expectations and possibly your sub-research questions\n      ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("description"),expression:"errors.includes('description')"}],staticClass:"invalid-feedback"},[t._v("\n        Please indicate what your research is about\n      ")])]),s("div",{staticClass:"form-group"},[s("label",{staticClass:"h3",attrs:{for:"link"}},[t._v("Link")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.link,expression:"link"}],staticClass:"form-control",attrs:{type:"text",id:"link",disabled:t.isUpdating},domProps:{value:t.link},on:{input:function(e){e.target.composing||(t.link=e.target.value)}}}),s("small",{staticClass:"form-text text-muted mt-2"},[t._v("\n        Provide a link to the paper if this work gets published\n      ")])]),s("div",{staticClass:"form-group row justify-content-end align-items-center pt-3 mb-0"},[t.$root.job?s("div",{staticClass:"col-auto"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.$root.job.created_at!==t.$root.job.updated_at,expression:"$root.job.created_at !== $root.job.updated_at"}],staticClass:"badge badge-info"},[t._v("\n          Updated "+t._s(t._f("moment")(t.$root.job.updated_at,"MMMM Do YYYY, hh:mm:ss"))+"\n        ")])]):t._e(),s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:t.saveResearch}},[t._v("\n          "+t._s(t.jobId?"Update":"Create")+"\n        ")])],1)])]):t._e(),"existing"===t.researchForm||t.jobId?s("div",{staticClass:"bg-light border mt-4 p-4"},[s("div",{staticClass:"row justify-content-end align-items-center"},[s("span",{ref:"clipboardCopyMessage",staticClass:"badge badge-info",attrs:{hidden:""}},[t._v("\n        Job ID copied to clipboard\n      ")]),t.jobId?[s("label",{staticClass:"h3 col-auto",attrs:{for:"jobIdCopy"}},[t._v("Job ID")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.jobId,expression:"jobId"}],ref:"jobIdCopy",staticClass:"form-control col-md-3 col-auto",attrs:{type:"text",id:"jobIdCopy",disabled:""},domProps:{value:t.jobId},on:{input:function(e){e.target.composing||(t.jobId=e.target.value)}}}),s("div",{staticClass:"col-auto"},[s("button",{staticClass:"btn btn-secondary",on:{click:function(e){return t.copyToClipboard()}}},[s("fa-icon",{attrs:{icon:"copy"}})],1)])]:[s("label",{staticClass:"h3 col-auto",attrs:{for:"id_to_load"}},[t._v("Existing Job ID")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.idToLoad,expression:"idToLoad"}],staticClass:"col-md-3 col-auto",attrs:{type:"text",id:"id_to_load"},domProps:{value:t.idToLoad},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$emit("load",t.idToLoad)},input:function(e){e.target.composing||(t.idToLoad=e.target.value)}}}),s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.$emit("load",t.idToLoad)}}},[t._v("Load")])],1)]],2)]):t._e()])},Lt=[],Tt={name:"Research",mixins:[it],data(){return{idToLoad:"",title:"",description:"",link:""}},props:{jobId:String,jobTitle:String,jobDescription:String,jobLink:String,researchForm:String,isUpdating:Boolean},methods:{validateResearch(){const t=this.validateField("title",this.title),e=this.validateField("description",this.description);return t&&e},saveResearch(){if(this.validateResearch()){const t=this.jobId?"update":"create";this.$emit(t,{job_id:this.jobId||void 0,job_title:this.title,job_description:this.description,job_link:this.link})}},copyToClipboard(){const t=this.$refs.jobIdCopy,e=t.hasAttribute("disabled");e&&t.removeAttribute("disabled");const s=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.getSelection().removeAllRanges(),s&&document.getSelection().addRange(s),e&&t.setAttribute("disabled","disabled"),this.$refs.clipboardCopyMessage.removeAttribute("hidden"),setTimeout(()=>this.$refs.clipboardCopyMessage.setAttribute("hidden","hidden"),2e3)}},watch:{jobTitle(){this.jobTitle&&(this.title=this.jobTitle)},jobDescription(){this.jobDescription&&(this.description=this.jobDescription)},jobLink(){this.jobLink&&(this.link=this.jobLink)}}},Ot=Tt,Nt=Object(_["a"])(Ot,Et,Lt,!1,null,null,null),Dt=Nt.exports,Ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("card",{attrs:{id:"resource_"+t.resource.id,type:"resources","has-error":t.errors.length>0,"has-handle":!0},scopedSlots:t._u([{key:"title-columns",fn:function(){return[s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.$emit("duplicate",t.resource)}}},[t._v("Duplicate")])],1),t.isUsedInAlignmentResults?t._e():s("div",{staticClass:"col-auto"},[s("button-delete",{attrs:{title:"Delete Collection"},on:{click:function(e){return t.$emit("remove")}}})],1)]},proxy:!0}]),model:{value:t.resource.label,callback:function(e){t.$set(t.resource,"label",e)},expression:"resource.label"}},[s("sub-card",{attrs:{label:"Description"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.resource.description,expression:"resource.description"}],staticClass:"form-control mt-3",attrs:{type:"text",id:"description_"+t.resource.id},domProps:{value:t.resource.description},on:{input:function(e){e.target.composing||t.$set(t.resource,"description",e.target.value)}}}),s("small",{staticClass:"form-text text-muted mt-2"},[t._v("\n      Provide a description for this collection\n    ")])]),s("fieldset",{attrs:{disabled:t.isUsedInAlignmentResults}},[s("sub-card",{attrs:{label:"Dataset",hasError:t.errors.includes("dataset")||t.errors.includes("collection")}},[s("div",{staticClass:"row form-group align-items-end mt-3"},[s("label",{staticClass:"col-auto",attrs:{for:"timbuctoo_"+t.resource.id}},[t._v("\n          Timbuctoo GraphQL endpoint:\n        ")]),s("div",{staticClass:"col-5"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.resource.dataset.timbuctoo_graphql,expression:"resource.dataset.timbuctoo_graphql"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("graphql_endpoint")},attrs:{type:"text",id:"timbuctoo_"+t.resource.id},domProps:{value:t.resource.dataset.timbuctoo_graphql},on:{input:[function(e){e.target.composing||t.$set(t.resource.dataset,"timbuctoo_graphql",e.target.value)},t.resetDatasets]}})]),t.resource.dataset.timbuctoo_hsid&&t.datasetsLoaded?t._e():s("div",{staticClass:"col-4"},[t.datasetsLoaded?t._e():s("button",{staticClass:"btn btn-primary",on:{click:t.loadDatasets}},[t._v("Load datasets")]),t.resource.dataset.timbuctoo_hsid?t._e():s("form",{staticClass:"d-inline-block",attrs:{id:"login_"+t.resource.id,method:"post",action:"https://secure.huygens.knaw.nl/saml2/login",target:"loginWindow"}},[s("input",{attrs:{type:"hidden",name:"hsurl"},domProps:{value:t.hsurl()}}),s("button",{staticClass:"btn btn-primary",class:{"ml-2":!t.datasetsLoaded},on:{click:t.login}},[t._v("\n              "+t._s(t.datasetsLoaded?"Login and reload datasets":"Login and load datasets")+"\n            ")])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("graphql_endpoint"),expression:"errors.includes('graphql_endpoint')"}],staticClass:"invalid-feedback"},[t._v("\n          Please provide a valid Timbuctoo GraphQL endpoint\n        ")])]),t.datasetsLoaded?s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-8"},[s("label",{attrs:{for:"dataset_"+t.resource.id}},[t._v("Dataset")]),s("v-select",{class:{"is-invalid":t.errors.includes("dataset")},attrs:{id:"dataset_"+t.resource.id,value:t.selectedDataset,label:"title",options:t.datasetsList,clearable:!1,disabled:t.isUsedInAlignmentResults,autocomplete:"off",placeholder:"Type to search for a dataset"},on:{input:t.updateDataset},scopedSlots:t._u([{key:"option",fn:function(e){return s("div",{},[s("div",[s("span",{staticClass:"font-weight-bold pr-2"},[t._v(t._s(e.title))]),s("span",{staticClass:"text-wrap text-muted small"},[t._v(t._s(e.name))])]),e.description?s("div",{staticClass:"text-wrap font-italic small pt-2"},[t._v("\n                "+t._s(e.description)+"\n              ")]):t._e()])}}],null,!1,3840245355)}),t.selectedDataset?s("small",{staticClass:"form-text text-muted mt-2"},[t._v("\n            "+t._s(t.selectedDataset.description)+"\n          ")]):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("dataset"),expression:"errors.includes('dataset')"}],staticClass:"invalid-feedback"},[t._v("\n            Please select a dataset\n          ")])],1),""!==t.resource.dataset.dataset_id?s("div",{staticClass:"form-group collection-input col-4"},[s("label",{attrs:{for:"collection_"+t.resource.id}},[t._v("Entity type")]),s("v-select",{class:{"is-invalid":t.errors.includes("collection")},attrs:{id:"collection_"+t.resource.id,value:t.selectedCollection,label:"id",options:t.collectionsList,clearable:!1,disabled:t.isUsedInAlignmentResults,autocomplete:"off",placeholder:"Type to search for an entity type"},on:{input:t.updateCollection},scopedSlots:t._u([{key:"option",fn:function(e){return s("div",{},[s("div",[s("span",{staticClass:"pr-2"},[t._v(t._s(e.id))]),s("span",{staticClass:"font-italic text-muted small"},[t._v(t._s(e.total))])]),s("div",{staticClass:"small pt-1"},[s("download-progress",{attrs:{"dataset-id":t.resource.dataset.dataset_id,"collection-id":e.id}})],1)])}}],null,!1,4143298126)}),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("collection"),expression:"errors.includes('collection')"}],staticClass:"invalid-feedback"},[t._v("\n            Please select an entity type\n          ")])],1):t._e()]):t._e()]),""!==t.resource.dataset.collection_id?s("sub-card",{attrs:{label:"Filter",hasError:t.errors.includes("filters")}},[s("conditions-group",{ref:"filterGroupComponent",attrs:{"conditions-group":t.resource.filter,"is-root":!0,group:"resource-filters",uid:"resource_"+t.resource.id+"_filter_group_0","validate-method-name":"validateFilterCondition"},on:{add:function(e){return t.addFilterCondition(e)}},scopedSlots:t._u([{key:"default",fn:function(e){return[s("resource-filter-condition",{ref:"filterConditionComponents",attrs:{condition:e.condition,index:e.index,resource:t.resource},on:{add:function(t){return e.add()},remove:function(t){return e.remove()}}})]}}],null,!1,569695416)})],1):t._e(),""!==t.resource.dataset.collection_id?s("sub-card",{attrs:{label:"Sample",hasError:t.errors.includes("limit")}},[s("div",{staticClass:"form-group row align-items-end mt-3"},[s("label",{staticClass:"col-auto",attrs:{for:"resource_"+t.resource.id+"_limit"}},[t._v("\n          Only use a sample of this amount of records (-1 is no limit):\n        ")]),s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.resource.limit,expression:"resource.limit",modifiers:{number:!0}}],staticClass:"form-control col-1",class:{"is-invalid":t.errors.includes("limit")},attrs:{type:"number",min:"-1",id:"resource_"+t.resource.id+"_limit"},domProps:{value:t.resource.limit},on:{input:function(e){e.target.composing||t.$set(t.resource,"limit",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("limit"),expression:"errors.includes('limit')"}],staticClass:"invalid-feedback"},[t._v("\n          Please provide a limit, or -1 if there is no limit\n        ")])]),s("div",{staticClass:"form-check"},[s("input",{directives:[{name:"model",rawName:"v-model.boolean",value:t.resource.random,expression:"resource.random",modifiers:{boolean:!0}}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"resource_"+t.resource.id+"_random"},domProps:{checked:Array.isArray(t.resource.random)?t._i(t.resource.random,null)>-1:t.resource.random},on:{change:function(e){var s=t.resource.random,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,n=t._i(s,a);i.checked?n<0&&t.$set(t.resource,"random",s.concat([a])):n>-1&&t.$set(t.resource,"random",s.slice(0,n).concat(s.slice(n+1)))}else t.$set(t.resource,"random",o)}}}),s("label",{staticClass:"form-check-label",attrs:{for:"resource_"+t.resource.id+"_random"}},[t._v("Randomize order")])])]):t._e(),""!==t.resource.dataset.collection_id?s("sub-card",{attrs:{label:"Relations","add-button":"Add Relation",hasError:t.errors.find((function(t){return t.startsWith("relations_")}))},on:{add:t.addRelation}},[0===t.resource.related.length?s("div",{staticClass:"font-italic mt-3"},[t._v("\n        No relations\n      ")]):t._e(),t.resource.related.length>0?s("div",{staticClass:"form-group form-check mt-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.resource.related_array,expression:"resource.related_array"}],staticClass:"form-check-input",attrs:{id:t.resource.label+"related_array",type:"checkbox"},domProps:{checked:Array.isArray(t.resource.related_array)?t._i(t.resource.related_array,null)>-1:t.resource.related_array},on:{change:function(e){var s=t.resource.related_array,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,n=t._i(s,a);i.checked?n<0&&t.$set(t.resource,"related_array",s.concat([a])):n>-1&&t.$set(t.resource,"related_array",s.slice(0,n).concat(s.slice(n+1)))}else t.$set(t.resource,"related_array",o)}}}),s("label",{staticClass:"form-check-label",attrs:{for:t.resource.label+"related_array"}},[t._v("\n          Use relations as combined source\n        ")])]):t._e(),t._l(t.resource.related,(function(e,i){return s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-4"},[s("label",{attrs:{for:"resource_"+t.resource.id+"_related_"+e.id+"_resource"}},[t._v("\n            Related collection\n          ")]),s("select-box",{class:{"is-invalid":t.errors.includes("relations_resource_"+i)},attrs:{id:"resource_"+t.resource.id+"_related_"+e.id+"_resource"},model:{value:e.resource,callback:function(s){t.$set(e,"resource",s)},expression:"relation.resource"}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Choose a collection")]),t._l(t.$root.resources,(function(e){return e.id!==t.resource.id?s("option",{domProps:{value:e.id}},[t._v("\n              "+t._s(e.label)+"\n            ")]):t._e()}))],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("relations_resource_"+i),expression:"errors.includes(`relations_resource_${index}`)"}],staticClass:"invalid-feedback"},[t._v("\n            Please provide a related collection\n          ")])],1),e.resource>0?s("div",{staticClass:"form-group col-4"},[s("label",{attrs:{for:"resource_"+t.resource.id+"_related_"+e.id+"_local_property"}},[t._v("\n            Local property\n          ")]),s("select-box",{class:{"is-invalid":t.errors.includes("relations_local_prop_"+i)},model:{value:e.local_property,callback:function(s){t.$set(e,"local_property",s)},expression:"relation.local_property"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Select local property")]),t._l(t.selectedCollection["properties"],(function(e,i){return s("option",{domProps:{value:i}},[t._v("\n              "+t._s(i)+"\n            ")])}))],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("relations_local_prop_"+i),expression:"errors.includes(`relations_local_prop_${index}`)"}],staticClass:"invalid-feedback"},[t._v("\n            Please provide a local property\n          ")])],1):t._e(),e.resource>0?s("div",{staticClass:"form-group col-3"},[s("label",{attrs:{for:"resource_"+t.resource.id+"_related_"+e.id+"_remote_property"}},[t._v("\n            Remote property\n          ")]),s("select-box",{class:{"is-invalid":t.errors.includes("relations_remote_prop_"+i)},model:{value:e.remote_property,callback:function(s){t.$set(e,"remote_property",s)},expression:"relation.remote_property"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Select remote property")]),t._l(t.getPropertiesForResource(e.resource),(function(e,i){return s("option",{domProps:{value:i}},[t._v("\n              "+t._s(i)+"\n            ")])}))],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("relations_remote_prop_"+i),expression:"errors.includes(`relations_remote_prop_${index}`)"}],staticClass:"invalid-feedback"},[t._v("\n            Please provide a remote property\n          ")])],1):t._e(),s("div",{staticClass:"form-group col-1 align-self-end"},[s("button-delete",{attrs:{size:""},on:{click:function(e){return t.resource.related.splice(i,1)}}})],1)])}))],2):t._e()],1)],1)},zt=[],Gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.conditionsGroup.conditions?s("div",{staticClass:"position-relative shadow border p-3 mt-3",class:[{"is-invalid":t.errors.length>0}].concat(t.styleClass)},[t.isRoot?t._e():s("handle"),s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col-auto"},[s("fa-icon",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.uid,expression:"uid"}],attrs:{icon:"chevron-down",size:"lg"}})],1),t.conditionsGroup.conditions.length>0?s("div",{staticClass:"col"},[s("select-box",{model:{value:t.conditionsGroup.type,callback:function(e){t.$set(t.conditionsGroup,"type",e)},expression:"conditionsGroup.type"}},[s("option",{attrs:{value:"AND"}},[t._v("All conditions must be met (AND)")]),s("option",{attrs:{value:"OR"}},[t._v("At least one of the conditions must be met (OR)")])])],1):t._e(),t.conditionsGroup.conditions.length<1?s("div",{staticClass:"col font-italic"},[t._v("\n      No conditions\n\n      "),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes("conditions")?[t._v("\n          Please provide at least one condition\n        ")]:t._e()],2)]):t._e(),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row"},[!t.isRoot&&t.conditionsGroup.conditions.length>0?s("div",{staticClass:"col-auto"},[s("button-delete",{staticClass:"pt-1 pr-0",attrs:{title:"Delete this group"},on:{click:function(e){return t.$emit("remove",t.index)}}})],1):t._e(),s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add condition"},on:{click:t.addGroupWithCondition}})],1)])])]),s("b-collapse",{ref:t.uid,attrs:{visible:"",id:t.uid},model:{value:t.isOpen,callback:function(e){t.isOpen=e},expression:"isOpen"}},[s("draggable",{attrs:{group:t.group,handle:".handle"},on:{change:function(e){return t.onMove(e)}},model:{value:t.conditionsGroup.conditions,callback:function(e){t.$set(t.conditionsGroup,"conditions",e)},expression:"conditionsGroup.conditions"}},t._l(t.conditionsGroup.conditions,(function(e,i){return s("conditions-group",{key:i,ref:"conditionGroupComponents",refInFor:!0,attrs:{index:i,uid:t.uid+"_"+i,group:t.group,"conditions-group":e,"should-have-conditions":t.shouldHaveConditions,"validate-method-name":t.validateMethodName},on:{add:function(e){return t.$emit("add",e)},remove:function(e){return t.removeCondition(e)},promote:function(e){return t.promoteConditionGroup(e)},demote:function(e){return t.demoteConditionGroup(e)}},scopedSlots:t._u([{key:"default",fn:function(e){return[t._t("default",null,null,e)]}}],null,!0)})})),1)],1)],1):s("div",{staticClass:"position-relative",class:t.styleClass},[s("handle"),t._t("default",null,{index:t.index,condition:t.conditionsGroup,add:function(){return t.$emit("promote",t.index)},remove:function(){return t.$emit("remove",t.index)}})],2)},Vt=[],Bt={name:"ConditionsGroup",components:{Draggable:Mt.a},mixins:[it],data(){return{isOpen:!0}},props:{uid:"",index:0,conditionsGroup:{},group:String,validateMethodName:String,isRoot:{type:Boolean,default:!1},shouldHaveConditions:{type:Boolean,default:!1}},computed:{styleClass(){const t=[];return this.isRoot&&t.push("mt-3"),this.isRoot||this.$parent.$parent.$parent.styleClass.includes("bg-primary-light")?t.push("bg-info-light","border-info"):t.push("bg-primary-light","border-primary"),t}},methods:{validateConditionsGroup(){let t=!0,e=!0,s=!0;return this.conditionsGroup.conditions&&this.conditionsGroup.conditions.length>0?e=!this.$refs.conditionGroupComponents.map(t=>t.validateConditionsGroup()).includes(!1):this.conditionsGroup.conditions&&this.shouldHaveConditions?t=this.validateField("conditions",this.conditionsGroup.conditions.length>0):!this.conditionsGroup.conditions&&this.validateMethodName&&this.$children.length>0&&"function"===typeof this.$children[1][this.validateMethodName]&&(s=this.$children[1][this.validateMethodName]()),t=this.validateField("conditions",t),e=this.validateField("group",e),s=this.validateField("children",s),t&&e&&s},onMove(t){t.hasOwnProperty("removed")&&!this.isRoot&&1===this.conditionsGroup.conditions.length&&this.$emit("demote",this.index)},addGroupWithCondition(){this.$emit("add",this.conditionsGroup),this.isOpen=!0},removeCondition(t){this.conditionsGroup.conditions.splice(t,1),this.isRoot||1!==this.conditionsGroup.conditions.length||this.$emit("demote",this.index)},promoteConditionGroup(t){const e=this.conditionsGroup.conditions[t],s=JSON.parse(JSON.stringify(e)),i={type:"AND",conditions:[s]};this.$set(this.conditionsGroup.conditions,t,i),this.$emit("add",this.conditionsGroup.conditions[t])},demoteConditionGroup(t){const e=this.conditionsGroup.conditions[t].conditions[0],s=JSON.parse(JSON.stringify(e));this.$set(this.conditionsGroup.conditions,t,s)}}},Ut=Bt,qt=Object(_["a"])(Ut,Gt,Vt,!1,null,null,null),Ht=qt.exports,Jt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border border-dark p-3 mt-3"},[s("div",{staticClass:"row align-items-center justify-content-between m-0 mb-2"},[s("div",{staticClass:"col"},[s("property",{ref:"propertyComponent",attrs:{property:t.condition.property,singular:!0,"resource-info":!1},on:{resetProperty:function(e){return t.resetProperty(t.condition.property,e)}}})],1),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-auto"},[s("button-delete",{staticClass:"pt-1 pr-0",attrs:{title:"Delete this Filter Condition"},on:{click:function(e){return t.$emit("remove",t.index)}}})],1),s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add Filter Condition and Create Group"},on:{click:function(e){return t.$emit("add")}}})],1)])])]),s("div",{staticClass:"form-row align-items-center"},[s("div",{staticClass:"col-3"},[s("select-box",{class:{"is-invalid":t.errors.includes("condition")},attrs:{"auto-height":!1},model:{value:t.condition.type,callback:function(e){t.$set(t.condition,"type",e)},expression:"condition.type"}},[s("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("Choose a filter type")]),s("option",{attrs:{value:"="}},[t._v("Equal to")]),s("option",{attrs:{value:"!="}},[t._v("Not equal to")]),s("option",{attrs:{value:"is_null"}},[t._v("Has no value")]),s("option",{attrs:{value:"not_null"}},[t._v("Has a value")]),s("option",{attrs:{value:"date_is_within"}},[t._v("Date is within")]),s("option",{attrs:{value:"date_is_not_within"}},[t._v("Date is not within")]),s("option",{attrs:{value:"ilike"}},[t._v("Contains (use % for wildcard)")]),s("option",{attrs:{value:"not_ilike"}},[t._v("Does not contain (use % for wildcard)")]),s("option",{attrs:{value:"appearances"}},[t._v("Appearances of property")])])],1),t.requiresValue?s("div",{staticClass:"col-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.condition.value,expression:"condition.value"}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.errors.includes("value")},attrs:{type:"text",placeholder:"Enter a value"},domProps:{value:t.condition.value},on:{input:function(e){e.target.composing||t.$set(t.condition,"value",e.target.value)}}})]):t._e(),"appearances"===t.condition.type?s("div",{staticClass:"col-2"},[s("select-box",{attrs:{"auto-height":!1},model:{value:t.condition.operator,callback:function(e){t.$set(t.condition,"operator",e)},expression:"condition.operator"}},[s("option",{attrs:{value:"<=",selected:""}},[t._v("Max.")]),s("option",{attrs:{value:">=",selected:""}},[t._v("Min.")]),s("option",{attrs:{value:"=",selected:""}},[t._v("Exactly")])])],1):t._e(),"appearances"===t.condition.type?s("div",{staticClass:"col-1"},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.condition.value,expression:"condition.value",modifiers:{number:!0}}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.errors.includes("value")},attrs:{type:"number",min:"0",step:"1"},domProps:{value:t.condition.value},on:{input:function(e){e.target.composing||t.$set(t.condition,"value",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]):t._e()]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("property")||t.errors.includes("condition")||t.errors.includes("value"),expression:"errors.includes('property') || errors.includes('condition') || errors.includes('value')"}],staticClass:"row"},[s("div",{staticClass:"invalid-feedback d-block pl-3"},[t.errors.includes("property")?[t._v("\n        Please select a property\n      ")]:t._e(),t.errors.includes("property")&&(t.errors.includes("condition")||t.errors.includes("value"))?[s("br")]:t._e(),t.errors.includes("condition")?[t._v("\n        Please provide a filter type\n      ")]:t.errors.includes("value")&&"appearances"===t.condition.type?[t._v("\n        Please provide a number for the condition\n      ")]:t.errors.includes("value")?[t._v("\n        Please provide a value for the condition\n      ")]:t._e()],2)])])},Yt=[],Wt={name:"ResourceFilterCondition",mixins:[it],props:["resource","condition","index"],computed:{requiresValue(){return["=","!=","date_is_within","date_is_not_within","ilike","not_ilike"].includes(this.condition.type)}},methods:{validateFilterCondition(){const t=this.validateField("property",this.$refs.propertyComponent.validateProperty()),e=this.validateField("condition",this.condition.type);let s=!1;return s=this.requiresValue?this.validateField("value",this.condition.value):"appearances"===this.condition.type?this.validateField("value",!isNaN(parseInt(this.condition.value))&&parseInt(this.condition.value)>0):this.validateField("value",!0),t&&e&&s},resetProperty(t,e){let s=t.slice(0,e);s.push(""),s.length%2>0&&s.push(""),this.$set(this.condition,"property",s)}}},Qt=Wt,Xt=Object(_["a"])(Qt,Jt,Yt,!1,null,null,null),Zt=Xt.exports,Kt={name:"Resource",mixins:[it],components:{ConditionsGroup:Ht,ResourceFilterCondition:Zt},data(){return{prevAutoLabel:"",datasetsLoaded:!0}},props:{resource:Object},computed:{datasets(){return this.datasetsLoaded?this.$root.getDatasets(this.resource.dataset.timbuctoo_graphql,this.resource.dataset.timbuctoo_hsid):{}},collections(){return this.resource.dataset.dataset_id?this.datasets[this.resource.dataset.dataset_id].collections:{}},datasetsList(){return Object.entries(this.datasets).map(([t,e])=>({id:t,...e})).sort((t,e)=>t.title.localeCompare(e.title))},collectionsList(){return Object.entries(this.collections).map(([t,e])=>({id:t,...e})).sort((t,e)=>t.id.localeCompare(e.id))},selectedDataset(){return this.datasetsList.find(t=>t.id===this.resource.dataset.dataset_id)},selectedCollection(){return this.collectionsList.find(t=>t.id===this.resource.dataset.collection_id)},autoLabel(){if(this.datasetsLoaded&&this.resource.dataset.dataset_id&&this.resource.dataset.collection_id){const t=this.selectedDataset.title;return`${t} [type: ${this.resource.dataset.collection_id}]`}return"Collection "+(this.resource.id+1)},isUsedInAlignmentResults(){const t=this.$root.alignments.map(t=>t.alignment);for(let e=0;e<this.$root.matches.length;e++){const s=this.$root.matches[e];if(t.includes(s.id)&&(s.sources.includes(this.resource.id)||s.targets.includes(this.resource.id)))return!0}return!1}},methods:{hsurl(){return window.location.origin},validateResource(){const t=this.validateField("dataset",this.resource.dataset.dataset_id&&this.datasets.hasOwnProperty(this.resource.dataset.dataset_id)),e=this.datasets[this.resource.dataset.dataset_id],s=this.validateField("collection",this.resource.dataset.collection_id&&e&&e.collections.hasOwnProperty(this.resource.dataset.collection_id)),i=parseInt(this.resource.limit),o=this.validateField("limit",!isNaN(i)&&(-1===i||i>0));let a=!0;this.errors=this.errors.filter(t=>!t.startsWith("relations_")),this.resource.related.forEach((t,s)=>{const i=this.$root.resources.find(e=>e.id===parseInt(t.resource)),o=this.validateField(`relations_resource_${s}`,t.resource&&i),n=e&&e.collections[this.resource.dataset.collection_id].properties,r=this.validateField(`relations_local_prop_${s}`,t.local_property&&n&&n.hasOwnProperty(t.local_property)),l=i&&ds[i.dataset.dataset_id],c=l&&l.collections[i.dataset.collection_id].properties,d=this.validateField(`relations_remote_prop_${s}`,t.remote_property&&c&&c.hasOwnProperty(t.remote_property));o&&r&&d||(a=!1)});let n=!0;return this.$refs.filterGroupComponent&&(n=this.$refs.filterGroupComponent.validateConditionsGroup()),n=this.validateField("filters",n),s&&t&&o&&a&&n},clearFilter(){this.resource.filter={type:"AND",conditions:[]}},updateDataset(t){this.resource.dataset.dataset_id=t.id,this.resource.dataset.collection_id="",this.resource.dataset.published=t.published,this.clearFilter()},updateCollection(t){this.resource.dataset.collection_id=t.id,this.clearFilter()},addRelation(t){t&&t.target.blur(),this.resource.related.push({resource:"",local_property:"",remote_property:""})},addFilterCondition(t){t.conditions.push({type:"",property:[this.resource.id,""]})},getPropertiesForResource(t){const e=this.$root.getResourceById(t);return this.datasets[e.dataset.dataset_id]["collections"][e.dataset.collection_id]["properties"]},resetDatasets(){this.datasetsLoaded=!1,this.resource.dataset.dataset_id="",this.resource.dataset.collection_id="",this.clearFilter()},login(){this.resetDatasets();const t=window.open("","loginWindow");window.addEventListener("message",e=>{e.origin===window.location.origin&&e.data.hasOwnProperty("timbuctoo-hsid")&&(this.resource.dataset.timbuctoo_hsid=e.data["timbuctoo-hsid"],t.close(),this.loadDatasets())},!1),document.getElementById("login_"+this.resource.id).submit()},async loadDatasets(){await this.$root.loadDatasets(this.resource.dataset.timbuctoo_graphql,this.resource.dataset.timbuctoo_hsid),this.datasetsLoaded=!0}},updated(){this.resource.label===this.prevAutoLabel&&(this.prevAutoLabel=this.autoLabel,this.$set(this.resource,"label",this.autoLabel))},mounted(){this.resource.label&&this.resource.label!==this.autoLabel||(this.prevAutoLabel=this.autoLabel,this.$set(this.resource,"label",this.autoLabel)),0===this.datasetsList.length&&(this.datasetsLoaded=!1)}},te=Kt,ee=Object(_["a"])(te,Ft,zt,!1,null,null,null),se=ee.exports,ie=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("card",{attrs:{id:"match_"+t.match.id,type:"matches","has-error":t.errors.length>0,"has-handle":!0,"has-extra-row":!!t.alignment},scopedSlots:t._u([{key:"title-columns",fn:function(){return[s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.$emit("duplicate",t.match)}}},[t._v("Duplicate")])],1),"downloading"===t.alignmentStatus||"running"===t.alignmentStatus?s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"danger"},on:{click:t.killAlignment}},[t._v("\n        Stop\n      ")])],1):t._e(),t.alignment&&"failed"!==t.alignmentStatus?t._e():s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:t.runAlignment}},[t._v("\n        Run\n        "),"failed"===t.alignmentStatus?[t._v("again")]:t._e()],2)],1),"done"===t.alignmentStatus?s("div",{staticClass:"col-auto"},[t.clustering&&"running"!==t.clustering?s("button",{staticClass:"btn btn-info my-1",attrs:{type:"button",disabled:""===t.association,title:""===t.association?"Choose an association first":""},on:{click:function(e){return t.runClustering(e)}}},[t._v("\n        Reconcile\n      ")]):t.clustering||"running"===t.clustering?t._e():s("button",{staticClass:"btn btn-info my-1",attrs:{type:"button"},on:{click:function(e){return t.runClustering(e)}}},[t._v("\n        Cluster\n        "),""!==t.association?[t._v(" & Reconcile")]:t._e()],2)]):t._e(),"done"===t.alignmentStatus&&t.associationFiles?s("div",{staticClass:"col-auto"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.association,expression:"association"}],staticClass:"col-auto form-control association-select my-1",attrs:{id:"match_"+t.match.id+"_association"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.association=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("No association")]),t._l(t.associationFiles,(function(e){return s("option",{domProps:{value:e}},[t._v("\n          "+t._s(e)+"\n        ")])}))],2)]):t._e(),t.alignment?t._e():s("div",{staticClass:"col-auto"},[s("button-delete",{attrs:{title:"Delete this Alignment"},on:{click:function(e){return t.$emit("remove")}}})],1)]},proxy:!0},{key:"columns",fn:function(){return[s("div",{staticClass:"col"},[t.alignment?s("sub-card",{staticClass:"small",attrs:{"is-first":!0}},[s("div",{staticClass:"row align-items-center justify-content-center"},[t.running?s("div",{staticClass:"col-auto"},[s("loading",{attrs:{small:!0}})],1):t._e(),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row justify-content-center"},[s("div",{staticClass:"col-auto"},[s("strong",[t._v("Status: ")]),t._v("\n                "+t._s(t.status)+"\n              ")])]),"failed"===t.alignmentStatus&&t.alignment.status_message?s("div",{staticClass:"row justify-content-center"},[s("div",{staticClass:"col-auto text-info font-italic"},[t._v("\n                "+t._s(t.alignment.status_message)+"\n              ")])]):t._e(),t.downloads.length>0?s("div",{staticClass:"row justify-content-center"},[s("div",{staticClass:"col-auto clearfix"},t._l(t.downloads,(function(e){return s("ul",{staticClass:"font-italic text-info inline-list px-0"},[s("li",[t._v("\n                    "+t._s(e.collection_id)+":\n                    "),s("download-progress",{attrs:{"dataset-id":e.dataset_id,"collection-id":e.collection_id}})],1)])})),0)]):t._e(),s("div",{staticClass:"row justify-content-center mt-1"},[s("div",{staticClass:"col-auto"},["waiting"===t.alignmentStatus?[s("strong",[t._v("Request: ")]),t._v("\n                  "+t._s(t._f("moment")(t.alignment.requested_at,"MMMM Do YYYY, hh:mm"))+"\n\n                  "),s("span",{staticClass:"font-italic"},[t._v("\n                    ("),s("duration",{attrs:{from:t.alignment.requested_at}}),t._v(")\n                  ")],1)]:"downloading"===t.alignmentStatus||"running"===t.alignmentStatus?[s("strong",[t._v("Start: ")]),t._v("\n                  "+t._s(t._f("moment")(t.alignment.processing_at,"MMMM Do YYYY, hh:mm"))+"\n\n                  "),s("span",{staticClass:"font-italic"},[t._v("\n                    ("),s("duration",{attrs:{from:t.alignment.processing_at}}),t._v(")\n                  ")],1)]:t.alignment.finished_at?[s("strong",[t._v("Matching duration: ")]),s("duration",{staticClass:"font-italic",attrs:{from:t.alignment.processing_at,until:t.alignment.finished_at}})]:t._e()],2)]),t.clustering?s("div",{staticClass:"row justify-content-center"},[s("div",{staticClass:"col-auto"},["waiting"===t.clusteringStatus?[s("strong",[t._v("Request clustering: ")]),t._v("\n                  "+t._s(t._f("moment")(t.clustering.requested_at,"MMMM Do YYYY, hh:mm"))+"\n\n                  "),s("span",{staticClass:"font-italic"},[t._v("\n                    ("),s("duration",{attrs:{from:t.clustering.requested_at}}),t._v(")\n                  ")],1)]:"running"===t.clusteringStatus?[s("strong",[t._v("Start clustering: ")]),t._v("\n                  "+t._s(t._f("moment")(t.clustering.processing_at,"MMMM Do YYYY, hh:mm"))+"\n\n                  "),s("span",{staticClass:"font-italic"},[t._v("\n                    ("),s("duration",{attrs:{from:t.clustering.processing_at}}),t._v(")\n                  ")],1)]:t.clustering.finished_at?[s("strong",[t._v("Clustering duration: ")]),s("duration",{staticClass:"font-italic",attrs:{from:t.clustering.processing_at,until:t.clustering.finished_at}})]:t._e()],2)]):t._e(),s("div",{staticClass:"row justify-content-center mt-1"},[s("div",{staticClass:"col-auto"},[t.clustering?s("div",[s("strong",[t._v("Clusters found: ")]),t._v("\n                  "+t._s(t.clustering.clusters_count?t.clustering.clusters_count.toLocaleString("en"):0)+"\n                ")]):t._e(),s("div",[s("strong",[t._v("Links found: ")]),t._v("\n                  "+t._s(t.alignment.links_count?t.alignment.links_count.toLocaleString("en"):0)+"\n\n                  "),t.alignment.links_count&&t.alignment.distinct_links_count&&t.alignment.links_count>t.alignment.distinct_links_count?s("span",{staticClass:"font-italic text-info"},[t._v("\n                    ("+t._s(t.alignment.distinct_links_count.toLocaleString("en"))+" distinct links)\n                  ")]):t._e()])]),s("div",{staticClass:"col-auto"},[s("div",[s("strong",[t._v("Resources in source: ")]),t._v("\n                  "+t._s(t.alignment.sources_count?t.alignment.sources_count.toLocaleString("en"):0)+"\n\n                  "),t.alignment.sources_count&&t.alignment.distinct_sources_count&&t.alignment.sources_count>t.alignment.distinct_sources_count?s("span",{staticClass:"font-italic text-info"},[t._v("\n                    ("+t._s(t.alignment.distinct_sources_count.toLocaleString("en"))+" distinct resources)\n                  ")]):t._e()]),s("div",[s("strong",[t._v("Resources in target: ")]),t._v("\n                  "+t._s(t.alignment.targets_count?t.alignment.targets_count.toLocaleString("en"):0)+"\n\n                  "),t.alignment.targets_count&&t.alignment.distinct_targets_count&&t.alignment.targets_count>t.alignment.distinct_targets_count?s("span",{staticClass:"font-italic text-info"},[t._v("\n                    ("+t._s(t.alignment.distinct_targets_count.toLocaleString("en"))+" distinct resources)\n                  ")]):t._e()])])])])])]):t._e()],1)]},proxy:!0}]),model:{value:t.match.label,callback:function(e){t.$set(t.match,"label",e)},expression:"match.label"}},[s("sub-card",{attrs:{label:"Description"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.match.description,expression:"match.description"}],staticClass:"form-control mt-3",attrs:{type:"text",id:"description_"+t.match.id},domProps:{value:t.match.description},on:{input:function(e){e.target.composing||t.$set(t.match,"description",e.target.value)}}}),s("small",{staticClass:"form-text text-muted mt-2"},[t._v("\n      Provide a description for this alignment\n    ")])]),s("fieldset",{attrs:{disabled:!!t.alignment}},[s("sub-card",{attrs:{label:"Sources","has-info":!0,"add-button":"Add a Collection as a Source",hasError:t.errors.includes("sources")||t.errors.includes("sources_select")},on:{add:function(e){return t.addMatchResource("sources",e)}},scopedSlots:t._u([{key:"info",fn:function(){return[s("match-sources-info")]},proxy:!0}])},[s("div",{staticClass:"row pl-5 mt-2"},[s("div",{staticClass:"col"},[t._l(t.match.sources,(function(e,i){return s("match-resource",{key:i,ref:"sourceResourceComponents",refInFor:!0,attrs:{"match-resource-id":"source_"+i,match:t.match,"match-resource":t.$root.getResourceById(e),"resources-key":"sources"},on:{input:function(e){return t.updateMatchResource("sources",i,e)},remove:function(e){return t.deleteMatchResource("sources",i)}}})})),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes("sources")?[t._v("\n              Please provide at least one source\n            ")]:t._e()],2)],2)])]),s("sub-card",{attrs:{label:"Targets","has-info":!0,"add-button":"Add a Collection as a Target",hasError:t.errors.includes("targets")||t.errors.includes("targets_select")},on:{add:function(e){return t.addMatchResource("targets",e)}},scopedSlots:t._u([{key:"info",fn:function(){return[s("match-targets-info")]},proxy:!0}])},[s("div",{staticClass:"row pl-5 mt-2"},[s("div",{staticClass:"col"},[t._l(t.match.targets,(function(e,i){return s("match-resource",{key:i,ref:"targetResourceComponents",refInFor:!0,attrs:{"match-resource-id":"target_"+i,match:t.match,"match-resource":t.$root.getResourceById(e),"resources-key":"targets"},on:{input:function(e){return t.updateMatchResource("targets",i,e)},remove:function(e){return t.deleteMatchResource("targets",i)}}})})),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes("targets")?[t._v("\n              Please provide at least one target\n            ")]:t._e()],2)],2)])]),s("sub-card",{attrs:{label:"Matching Methods","has-info":!0,hasError:t.errors.includes("matching-methods")||t.errors.includes("match-against")},scopedSlots:t._u([{key:"info",fn:function(){return[s("match-matching-methods-info")]},proxy:!0}])},[s("div",{staticClass:"row mt-3"},[s("div",{staticClass:"form-group col"},[s("label",{attrs:{for:"match_against_"+t.match.id}},[t._v("Match results should match results in set:")]),s("select-box",{staticClass:"mr-2",class:{"is-invalid":t.errors.includes("match-against")},attrs:{id:"match_against_"+t.match.id},model:{value:t.match.match_against,callback:function(e){t.$set(t.match,"match_against",e)},expression:"match.match_against"}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Select an alignment")]),t._l(t.$root.matches,(function(e){return t.match.id!==e.id?s("option",{domProps:{value:e.id}},[t._v(t._s(e.label))]):t._e()}))],2),s("small",{staticClass:"form-text text-muted mt-2"},[t._v("\n            When an alignment is selected, it plays the role of a filter by removing all matched pairs found\n            that are not in the selected alignment set.\n          ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("match-against"),expression:"errors.includes('match-against')"}],staticClass:"invalid-feedback"},[t._v("\n            You have to run the selected alignment first, before you can run this alignment\n          ")])],1)]),s("conditions-group",{ref:"matchingMethodGroupComponent",attrs:{"conditions-group":t.match.methods,"is-root":!0,"should-have-conditions":!0,group:"matches-filters",uid:"match_"+t.match.id+"_group_0","validate-method-name":"validateMatchCondition"},on:{add:function(e){return t.addMatchCondition(e)}},scopedSlots:t._u([{key:"default",fn:function(t){return[s("match-condition",{attrs:{condition:t.condition,index:t.index},on:{add:function(e){return t.add()},remove:function(e){return t.remove()}}})]}}])})],1)],1)],1)},oe=[],ae=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"SOURCES"}},[s("div",{staticClass:"h2"},[t._v("COMPOSING VIRTUAL SOURCE FROM COLLECTIONS")]),s("img",{attrs:{width:"700px",src:"/static/images/VirtualCollection.png"}}),s("p",{staticClass:"h5 text-left pt-4 pb-4"},[t._v("\n    All collections of interest selected as sources are combined into\n    a "),s("strong",[t._v("SINGLE VIRTUAL COLLECTION")]),t._v("> with the resource's id and the value of the selected\n    properties. For a single dataset, multiple "),s("strong",[t._v("SEMANTICALLY SIMILAR PROPERTIES")]),t._v(" can be\n    selected.\n  ")]),s("hr"),s("img",{staticClass:"pb-4",attrs:{width:"1000px",src:"/static/images/Documentation.png"}})])},ne=[],re={},le=Object(_["a"])(re,ae,ne,!1,null,null,null),ce=le.exports,de=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"TARGETS"}},[s("div",{staticClass:"h2"},[t._v("MATCHING SOURCE AGAINST TARGET")]),s("img",{attrs:{src:"/static/images/Source_Target.png",width:"800px"}}),s("ul",{staticClass:"text-left pt-5"},[s("li",[t._v("Several collections can be selected as "),s("span",{staticClass:"text-info"},[t._v("SOURCE")]),t._v(".")]),s("li",[t._v("Several collections can be selected as "),s("span",{staticClass:"text-info"},[t._v("TARGET")]),t._v(".")]),s("li",[t._v("For each collection, be it the "),s("span",{staticClass:"text-info"},[t._v("TARGET")]),t._v(" or the "),s("span",{staticClass:"text-info"},[t._v("SOURCE")]),t._v(" several properties can be selected.\n    ")]),s("li",[t._v("Overall, "),s("strong",[t._v("ALL")]),t._v(" selected properties "),s("strong",[t._v("MUST")]),t._v(" be concistent for a\n      particuilar the type of "),s("span",{staticClass:"text-info"},[t._v("MATCHING METHOD")]),t._v(" in mind.\n    ")])]),s("hr")])},ue=[],he={},pe=Object(_["a"])(he,de,ue,!1,null,null,null),me=pe.exports,ve=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"MATCHING METHODS AND LOGICAL OPERATOR"}},[s("div",{staticClass:"h3 pt-5 text-info"},[t._v("Simple Matching Scenario-1")]),s("img",{attrs:{width:"700px",src:"/static/images/4_MethodSimple.png"}}),s("div",{staticClass:"h5"},[t._v("Matching two datasets using "),s("strong",[t._v("one")]),t._v(" property per dataset")]),s("div",{staticClass:"h3 pt-5 text-info"},[t._v("Simple Matching Scenario-2")]),s("img",{attrs:{width:"700px",src:"/static/images/5_MethodProp.png"}}),s("div",{staticClass:"h5"},[t._v("\n    More than one property per dataset is allowed."),s("br"),t._v("\n    Only, all aligned property should be semantically similar.\n  ")]),s("div",{staticClass:"h3 pt-5 text-info"},[t._v("\n    Simple Matching Scenario-3\n  ")]),s("img",{attrs:{width:"700px",src:"/static/images/6_MethodDs.png"}}),s("div",{staticClass:"h5"},[t._v("\n    More than one dataset is allowed for a "),s("span",{staticClass:"text-info"},[t._v("SOURCE")]),t._v(" or a\n    "),s("span",{staticClass:"text-info"},[t._v("TARGET")]),t._v("."),s("br"),t._v("\n    Only, all aligned property should be semantically similar."),s("br"),t._v("\n    The logical expression provide a human readable of how it is implemented.\n  ")]),s("div",{staticClass:"h3 pt-5 text-info"},[t._v("Complex Matching Scenario")]),s("img",{attrs:{width:"700px",src:"/static/images/7_MethodFull.png"}}),s("div",{staticClass:"h5"},[t._v("\n    More than one method is allowed."),s("br"),t._v("\n    Within each method, a "),s("strong",[t._v("DISJUNCTION")]),t._v(" ("),s("span",{staticClass:"text-info"},[t._v("OR")]),t._v(") operator is\n    applied over each pair of properties "),s("strong",[t._v("across")]),t._v(" two datasets."),s("br"),t._v("\n    A "),s("strong",[t._v("DISJUNCTION")]),t._v(" ("),s("span",{staticClass:"text-info"},[t._v("OR")]),t._v(") OR "),s("strong",[t._v("CONJUNCTION")]),t._v("\n    ("),s("span",{staticClass:"text-info"},[t._v("AND")]),t._v(") operator is necessary whenever more than one methods is\n    required."),s("br")])])},_e=[],fe={},ge=Object(_["a"])(fe,ve,_e,!1,null,null,null),be=ge.exports,ye=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row align-items-center"},[t.matchResource?s("div",{staticClass:"ml-3",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[t._v("\n    "+t._s(t.matchResource.label)+"\n  ")]):s("div",{staticClass:"col-auto pr-0",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[s("select-box",{class:{"is-invalid":t.errors.includes("resource")},attrs:{id:"match_"+t.match.id+"_resource_label_"+t.matchResourceId,value:t.matchResource},on:{input:t.selectResource}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Choose a collection")]),t._l(t.resources,(function(e){return s("option",{domProps:{value:e.id}},[t._v("\n        "+t._s(e.label)+"\n      ")])}))],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("resource"),expression:"errors.includes('resource')"}],staticClass:"invalid-feedback"},[t._v("\n      Please select a collection\n    ")])],1),s("div",{staticClass:"col-auto pl-0 ml-3",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[s("button-delete",{staticClass:"btn-sm",class:{invisible:!t.hovering},attrs:{size:"sm"},on:{click:function(e){return t.$emit("remove")}}})],1)])},Ce=[],we={name:"MatchResource",mixins:[it],data(){return{hovering:!1}},props:{match:Object,matchResource:Object,matchResourceId:String,resourcesKey:String},computed:{resources(){return this.$root.resources.filter(t=>{return!this.match[this.resourcesKey].includes(t.id.toString())})}},methods:{validateResource(){return this.validateField("resource",this.matchResource&&""!==this.matchResource)},selectResource(t){this.hovering=!1,this.$emit("input",parseInt(t))}}},xe=we,ke=Object(_["a"])(xe,ye,Ce,!1,null,null,null),$e=ke.exports,Se=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border border-dark p-3 mt-3"},[s("div",{staticClass:"row align-items-start justify-content-between mb-2"},[s("div",{staticClass:"col-auto mr-auto"},[s("div",{staticClass:"row"},[s("label",{staticClass:"h4 col-auto"},[t._v("Method")]),s("div",{staticClass:"col-auto"},[s("select-box",{class:{"is-invalid":t.errors.includes("method_name")},on:{input:t.handleMethodIndexChange},model:{value:t.condition.method_name,callback:function(e){t.$set(t.condition,"method_name",e)},expression:"condition.method_name"}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Select a method")]),t._l(t.matchingMethods,(function(e,i){return s("option",{domProps:{value:i}},[t._v(t._s(e.label))])}))],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("method_name"),expression:"errors.includes('method_name')"}],staticClass:"invalid-feedback"},[t._v("\n            Please specify a matching method\n          ")])],1)])]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"form-inline"},[t._l(t.methodValueTemplate.items,(function(e){return[e.label?s("label",{staticClass:"small mr-2",attrs:{for:e.key+"_"+t.index}},[t._v(t._s(e.label))]):t._e(),"number"===typeof e.type?s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.condition.method_value[e.key],expression:"condition.method_value[item.key]",modifiers:{number:!0}}],staticClass:"form-control form-control-sm mr-2",class:{"is-invalid":t.errors.includes("method_value_"+e.key)},attrs:{id:e.key+"_"+t.index,type:"number",step:"0.1"},domProps:{value:t.condition.method_value[e.key]},on:{input:function(s){s.target.composing||t.$set(t.condition.method_value,e.key,t._n(s.target.value))},blur:function(e){return t.$forceUpdate()}}}):t._e(),e.choices?s("select",{directives:[{name:"model",rawName:"v-model",value:t.condition.method_value[e.key],expression:"condition.method_value[item.key]"}],staticClass:"form-control h-auto mr-2",class:{"is-invalid":t.errors.includes("method_value_"+e.key)},attrs:{id:e.key+"_"+t.index},on:{change:function(s){var i=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.condition.method_value,e.key,s.target.multiple?i:i[0])}}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Select an option")]),t._l(e.choices,(function(e,i){return s("option",{domProps:{value:e}},[t._v(t._s(i)+"\n            ")])}))],2):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("method_value_"+e.key),expression:"errors.includes(`method_value_${item.key}`)"}],staticClass:"invalid-feedback"},[t._v("\n            Please specify a valid value\n          ")])]}))],2)]),s("div",{staticClass:"col-auto ml-auto"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-auto"},[s("button-delete",{staticClass:"pt-1 pr-0",attrs:{title:"Delete this Method"},on:{click:function(e){return t.$emit("remove",t.index)}}})],1),s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add Method and Create Group"},on:{click:function(e){return t.$emit("add")}}})],1)])])]),["=","LEVENSHTEIN"].includes(t.condition.method_name)?s("sub-card",{staticClass:"max-overflow small mb-4"},["="===t.condition.method_name?s("exact-match-info"):"LEVENSHTEIN"===t.condition.method_name?s("levenshtein-info"):t._e()],1):t._e(),t._l(["sources","targets"],(function(e){return s("div",{staticClass:"row pl-5 mb-3"},[s("div",{staticClass:"col"},[s("div",{staticClass:"row"},[s("div",{staticClass:"h4 col-auto"},[t._v(t._s(t._f("capitalize")(e))+" properties")]),t.unusedResources[e].length>0?s("div",{staticClass:"col-auto form-group"},[s("select-box",{on:{input:function(s){return t.condition[e][s].push({property:[s,""]})}}},[s("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("Add property for Collection:")]),t._l(t.unusedResources[e],(function(e){return s("option",{domProps:{value:e}},[t._v("\n              "+t._s(t.$root.getResourceById(e).label)+"\n            ")])}))],2)],1):t._e()]),t._l(t.condition[e],(function(i){return t._l(i,(function(o,a){return s("div",{staticClass:"row"},[s("div",{staticClass:"col ml-5 p-3 border-top"},[o.property?s("property",{ref:"propertyComponents",refInFor:!0,attrs:{property:o.property},on:{clone:function(t){return i.splice(a+1,0,{property:[i[a]["property"][0],""]})},delete:function(e){return t.$delete(i,a)},resetProperty:function(e){return t.resetProperty(i,a,e)}}}):t._e(),s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col-auto h5"},[t._v("Transformers")]),s("div",{staticClass:"col-auto p-0"},[s("button-add",{staticClass:"btn-sm",attrs:{size:"sm",title:"Add Transformer"},on:{click:function(e){return t.addTransformer(o)}}})],1),t._l(o.transformers,(function(i,a){return s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col-auto pr-0"},[s("select-box",{class:{"is-invalid":t.errors.includes(e+"_transformers")},model:{value:o.transformers[a],callback:function(e){t.$set(o.transformers,a,e)},expression:"resource.transformers[index]"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Select a function")]),t._l(t.transformers,(function(e){return s("option",{domProps:{value:e}},[t._v("\n                        "+t._s(e)+"\n                      ")])}))],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes(e+"_transformers"),expression:"errors.includes(`${resources_key}_transformers`)"}],staticClass:"invalid-feedback"},[t._v("\n                      Please specify a transformer or remove the transformer\n                    ")])],1),s("div",{staticClass:"col-auto p-0 ml-2"},[s("button-delete",{staticClass:"btn-sm",attrs:{size:"sm"},on:{click:function(t){return o.transformers.splice(a,1)}}})],1)])])}))],2)],1)])}))})),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes(e)?[t._v("\n          Please specify at least one property\n        ")]:t._e()],2)],2)])}))],2)},Ie=[],je=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Ae=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("p",[t._v("\n    The "),s("strong",[t._v("Exact Match")]),t._v(" method is used to align "),s("strong",[t._v("source")]),t._v(" and "),s("strong",[t._v("target’s\n    Internationalized Resource Identifiers (IRI)")]),t._v(" whenever their respective user selected property values are\n    "),s("strong",[t._v("identical")]),t._v(".\n  ")])])}],Re={},Pe=Object(_["a"])(Re,je,Ae,!1,null,null,null),Me=Pe.exports,Ee=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Le=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("p",[t._v("\n    The "),s("strong",[t._v("​Approximated ​Levenshtein Distance")]),t._v(" ​method is used to align ​"),s("strong",[t._v("​source")]),t._v(" a​nd\n    "),s("strong",[t._v("​​target’s")]),s("strong",[t._v("​I​nternationalized Resource Identifiers")]),t._v(" whenever the similarity\n    score of their respective user selected property values are ​"),s("strong",[t._v("​above a given threshold​")]),t._v(".\n  ")]),s("p",[s("strong",[t._v("Edit distance")]),t._v(" is a way of quantifying how ​"),s("strong",[t._v("dissimilar")]),t._v(" two strings (e.g., words)\n    are to one another by counting the "),s("strong",[t._v("minimum number of operations")]),t._v(" ​"),s("var",[t._v("ε")]),t._v(' ​\n    (​removal, insertion, or substitution of a character in the string)​ required to transform one string\n    into the other. For example, ​the ​Levenshtein distance between "kitten" and "sitting" is '),s("var",[t._v("​ε ​= 3")]),t._v('\n    as it requires a two substitutions ("s" for "k" and "i" for "e") and one insertion of "g" at the end\n    ['),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Edit_distance"}},[t._v("https://en.wikipedia.org/wiki/Edit_distance")]),t._v("]​.\n  ")]),s("p",[s("strong",[t._v("Normalisation ​Ω​:")]),t._v(" Because in this application, the "),s("strong",[t._v("​similarity score")]),s("var",[t._v("​Ω")]),t._v(" ​of a matching pair needs to be quantified in the interval ​"),s("strong",[t._v("[0, 1]")]),t._v("​,\n    the​ "),s("strong",[t._v("dissimilarity score")]),s("var",[t._v("​ε")]),t._v(" expressing the "),s("strong",[t._v("​minimum number of\n    operations")]),t._v(" ​between two strings ​"),s("strong",[t._v("is then normalised")]),t._v(" as "),s("var",[t._v("​Ω")]),t._v("\n    based on the length of the longest string. The "),s("strong",[t._v("​dissimilarity score​​")]),s("var",[t._v("ε​ = 3")]),t._v(' ​between\n    ​"kitten" and "sitting" is then normalised to a '),s("strong",[t._v("​similarity score")]),s("var",[t._v("Ω​ ​=​ ​1 - 3 / 7 =\n    0.57​")]),t._v(".​\n  ")]),s("p",[s("strong",[t._v("Minimum threshold ​φ:")]),t._v(" Using this algorithm, ​a "),s("strong",[t._v("​minimum threshold value")]),s("var",[t._v("φ​")]),s("strong",[t._v("​must")]),t._v(" be set in the interval ​"),s("strong",[t._v("[0,1]")]),t._v(", ​such that finding any\n    matched pairs of IRIs based on the similarity of their respective property values depends on whether or not\n    the computed "),s("var",[t._v("​Ω")]),t._v(" is ​"),s("strong",[t._v("equal or above")]),s("var",[t._v("​φ")]),t._v("​. A threshold ​"),s("var",[t._v("φ = 1")]),t._v("\n    equates an exact match. In our previous example, if a "),s("strong",[t._v("​minimum")]),t._v(" threshold of "),s("var",[t._v("​φ = ​0.7")]),t._v('\n    is set, "kitten" and "sitting" will not be matched. ​'),s("strong",[t._v("In short")]),t._v(", "),s("var",[t._v("​φ")]),t._v(" is the user defined\n    threshold when the similarity score ​"),s("var",[t._v("Ω")]),t._v(" is selected for accepting or rejecting a match.\n  ")]),s("p",[s("strong",[t._v("Maximum character error threshold ​𝛿:")]),t._v("​ In case the ​"),s("strong",[t._v("original edit distance\n    score")]),t._v(" ​"),s("var",[t._v("ε")]),t._v(" (minimum number of operations score) is preferred, the number of "),s("strong",[t._v("character\n    errors")]),s("var",[t._v("​𝛿")]),t._v(" ​of choice is used instead as threshold for deciding whether a match is accepted or\n    rejected. However, for consistency purposes, the corresponding normalisation value "),s("var",[t._v("​Ω")]),t._v(" is still computed\n    for the minimum number of operations score computed "),s("var",[t._v("​ε")]),t._v("​. For instance, in our previous example, if a\n    "),s("strong",[t._v("​maximum ​characters errors")]),t._v(" i​s set to "),s("var",[t._v("​𝛿 = 3")]),t._v(', "kitten" and "sitting" will be matched\n    but the computed strength will be '),s("var",[t._v("​Ω = ​0.57")]),t._v(" a​nd ​not "),s("var",[t._v("​ε = 3")]),t._v(" as is it only serves the\n    purpose of decision maker. "),s("strong",[t._v("I​n short")]),t._v(", "),s("var",[t._v("​𝛿")]),t._v(" i​s the user defined threshold when the\n    dissimilarity score "),s("var",[t._v("ε")]),t._v("​ ​is selected for accepting or rejecting a match.\n  ")]),s("div",[s("p",[t._v("Example:")]),s("ol",[s("li",[t._v("1. Levenshtein-distance (Rembrand van Rijn, Rembrandt Harmensz van Rijn) = 10")]),s("li",[t._v("2. Normalised-L​evenshtein-distance ​(Rembrand van Rijn, Rembrandt Harmensz van Rijn) = 0.63")])]),s("p",[t._v("\n      If "),s("var",[t._v("​φ = 0.7")]),t._v(" t​hen "),s("code",[t._v("​[​Rembrand van Rijn] owl:sameAs [Rembrandt Harmensz van Rijn]")]),s("strong",[t._v("is rejected​")]),t._v(" because "),s("var",[t._v("Ω​ = 0.63 < φ​")]),t._v(".\n    ")]),s("p",[t._v("\n      If "),s("var",[t._v("​δ = 5")]),t._v(" t​hen "),s("code",[t._v("[​​Rembrand van Rijn] and [Rembrandt Harmensz van Rijn]")]),s("strong",[t._v("is ​rejected")]),t._v(" because "),s("var",[t._v("ε ​= 10 >​ ​δ")]),t._v(".\n    ")])])])}],Te={},Oe=Object(_["a"])(Te,Ee,Le,!1,null,null,null),Ne=Oe.exports,De={matchingMethods:{"=":{label:"Exact Match",items:[]},LEVENSHTEIN:{label:"Levenshtein distance",items:[{key:"max_distance",label:"Maximum distance",type:1,minValue:0}]},LEVENSHTEIN_APPROX:{label:"Approximated Levenshtein",items:[{key:"threshold",label:"Similarity threshold",type:.7,minValue:0,maxValue:1}]},LL_SOUNDEX:{label:"Approximated Soundex",items:[{key:"threshold",label:"Similarity threshold",type:.7,minValue:0,maxValue:1}]},BLOOTHOOFT_REDUCT:{label:"Approximated Bloothooft Reduction",items:[{key:"name_type",label:"",type:"",choices:{"First name":"first_name","Family name":"family name"}},{key:"threshold",label:"Similarity threshold",type:.7,minValue:0,maxValue:1}]},BLOOTHOOFT_REDUCT_APPROX:{label:"Similar Bloothooft Reduction",items:[{key:"name_type",label:"",type:"",choices:{"First name":"first_name","Family name":"family name"}},{key:"threshold",label:"Similarity threshold",type:.7,minValue:0,maxValue:1}]},TRIGRAM_DISTANCE:{label:"Trigram distance",items:[{key:"threshold",label:"Similarity threshold",type:.3,minValue:0,maxValue:1}]},TIME_DELTA:{label:"Time Delta",items:[{key:"days",label:"",type:0,minValue:0},{key:"multiplier",label:"",type:"",choices:{Years:365,Months:30,Days:1}}]},SAME_YEAR_MONTH:{label:"Same Year/Month",items:[{key:"date_part",label:"",type:"",choices:{Year:"year",Month:"month","Year and Month":"year_month"}}]},DISTANCE_IS_BETWEEN:{label:"Distance is between",items:[{key:"distance_start",label:"Start",type:0},{key:"distance_end",label:"End",type:0}]}},transformers:["ecartico_full_name","to_date_immutable"]},Fe={name:"MatchCondition",components:{ExactMatchInfo:Me,LevenshteinInfo:Ne},mixins:[it],data(){return{transformers:De.transformers,matchingMethods:De.matchingMethods}},props:["condition","index"],computed:{methodValueTemplate(){return this.matchingMethods.hasOwnProperty(this.condition.method_name)?this.matchingMethods[this.condition.method_name]:{label:"",items:[]}},unusedResources(){let t=["sources","targets"],e={};return t.forEach(t=>{e[t]=Object.keys(this.condition[t]).filter(e=>this.condition[t][e].length<1)}),e}},methods:{validateMatchCondition(){const t=this.validateField("method_name",this.condition.method_name.length>0);let e=!0;this.errors=this.errors.filter(t=>!t.startsWith("method_value_")),this.methodValueTemplate.items.forEach(t=>{const s=this.condition.method_value[t.key];let i=!0;t.hasOwnProperty("minValue")&&(isNaN(parseFloat(s))||parseFloat(s)<t.minValue)&&(i=!1),t.hasOwnProperty("maxValue")&&(isNaN(parseFloat(s))||parseFloat(s)>t.maxValue)&&(i=!1),t.hasOwnProperty("choices")&&!Object.values(t.choices).includes(s)&&(i=!1),"IS_IN_SET"!==this.condition.method_name||void 0!==s&&""!==s||(i=!1),this.validateField(`method_value_${t.key}`,i)||(e=!1)});const s=!this.$refs.propertyComponents.map(t=>t.validateProperty()).includes(!1);let i=!0;return["sources","targets"].forEach(t=>{Object.keys(this.condition[t]).forEach(e=>{this.validateField(t,this.condition[t][e].length>0)||(i=!1),this.condition[t][e].forEach(e=>{e.hasOwnProperty("transformers")&&!this.validateField(`${t}_transformers`,!e.transformers.includes(""))&&(i=!1)})})}),t&&e&&s&&i},handleMethodIndexChange(){this.condition.method_value={},this.methodValueTemplate.items.forEach(t=>{this.condition.method_value[t.key]=t.type})},addTransformer(t){t.hasOwnProperty("transformers")||(t.transformers=[]),t.transformers.push("")},resetProperty(t,e,s){let i=t[e].property,o=i.slice(0,s);o.push(""),o.length%2>0&&o.push(""),this.$set(t[e],"property",o)}}},ze=Fe,Ge=Object(_["a"])(ze,Se,Ie,!1,null,null,null),Ve=Ge.exports,Be={name:"Match",mixins:[it],components:{MatchSourcesInfo:ce,MatchTargetsInfo:me,MatchMatchingMethodsInfo:be,MatchResource:$e,MatchCondition:Ve,ConditionsGroup:Ht},props:{match:Object},data(){return{association:"",associationFiles:[],refreshDownloadsInProgress:!1}},computed:{alignment(){return this.$root.alignments.find(t=>t.alignment===this.match.id)},clustering(){return this.$root.clusterings.find(t=>t.alignment===this.match.id)},alignmentStatus(){return this.alignment?this.alignment.status:null},clusteringStatus(){return this.clustering?this.clustering.status:null},running(){return"downloading"===this.alignmentStatus||"running"===this.alignmentStatus||"running"===this.clusteringStatus},status(){let t=null;if(this.alignment)switch(this.alignmentStatus){case"done":t="Matched";break;case"failed":case"waiting":case"downloading":case"running":default:t=`Matching ${this.alignmentStatus}`,"failed"!==this.alignmentStatus&&this.alignment.status_message&&(t+=` (${this.alignment.status_message})`)}let e=null,s=null;if(this.clustering)switch(this.clusteringStatus){case"done":e="Clustered",this.clustering.association&&(s="Reconciled");break;case"failed":case"waiting":case"running":default:this.clustering.association&&(s=`Reconciliation ${this.clusteringStatus}`),this.clustering.clusters_count&&(e="Clustered")}return[t,e,s].filter(t=>null!==t).join(" - ")},downloads(){if("downloading"!==this.alignmentStatus)return[];this.refreshDownloadsInProgress||(this.refreshDownloadsInProgress=!0,this.$emit("refreshDownloadsInProgress"));const t=[];return[...this.match.sources,...this.match.targets].forEach(e=>{const s=this.$root.getResourceById(e),i=s.dataset.dataset_id;t.includes(i)||t.push(i)}),this.$root.downloading.filter(e=>t.includes(e.dataset_id))}},methods:{validateMatch(t=!1){const e=this.validateField("sources",this.match.sources.length>0),s=this.validateField("targets",this.match.targets.length>0),i=this.validateField("sources_select",!this.$refs.sourceResourceComponents.map(t=>t.validateResource()).includes(!1)),o=this.validateField("targets_select",!this.$refs.targetResourceComponents.map(t=>t.validateResource()).includes(!1));let a=!0;this.$refs.matchingMethodGroupComponent&&(a=this.$refs.matchingMethodGroupComponent.validateConditionsGroup()),a=this.validateField("matching-methods",a);let n=!0;if(t&&this.match.match_against){const t=this.$root.alignments.find(t=>t.alignment===this.match.match_against);n=this.validateField("match-against",t&&"done"===t.status)}return e&&s&&i&&o&&a&&n},addMatchCondition(t){t.conditions.push({method_name:"",method_value:{},sources:this.match.sources.reduce((t,e)=>{return t[e]=[{property:[e,""]}],t},{}),targets:this.match.targets.reduce((t,e)=>{return t[e]=[{property:[e,""]}],t},{})})},addMatchResource(t,e){e&&e.target.blur(),this.match[t].push("")},updateConditions(t,e,s,i){t.conditions.forEach(t=>{i?this.$set(t[e],s,[{property:[s,""]}]):this.$delete(t[e],s),t.conditions&&this.updateConditions(t,e,s,i)})},updateMatchResource(t,e,s){const i=this.match[t][e];this.$set(this.match[t],e,s),this.updateConditions(this.match.methods,t,s,!0),this.updateProperties(i,s)},deleteMatchResource(t,e){const s=this.match[t][e];this.match[t].length<1&&this.addMatchResource(t),this.updateConditions(this.match.methods,t,s,!1),this.$delete(this.match[t],e),this.updateProperties(s)},updateProperties(t,e){const s=this.match.sources.find(e=>e===t),i=this.match.targets.find(e=>e===t),o=this.match.properties.findIndex(e=>e[0]===t);o>=0&&!s&&!i&&this.match.properties.splice(o,1),void 0===e||this.match.properties.find(t=>t[0]===e)||this.match.properties.push([e,""])},async runAlignment(t=!1){if(!this.validateMatch(!0))return;const e=await this.$root.runAlignment(this.match.id,t);"exists"===e.result&&confirm("This Alignment job already exists.\nDo you want to overwrite it with the current configuration?")&&await this.runAlignment(!0),this.$emit("refresh")},async killAlignment(){await this.$root.killAlignment(this.match.id),this.$emit("refresh")},async runClustering(){const t=""!==this.association?this.association:null;await this.$root.runClustering(this.match.id,t),this.$emit("refresh")}},async mounted(){this.match.sources.length<1&&this.addMatchResource("sources"),this.match.targets.length<1&&this.addMatchResource("targets"),this.associationFiles=await this.$root.getAssociationFiles()}},Ue=Be,qe=(s("3ba4"),Object(_["a"])(Ue,ie,oe,!1,null,null,null)),He=qe.exports,Je=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("card",{attrs:{id:"clusters_match_"+t.match.id,type:"clusters-matches",label:t.match.label,"has-extra-row":!0,"open-card":t.show},on:{show:function(e){return t.updateShow("open")},hide:function(e){return t.updateShow("close")}},scopedSlots:t._u([{key:"columns",fn:function(){return[s("div",{staticClass:"col"},[s("sub-card",{staticClass:"small",attrs:{"is-first":!0}},[s("div",{staticClass:"row justify-content-center"},[s("div",{staticClass:"col-auto"},[s("div",[s("strong",[t._v("Links: ")]),t._v("\n              "+t._s(t.alignment.links_count.toLocaleString("en"))+"\n\n              "),t.alignment.links_count>t.alignment.distinct_links_count?s("span",{staticClass:"font-italic text-info"},[t._v("\n                ("+t._s(t.alignment.distinct_links_count.toLocaleString("en"))+" distinct links)\n              ")]):t._e()]),t.clustering?s("div",[s("strong",[t._v("Clusters: ")]),t._v("\n              "+t._s(t.clustering.clusters_count.toLocaleString("en"))+"\n            ")]):t._e()]),s("div",{staticClass:"col-auto"},[s("div",[s("strong",[t._v("Resources in source: ")]),t._v("\n              "+t._s(t.alignment.sources_count.toLocaleString("en"))+"\n\n              "),t.alignment.sources_count>t.alignment.distinct_sources_count?s("span",{staticClass:"font-italic text-info"},[t._v("\n                ("+t._s(t.alignment.distinct_sources_count.toLocaleString("en"))+" distinct resources)\n              ")]):t._e()]),s("div",[s("strong",[t._v("Resources in target: ")]),t._v("\n              "+t._s(t.alignment.targets_count.toLocaleString("en"))+"\n\n              "),t.alignment.targets_count>t.alignment.distinct_targets_count?s("span",{staticClass:"font-italic text-info"},[t._v("\n                ("+t._s(t.alignment.distinct_targets_count.toLocaleString("en"))+" distinct resources)\n              ")]):t._e()])]),t.clustering?s("div",{staticClass:"col-auto"},[s("div",[s("strong",[t._v("Extended: ")]),s("strong",[t._v("Yes = ")]),t._v("\n              "+t._s(t.clustering.extended_count?t.clustering.extended_count.toLocaleString("en"):0)+"\n\n              "),s("strong",[t._v("No = ")]),t._v("\n              "+t._s((t.clustering.clusters_count-t.clustering.extended_count).toLocaleString("en"))+"\n            ")]),s("div",[s("strong",[t._v("Cycles: ")]),s("strong",[t._v("Yes = ")]),t._v("\n              "+t._s(t.clustering.cycles_count?t.clustering.cycles_count.toLocaleString("en"):0)+"\n\n              "),s("strong",[t._v("No = ")]),t._v("\n              "+t._s((t.clustering.clusters_count-t.clustering.cycles_count).toLocaleString("en"))+"\n            ")])]):t._e()]),s("div",{staticClass:"row justify-content-center mt-2"},[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"btn-toolbar",attrs:{role:"toolbar","aria-label":"Toolbar"}},[s("div",{staticClass:"btn-group btn-group-toggle mr-4"},[s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showInfo}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showInfo,expression:"showInfo"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showInfo)?t._i(t.showInfo,null)>-1:t.showInfo},on:{change:[function(e){var s=t.showInfo,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,n=t._i(s,a);i.checked?n<0&&(t.showInfo=s.concat([a])):n>-1&&(t.showInfo=s.slice(0,n).concat(s.slice(n+1)))}else t.showInfo=o},t.updateShow]}}),s("fa-icon",{attrs:{icon:"info-circle"}}),t._v("\n                  Show alignment specs\n                ")],1),s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showPropertySelection}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showPropertySelection,expression:"showPropertySelection"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showPropertySelection)?t._i(t.showPropertySelection,null)>-1:t.showPropertySelection},on:{change:[function(e){var s=t.showPropertySelection,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,n=t._i(s,a);i.checked?n<0&&(t.showPropertySelection=s.concat([a])):n>-1&&(t.showPropertySelection=s.slice(0,n).concat(s.slice(n+1)))}else t.showPropertySelection=o},t.updateShow]}}),s("fa-icon",{attrs:{icon:"cog"}}),t._v("\n                  Show property config\n                ")],1)]),s("div",{staticClass:"btn-group btn-group-toggle"},[s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showAllLinks}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showAllLinks,expression:"showAllLinks"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showAllLinks)?t._i(t.showAllLinks,null)>-1:t.showAllLinks},on:{change:[function(e){var s=t.showAllLinks,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,n=t._i(s,a);i.checked?n<0&&(t.showAllLinks=s.concat([a])):n>-1&&(t.showAllLinks=s.slice(0,n).concat(s.slice(n+1)))}else t.showAllLinks=o},function(e){return t.updateShow("links")}]}}),s("fa-icon",{attrs:{icon:"list"}}),t._v("\n                  Overview of all links\n                ")],1),t.clustering?s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showClusters}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showClusters,expression:"showClusters"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showClusters)?t._i(t.showClusters,null)>-1:t.showClusters},on:{change:[function(e){var s=t.showClusters,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,n=t._i(s,a);i.checked?n<0&&(t.showClusters=s.concat([a])):n>-1&&(t.showClusters=s.slice(0,n).concat(s.slice(n+1)))}else t.showClusters=o},function(e){return t.updateShow("clusters")}]}}),s("fa-icon",{attrs:{icon:"list"}}),t._v("\n                  Overview of all clusters\n                ")],1):t._e()])])])])]),t.showInfo?s("alignment-spec",{attrs:{match:t.match}}):t._e(),t.showPropertySelection?s("sub-card",{attrs:{id:"properties_card_"+t.match.id,type:"properties",label:"Property selection","has-margin-auto":!0,"has-columns":!0},scopedSlots:t._u([{key:"columns",fn:function(){return[s("div",{staticClass:"col-auto ml-auto"},[s("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:t.saveProperties}},[t._v("\n              Save\n            ")])])]},proxy:!0}],null,!1,764673623)},[s("div",{staticClass:"mt-4"},t._l(t.match.properties,(function(e,i){return s("property",{key:i,staticClass:"mx-0",attrs:{property:e,singular:!1,"allow-delete":t.match.properties.findIndex((function(t){return t[0]===e[0]}))!==i},on:{clone:function(e){return t.match.properties.splice(i+1,0,[t.match.properties[i][0],""])},delete:function(e){return t.$delete(t.match.properties,i)},resetProperty:function(s){return t.resetProperty(i,e,s)}}})})),1)]):t._e(),t.showClusters&&t.clustering?s("sub-card",{attrs:{label:"Clusters",id:"clusters-list",type:"clusters-list","open-card":t.openClusters,"has-collapse":!0,"has-extra-row":!(t.openClusters||!t.clusterIdSelected||!t.showSelectedCluster)},on:{show:function(e){t.openClusters=!0},hide:function(e){t.openClusters=!1}},scopedSlots:t._u([{key:"columns",fn:function(){return[t.clusterIdSelected?[s("div",{staticClass:"col-auto small ml-auto mr-auto"},[s("strong",[t._v("Selected cluster: ")]),t._v("\n              "+t._s(t.clusterIdSelected)+"\n            ")]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"btn-toolbar",attrs:{role:"toolbar","aria-label":"Toolbar"}},[s("div",{staticClass:"btn-group btn-group-toggle mr-2"},[t.showClusters?s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showSelectedCluster}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showSelectedCluster,expression:"showSelectedCluster"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showSelectedCluster)?t._i(t.showSelectedCluster,null)>-1:t.showSelectedCluster},on:{change:[function(e){var s=t.showSelectedCluster,i=e.target,o=!!i.checked;if(Array.isArray(s)){var a=null,n=t._i(s,a);i.checked?n<0&&(t.showSelectedCluster=s.concat([a])):n>-1&&(t.showSelectedCluster=s.slice(0,n).concat(s.slice(n+1)))}else t.showSelectedCluster=o},t.updateShow]}}),s("fa-icon",{attrs:{icon:"project-diagram"}}),t._v("\n                    Show selected cluster spec\n                  ")],1):t._e()]),s("div",{staticClass:"btn-group btn-group-toggle"},[t.hasProperties?s("button",{staticClass:"btn btn-sm btn-secondary",attrs:{type:"button"},on:{click:function(e){return t.showVisualization("visualize")}}},[s("fa-icon",{attrs:{icon:"project-diagram"}}),t._v("\n                    Visualize\n                  ")],1):t._e(),t.hasProperties?s("button",{staticClass:"btn btn-sm btn-secondary",attrs:{type:"button"},on:{click:function(e){return t.showVisualization("visualize-compact")}}},[s("fa-icon",{attrs:{icon:"project-diagram"}}),t._v("\n                    Visualize compact\n                  ")],1):t._e(),t.hasProperties&&t.clustering.association?s("button",{staticClass:"btn btn-sm btn-secondary",attrs:{type:"button"},on:{click:function(e){return t.showVisualization("visualize-reconciled")}}},[s("fa-icon",{attrs:{icon:"project-diagram"}}),t._v("\n                    Visualize reconciled\n                  ")],1):t._e()])])])]:t._e()]},proxy:!0},!t.openClusters&&t.clusterIdSelected&&t.showSelectedCluster?{key:"row-columns",fn:function(){return[s("div",{staticClass:"col"},[s("cluster",{attrs:{index:0,cluster:t.selectedCluster,selected:!0,selectable:!1}})],1)]},proxy:!0}:null],null,!0)},[s("div",{staticClass:"max-overflow mt-4"},[t._l(t.clusters,(function(e,i){return s("cluster",{attrs:{index:i,cluster:e,selected:t.clusterIdSelected===e.id},on:{"select:clusterId":function(e){return t.selectClusterId(e)}}})})),s("infinite-loading",{attrs:{identifier:t.clustersIdentifier},on:{infinite:t.getClusters},scopedSlots:t._u([{key:"spinner",fn:function(){return[s("loading",{staticClass:"mt-4"})]},proxy:!0},{key:"no-more",fn:function(){return[t._v("\n              No more clusters\n            ")]},proxy:!0}],null,!1,2424642613)})],2)]):t._e()],1)]},proxy:!0}])},[t.showClusters&&t.clustering&&t.clusterIdSelected&&t.hasProperties?s("cluster-visualization",{ref:"visualization",attrs:{matchId:t.match.id,cluster:t.selectedCluster}}):t._e(),t.showLinks?[t._l(t.links,(function(e,i){return s("match-link",{attrs:{index:i,link:e},on:{accepted:function(s){return t.acceptLink(e)},declined:function(s){return t.declineLink(e)}}})})),s("infinite-loading",{attrs:{identifier:t.linksIdentifier},on:{infinite:t.getLinks},scopedSlots:t._u([{key:"spinner",fn:function(){return[s("loading",{staticClass:"mt-4"})]},proxy:!0},{key:"no-more",fn:function(){return[t._v("\n        No more clusters\n      ")]},proxy:!0}],null,!1,1672048693)})]:t._e()],2)},Ye=[],We=s("e166"),Qe=s.n(We),Xe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",t._l(t.propsGrouped,(function(e,i){return s("div",{staticClass:"row flex-nowrap m-0"},[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"property-path btn-sm read-only"},[t._v("\n        "+t._s(i)+"\n      ")])]),s("ul",{staticClass:"col-auto text-info inline-list flex-shrink-1 p-0 mb-0 mt-1"},t._l(e,(function(e){return s("li",[t._v("\n        "+t._s(e)+"\n      ")])})),0)])})),0)},Ze=[],Ke={name:"Properties",props:{properties:Array},computed:{propsGrouped(){return this.properties.reduce((t,e)=>{return t.hasOwnProperty(e.property[1])||(t[e.property[1]]=[]),t[e.property[1]].push(...e.values),t},{})}}},ts=Ke,es=Object(_["a"])(ts,Xe,Ze,!1,null,null,null),ss=es.exports,is=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("sub-card",{staticClass:"match-info",attrs:{label:"Alignment specifications"}},[s("alignment-spec-group-info",{attrs:{"matching-method-group":t.match.methods,"is-root":!0}},[s("p",{staticClass:"font-weight-bold mb-1"},[t._v("\n      Matching\n      "),t.match.match_against?[t._v("\n        against alignment\n        "),s("span",{staticClass:"text-info"},[t._v(t._s(t.matchAgainstLabel))])]:t._e()],2)])],1)},os=[],as=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.matchingMethodGroup.conditions?s("div",{staticClass:"border p-2",class:t.styleClass},[t._t("default"),t._l(t.matchingMethodGroup.conditions,(function(e,i){return[s("alignment-spec-group-info",{key:i,attrs:{"matching-method-group":e}}),i<t.matchingMethodGroup.conditions.length-1?s("p",{staticClass:"font-weight-bold my-2 text-info"},[t._v("\n      "+t._s(t.matchingMethodGroup.type)+"\n    ")]):t._e()]}))],2):s("alignment-spec-condition-info",{class:t.styleClass,attrs:{condition:t.matchingMethodGroup}})},ns=[],rs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border shadow p-2"},[t._l(t.condition.sources,(function(e){return t._l(e,(function(e){return s("div",{staticClass:"row mx-0"},[s("div",{staticClass:"col-auto"},[s("property",{attrs:{property:e.property,"read-only":!0,small:!0}})],1),e.transformers&&e.transformers.length>0?s("p",{staticClass:"font-weight-bold m-0"},[t._v("\n        with transformers "+t._s(e.transformers.join(", "))+"\n      ")]):t._e()])}))})),s("p",{staticClass:"font-weight-bold m-0"},[t._v("against")]),t._l(t.condition.targets,(function(e){return t._l(e,(function(e){return s("div",{staticClass:"row mx-0"},[s("div",{staticClass:"col-auto"},[s("property",{attrs:{property:e.property,"read-only":!0,small:!0}})],1),e.transformers&&e.transformers.length>0?s("p",{staticClass:"font-weight-bold m-0"},[t._v("\n        with transformers\n        "),s("span",{staticClass:"text-info"},[t._v(t._s(e.transformers.join(", ")))])]):t._e()])}))})),s("p",{staticClass:"font-weight-bold m-0"},[t._v("\n    using\n\n    "),s("span",{staticClass:"text-info"},[t._v(t._s(t.methodValueTemplate.label))]),t.methodValueTemplate.items.length>0?[t._v("\n      [ "),s("span",{domProps:{innerHTML:t._s(t.methodValuePropsHumanReadable)}}),t._v(" ]\n    ")]:t._e()],2)],2)},ls=[],cs={name:"AlignmentSpecConditionInfo",data(){return{transformers:De.transformers,matchingMethods:De.matchingMethods}},props:{condition:Object},computed:{methodValueTemplate(){return this.matchingMethods.hasOwnProperty(this.condition.method_name)?this.matchingMethods[this.condition.method_name]:{label:"",items:[]}},methodValuePropsHumanReadable(){return this.methodValueTemplate.items.map(t=>{let e=this.condition.method_value[t.key];return t.choices&&(e=Object.keys(t.choices).find(s=>t.choices[s]===e)),t.label?`<span class="text-info">${t.label} = ${e}</span>`:`<span class="text-info">${e}</span>`}).join(" and ")}}},us=cs,hs=Object(_["a"])(us,rs,ls,!1,null,null,null),ps=hs.exports,ms={name:"AlignmentSpecGroupInfo",components:{AlignmentSpecConditionInfo:ps},props:{isRoot:{type:Boolean,default:!1},matchingMethodGroup:Object},computed:{styleClass(){const t=[];return this.isRoot&&t.push("mt-3"),this.isRoot||this.$parent.styleClass.includes("bg-primary-light")?t.push("bg-info-light","border-info"):t.push("bg-primary-light","border-primary"),t}}},vs=ms,_s=Object(_["a"])(vs,as,ns,!1,null,null,null),fs=_s.exports,gs={name:"AlignmentSpec",components:{AlignmentSpecGroupInfo:fs},props:{match:Object},computed:{matchAgainstLabel(){return this.match.match_against?this.$root.getMatchById(this.match.match_against).label:null}}},bs=gs,ys=(s("e66a"),Object(_["a"])(bs,is,os,!1,null,null,null)),Cs=ys.exports,ws=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border p-3 mb-4",class:[t.bgColor]},[s("div",{staticClass:"row align-items-center flex-nowrap"},[s("div",{staticClass:"col-auto d-flex flex-column align-items-center"},[s("div",{staticClass:"col-auto"},[s("span",{staticClass:"font-weight-bold font-italic"},[t._v("# "+t._s(t.index+1))])]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"btn btn-sm bg-info-light border border-info text-info read-only m-1"},[s("span",{staticClass:"font-weight-bold"},[t._v("Max strength")]),s("br"),t._v("\n          "+t._s(Math.max.apply(Math,t.link.strengths).toFixed(3))+"\n        ")])])]),s("div",{staticClass:"col"},[s("div",{staticClass:"text-break-all"},[s("span",{staticClass:"font-weight-bold"},[t._v("Source URI:")]),s("span",{staticClass:"text-info"},[t._v("\n          "+t._s(t.link.source)+"\n        ")]),s("button",{staticClass:"btn btn-sm ml-2",attrs:{type:"button"},on:{click:t.copySourceUriToClipboard}},[s("fa-icon",{attrs:{icon:"copy"}})],1)]),s("div",{staticClass:"text-break-all"},[s("span",{staticClass:"font-weight-bold"},[t._v("Target URI:")]),s("span",{staticClass:"text-info"},[t._v("\n          "+t._s(t.link.target)+"\n        ")]),s("button",{staticClass:"btn btn-sm ml-2",attrs:{type:"button"},on:{click:t.copyTargetUriToClipboard}},[s("fa-icon",{attrs:{icon:"copy"}})],1)]),t.sourceProperties.length>0||t.targetProperties.length>0?s("div",{staticClass:"row flex-nowrap border-top mt-2 pt-2"},[s("div",{staticClass:"col"},[s("div",{staticClass:"font-weight-bold mb-2"},[t._v("Source properties:")]),s("properties",{attrs:{properties:t.sourceProperties,"show-resource-info":!1}})],1),s("div",{staticClass:"col"},[s("div",{staticClass:"font-weight-bold mb-2"},[t._v("Target properties:")]),s("properties",{attrs:{properties:t.targetProperties,"show-resource-info":!1}})],1)]):t._e()]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row flex-column align-items-center"},[s("div",{staticClass:"col-auto"},[s("button",{staticClass:"btn btn-sm btn-success m-1",attrs:{type:"button"},on:{click:function(e){return t.$emit("accepted")}}},[s("fa-icon",{attrs:{icon:"check"}}),t._v("\n            Accept\n          ")],1)]),s("div",{staticClass:"col-auto"},[s("button",{staticClass:"btn btn-sm btn-danger m-1",attrs:{type:"button"},on:{click:function(e){return t.$emit("declined")}}},[s("fa-icon",{attrs:{icon:"times"}}),t._v("\n            Decline\n          ")],1)])])])])])},xs=[],ks={name:"MatchLink",components:{Properties:ss},props:{index:Number,link:Object},computed:{bgColor(){return!0===this.link.valid?"bg-success":!1===this.link.valid?"bg-danger":"bg-white"},sourceProperties(){return this.link.source_values?this.link.source_values.map(t=>{return{property:[this.$root.getResourceByDatasetId(t.dataset).id,t.property],values:t.values}}):[]},targetProperties(){return this.link.target_values?this.link.target_values.map(t=>{return{property:[this.$root.getResourceByDatasetId(t.dataset).id,t.property],values:t.values}}):[]}},methods:{async copySourceUriToClipboard(){await navigator.clipboard.writeText(this.source)},async copyTargetUriToClipboard(){await navigator.clipboard.writeText(this.target)}}},$s=ks,Ss=Object(_["a"])($s,ws,xs,!1,null,null,null),Is=Ss.exports,js=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border p-3 mb-2",class:[{clickable:t.selectable},t.selected?"bg-info-light":"bg-primary-light"],on:{click:function(e){t.selectable&&t.$emit("select:clusterId",t.cluster.id)}}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-info"},[s("strong",[t._v(t._s(t.cluster.id))])]),s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("strong",[t._v("Size: ")]),t._v("\n          "+t._s(t.cluster.size.toLocaleString("en"))+"\n        ")]),s("div",{staticClass:"col"},[s("strong",[t._v("Extended: ")]),s("span",{class:"ext_"+t.cluster.extended},[t._v(t._s(t.cluster.extended))])])]),s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("strong",[t._v("Links: ")]),t._v("\n          "+t._s(t.cluster.links.toLocaleString("en"))+"\n        ")]),s("div",{staticClass:"col"},[s("strong",[t._v("Reconciled: ")]),s("span",{class:"ext_"+t.cluster.reconciled},[t._v(t._s(t.cluster.reconciled))])])])]),s("div",{staticClass:"col-8"},[s("properties",{attrs:{properties:t.props,"show-resource-info":!1}})],1)])])},As=[],Rs={name:"Cluster",components:{Properties:ss},props:{index:Number,cluster:Object,selected:!1,selectable:{type:Boolean,default:!0}},computed:{props(){return this.cluster.values?this.cluster.values.map(t=>{return{property:[this.$root.getResourceByDatasetId(t.dataset).id,t.property],values:t.values}}):[]}}},Ps=Rs,Ms=(s("fdbe"),Object(_["a"])(Ps,js,As,!1,null,null,null)),Es=Ms.exports,Ls=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{ref:"visualization",attrs:{id:"visualization",size:"xl","dialog-class":"modal-full-size","hide-footer":"",static:""},scopedSlots:t._u([{key:"modal-header",fn:function(e){var i=e.close;return[s("h5",{staticClass:"modal-title"},[t._v(t._s(t.label))]),"visualize-compact"===t.show?s("cluster-visualization-compact-info"):"visualize-reconciled"===t.show?s("cluster-visualization-reconciled-info"):s("cluster-visualization-info"),s("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:function(t){return i()}}},[t._v("×")])]}}])},[s("div",{staticClass:"plot"})])},Ts=[],Os=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"CLUSTER VISUALIZATION"}},[s("div",{staticClass:"text-left"},[s("div",{staticClass:"h2"},[t._v("Identity Link Network (ILN)")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      This provides additional information of Identity Link Clusters:\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[t._v("Identity Link Clusters.")]),s("li",[t._v("Visualize a cluster and interact with it.")]),s("li",[t._v("An improved visualisation (particularly important for large clusters).")]),s("li",[t._v("Reconcile a cluster using additional information such relation.")])]),s("div",{staticClass:"h3 pt-4"},[t._v("An ILN of "),s("strong",[t._v("Meulder Hans")]),t._v(" in the Turtle Language")]),s("p",{staticClass:"h5 pt-4 pb-4 pl-5"},[t._v("\n      This is an example of links discovered using an approximate string similarity on\n      "),s("strong",[t._v("Ecartico")]),t._v(", "),s("strong",[t._v("Baptism")]),t._v(", "),s("strong",[t._v("Marriage")]),t._v(" and\n      "),s("strong",[t._v("Burial")]),t._v(" for married Amsterdammers between 1600 and 1650. These links are\n      specifically the ones that link different occurrences of "),s("strong",[t._v("Meulder Hans")]),t._v(".\n    ")]),s("textarea",{staticClass:"ml-5 mb-1",attrs:{disabled:"",cols:"75",rows:"18"}},[t._v("      @prefix baptism: <http://goldenagents.org/uva/SAA/person/IndexOpDoopregister/> .\n      @prefix ecartico: <http://www.vondel.humanities.uva.nl/ecartico/persons/> .\n      @prefix marriage: <http://goldenagents.org/uva/SAA/person/IndexOpOndertrouwregister/> .\n      @prefix owl: <http://www.w3.org/2002/07/owl#> .\n\n      baptism:saaId24678323p2 owl:sameAs ecartico:15747 .\n      baptism:saaId24678323p2 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24519437p2 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24285260p2 owl:sameAs baptism:saaId24519437p2 .\n      marriage:saaId26379331p1 owl:sameAs ecartico:15747 .\n      baptism:saaId24519437p2 owl:sameAs ecartico:15747 .\n      baptism:saaId24519437p2 owl:sameAs marriage:saaId26377774p1 .\n      baptism:saaId24285260p2 owl:sameAs ecartico:15747 .\n      baptism:saaId24285260p2 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24519437p2 owl:sameAs baptism:saaId24678323p2 .\n      marriage:saaId26377774p1 owl:sameAs ecartico:15747 .\n      marriage:saaId26377774p1 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24285260p2 owl:sameAs baptism:saaId24678323p2 .\n    ")]),s("div",{staticClass:"h3 pt-4"},[t._v("Visualizing an ILN of "),s("strong",[t._v("Meulder Hans")])]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      The cluster of "),s("strong",[t._v("Meulder Hans")]),t._v(" is composed of 6 nodes (potentially the same person)\n      using 13 link. The links in plain black represent an exact match (link strength = 1) while those in\n      dotted red represent a link of strength below 1. The color of the node depicts the data-source it is\n      stemmed from. So in this real example cluster,\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[t._v("Three nodes are from "),s("strong",[t._v("Baptism")]),t._v(";")]),s("li",[t._v("Two nodes are from "),s("strong",[t._v("Marriage")]),t._v(" and;")]),s("li",[t._v("One is from "),s("strong",[t._v("Ecartico")]),t._v(".")])]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/1 Meulder Hans (Cluster).jpg",width:"700",height:"600"}})])])])},Ns=[],Ds={},Fs=Object(_["a"])(Ds,Os,Ns,!1,null,null,null),zs=Fs.exports,Gs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"CLUSTER VISUALIZATION"}},[s("div",{staticClass:"text-left"},[s("div",{staticClass:"h3"},[t._v("A Compact Representation of Meulder Hans' ILN")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      The compact representation of a cluster allows for the display of large clusters and a comprehensive\n      aggravation of nodes. The approach groups nodes base on similar link strength starting from the\n      highest strength in the identity network. From the original cluster, two sub-groups of nodes can be\n      identified using the link strength of 1 (black plain link) together.\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[t._v("Sub-group-1: Two nodes are linked with strength 1")]),s("li",[t._v("Sub-group-2: Three nodes are linked with strength 1")]),s("li",[t._v("Sub-group-3: One isolated node")])]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      The subgroups are then interconnected using an aggregated link represented by the highest strength.\n      Using such approach sub-groups and their interconnections are now clearly visible.\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      Each compact node contains 3 type of information:\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[s("strong",[t._v("N")]),t._v(" indicating the number of nodes aggregated by the compact node.")]),s("li",[s("strong",[t._v("L")]),t._v(" indicating the number of links.")]),s("li",[s("strong",[t._v("S")]),t._v(" indicating the strength of the links that enabled the aggregation.")]),s("li",[t._v("The last information (not present in this example but visible in the second compact example of\n        size 35) removes a percentage of the node's color to indicate the number of missing links for the\n        number of nodes aggregated\n      ")])]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/1 Meulder Hans (Cluster).jpg",width:"700"}}),s("p",{staticClass:"h5 pt-4 pl-5 font-weight-bold"},[t._v("\n        Original Cluster\n      ")])]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/2 Meulder Hans (Cluster-Compact).jpg",width:"700"}}),s("p",{staticClass:"h5 pt-4 pl-5 font-weight-bold"},[t._v("\n        Compact Cluster\n      ")])]),s("div",{staticClass:"h3 pt-4"},[t._v("Large ILN Versus its Compact Version")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      This is an example of a bigger cluster of size 35 potentially representing "),s("strong",[t._v("Pieterss\n      Grietje")]),t._v(". The larger an ILN gets, the less comprehensive it is visually. Especially when it\n      highlight a mesh topology. For this very reason, the compact version of the visual ILN is of\n      importance for visual aid for validation purposes.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/1  Pieters Grietje (Cluster).jpg",width:"800"}})]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      This is the compact version of a cluster of size 35 potentially representing "),s("strong",[t._v("Pieterss\n      Grietje")]),t._v(". In this examople, 35 nodes are now converted into 4 compact nodes of size 25, 3, 2\n      and two. The last two nodes are of size one. The compact node of size 25 is composed of 294 limks\n      insted of 300. Meaning 6 links are missing.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/2  Pieters Grietje (Cluster-Compact).jpg",width:"800"}})]),s("div",{staticClass:"h3 pt-5"},[t._v("Expanding a Compact Node with Double-Click")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      For a better validation experience, each of the compact nodes can be expanded. This allows a\n      detailed understanding on the type of network (START - LINE - MESH) that defines the aggragated\n      node. When a compact node (sub-cluster) is double-clicked, for example the one of size 3, it is\n      highlighted in red as shown in on the left side the figure below, and its expanded version is\n      ploted, as shown in the right side of the figure.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/3 Meulder Hans (Cluster-Compact Selected).jpg",width:"1000"}})])])])},Vs=[],Bs={},Us=Object(_["a"])(Bs,Gs,Vs,!1,null,null,null),qs=Us.exports,Hs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"RECONCILED CLUSTER VISUALIZATION"}},[s("div",{staticClass:"text-left"},[s("div",{staticClass:"h2"},[t._v("Reconciling an ILN")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      We enable the reconciliation of an ILN using relations between discovered ILN. For the current\n      example, the relation used is the marital status meaning married people. In this example, the ILN to\n      reconcile is the one of "),s("strong",[t._v("Meulder Hans")]),t._v(". It is the one in "),s("strong",[t._v("blue")]),t._v(" and it\n      connect to two other clusters using purple dotted lines. Reading the graph, the other two clusters\n      indicate that "),s("strong",[t._v("Meulder Hans")]),t._v(" appears to be connected to two women: **Petsinck\n      Catharina (orange)"),s("strong",[t._v(" and ")]),t._v("Jans Fijtje (green)**.\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      We provide two representation where the first picture presents a compact representation of all\n      clusters while the second representation presents a non compact representation of the investigated\n      cluster: "),s("strong",[t._v("Meulder Hans")]),t._v(".\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      Now, given this additional marital status, is it plausible that all nodes representing "),s("strong",[t._v("Meulder\n      Hans")]),t._v(" are indeed representing the same person?\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      To answer this questions, we make use of the existence of "),s("strong",[t._v("cycle")]),t._v(" to materialise\n      strong evidence.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/4 Meulder Hans (Cluster-Compact Compact-Evidence).jpg",width:"900"}})]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/5 Meulder Hans (Cluster-Compact Evidence).jpg",width:"900"}})]),s("div",{staticClass:"h2 pt-4"},[t._v("Reconciled Nodes")])])])},Js=[],Ys={},Ws=Object(_["a"])(Ys,Hs,Js,!1,null,null,null),Qs=Ws.exports,Xs=s("5698");const Zs=Xs["h"](Xs["i"]),Ks=t=>16*Math.log2(t+1),ti=t=>t.nodes?Ks(t.nodes)+2:1.2*t.size;function ei(t,e){const s=Xs["j"](t),i=s.select("canvas").size()?s.select("canvas"):s.append("canvas"),o=i.node().getContext("2d");let a,n,r,l;const c=t=>n||e,d=t=>r&&r===t,u=t=>l&&l===t;m(),window.addEventListener("resize",m);const h=Xs["f"]().force("link",Xs["d"]().id(t=>t.id).distance(t=>{return t.dist_factor?Ks(t.dist_factor[0])+Ks(t.dist_factor[1])+.8*t.distance:t.distance})).force("charge",Xs["e"]()).force("center",Xs["c"](a.width/2,a.height/2)),p=Xs["a"]().subject(f).on("start",k).on("drag",$).on("end",S);function m(){i.attr("width",0).attr("height",0),a=s.node().getBoundingClientRect(),i.attr("width",a.width).attr("height",a.height),_()}function v(){h.nodes(c().nodes).on("tick",_),h.force("link").links(c().links)}function _(){o.save(),o.clearRect(0,0,a.width,a.height),o.fillStyle="#FFFFE0",o.fillRect(0,0,a.width,a.height),o.fill(),c().links.forEach(t=>g(t)),c().nodes.forEach(t=>b(t)),o.restore()}function f(t){const e=t?t[0]:Xs["b"].x,s=t?t[1]:Xs["b"].y;return c().nodes.find(t=>{const i=e-t.x,o=s-t.y,a=ti(t);return i*i+o*o<a*a})}function g(t){o.beginPath(),o.moveTo(t.source.x,t.source.y),o.lineTo(t.target.x,t.target.y),o.lineWidth=Math.sqrt(t.value)+1,o.strokeStyle=t.strength<1?"red":t.color||"black",o.setLineDash(t.dash?t.dash.split(","):[3,20*(1-t.strength)]),o.stroke()}function b(t){y(t),C(t),w(t),x(t)}function y(t){t.investigated&&(t.nodes||t.size>5)&&(o.beginPath(),o.arc(t.x,t.y,ti(t),0,2*Math.PI),o.fillStyle="white",o.lineWidth=4,o.strokeStyle=d(t)||u(t)?"red":"black",o.setLineDash(t.satellite?[10,3]:[10,0]),o.stroke(),o.fill())}function C(t){o.beginPath();const e=t.nodes?Ks(t.nodes):t.size||5;o.arc(t.x,t.y,e,0,2*Math.PI),o.fillStyle=d(t)?"red":Zs(t.group),o.lineWidth=2,o.strokeStyle=t.investigated||!t.nodes&&t.size>5?"white":"black",o.setLineDash(t.satellite?[10,3]:[10,0]),o.stroke(),o.fill()}function w(t){if(!t.missing_links)return;o.beginPath(),o.moveTo(t.x,t.y);const e=t.nodes?.7*Ks(t.nodes):0;o.arc(t.x,t.y,e,0,2*Math.PI*-t.missing_links,!0),o.fillStyle="white",o.lineTo(t.x,t.y),o.fill()}function x(t){const e="12px sans-serif";o.fillStyle="black";const s=t.x+.9*(t.nodes?Ks(t.nodes):t.size)+8;if(o.font=e,o.fillText(t.label||t.id,s,t.y+3),t.nodes){const s=t.x+(t.nodes>2?-Ks(t.nodes)/3:-10);if(o.font="bold "+e,o.fillText("N:"+t.nodes,s,t.y+3),t.nodes>2){const s=t.nodes*(t.nodes-1)/2,i=t.missing_links>0?"L:"+Math.round(s*(1-t.missing_links))+"/"+s:"L:"+s,a=t.x+-Ks(t.nodes)/3;o.font=e,o.fillText(i,a,t.y+15)}if(t.strength&&t.nodes>1){const s=Number.parseFloat(String(t.strength))?"S:"+Math.round(1e3*t.strength)/1e3:"S:"+t.strength;o.font="bold "+e,o.fillText(s,t.x-8,t.y+Ks(t.nodes)+13)}}}function k(){Xs["b"].active||h.alphaTarget(.2).restart(),Xs["b"].subject.fx=Xs["b"].x,Xs["b"].subject.fy=Xs["b"].y}function $(){Xs["b"].subject.fx=Xs["b"].x,Xs["b"].subject.fy=Xs["b"].y}function S(){Xs["b"].active||h.alphaTarget(0)}function I(){const t=Xs["g"](this),e=f(t);e&&(n=e.child,v())}i.call(p),i.on("dblclick",I),v()}var si={name:"ClusterVisualization",components:{ClusterVisualizationInfo:zs,ClusterVisualizationCompactInfo:qs,ClusterVisualizationReconciledInfo:Qs},data(){return{show:null,clusterGraph:null,clusterGraphCompact:null,reconciliationGraph:null}},props:{matchId:Number,cluster:Object},computed:{label(){switch(this.show){case"visualize-compact":return"Visualization of Compact Cluster";case"visualize-reconciled":return"Visualization of Reconciled Cluster";case"visualize":default:return"Visualization of Cluster"}}},methods:{showVisualization(t){this.show=t,this.$refs.visualization.show(),this.$refs.visualization.$on("shown",t=>this.drawShown())},draw(t){ei(".plot",t)},async getGraphData(t){const e=await this.$root.getClusterGraphs(this.matchId,this.cluster.id,"cluster"===t,"yes"===this.cluster.extended);this.clusterGraph=e.cluster_graph,this.clusterGraphCompact=e.cluster_graph_compact,this.reconciliationGraph=e.reconciliation_graph,this.drawShown()},drawShown(){switch(this.show){case"visualize-compact":this.clusterGraphCompact&&this.draw(this.clusterGraphCompact);break;case"visualize-reconciled":this.reconciliationGraph&&this.draw(this.reconciliationGraphDrawn);break;case"visualize":default:this.clusterGraph&&this.draw(this.clusterGraph)}}},mounted(){this.cluster&&this.getGraphData()},watch:{cluster(){this.getGraphData()}}},ii=si,oi=(s("6119"),Object(_["a"])(ii,Ls,Ts,!1,null,"7484c1a2",null)),ai=oi.exports,ni={name:"MatchValidation",components:{InfiniteLoading:Qe.a,Properties:ss,AlignmentSpec:Cs,MatchLink:Is,Cluster:Es,ClusterVisualization:ai},data(){return{show:!1,showInfo:!1,showPropertySelection:!1,showSelectedCluster:!1,showAllLinks:!1,showClusters:!1,links:[],linksIdentifier:+new Date,clusters:[],clustersIdentifier:+new Date,openClusters:!0,clusterIdSelected:null,clusterView:""}},props:{match:Object},computed:{hasProperties(){return!this.match.properties.map(t=>""!==t[1]).includes(!1)},alignment(){return this.$root.alignments.find(t=>t.alignment===this.match.id)},clustering(){const t=this.$root.clusterings.find(t=>t.alignment===this.match.id);return t&&"done"===t.status?t:null},showLinks(){return this.showAllLinks||this.showClusterLinks},showClusterLinks(){return this.showClusters&&this.clusterIdSelected},selectedCluster(){return this.clusterIdSelected?this.clusters.find(t=>t.id===this.clusterIdSelected):null}},methods:{updateShow(t){const e=this.showInfo||this.showPropertySelection||this.showAllLinks||this.showClusters;"open"!==t||e?"close"===t&&e&&(this.showInfo=!1,this.showPropertySelection=!1,this.showSelectedCluster=!1,this.showAllLinks=!1,this.showClusters=!1):this.showInfo=!0,this.show!==e&&(this.show=e),"links"===t&&this.showClusters?(this.showSelectedCluster=!1,this.showClusters=!1):"clusters"===t&&this.showAllLinks&&(this.showSelectedCluster=!0,this.showAllLinks=!1),(this.showAllLinks||this.showClusters)&&this.resetLists()},resetLists(){this.showClusters&&this.clustering&&0===this.clusters.length?(this.links=[],this.linksIdentifier+=1):this.showClusters&&this.clustering||0!==this.links.length||(this.clusters=[],this.clustersIdentifier+=1)},selectClusterId(t){this.clusterIdSelected=t,this.openClusters=!1,this.links=[],this.linksIdentifier+=1},showVisualization(t){this.$refs.visualization.showVisualization(t)},async saveProperties(){await this.$root.submit(),this.resetLists()},async getLinks(t){const e=this.showClusterLinks?this.clusterIdSelected:void 0,s=await this.$root.getAlignment(this.match.id,e,50,this.links.length);this.links.push(...s),t&&(s.length>0?t.loaded():t.complete())},async getClusters(t){if(!this.clustering)return;const e=await this.$root.getClusters(this.match.id,this.clustering.association,5,this.clusters.length);this.clusters.push(...e),t&&(e.length>0?t.loaded():t.complete())},async acceptLink(t){const e=!0!==t.valid||null;t.valid=e,await this.$root.validateLink(this.match.id,t.source,t.target,e)},async declineLink(t){const e=!1===t.valid&&null;t.valid=e,await this.$root.validateLink(this.match.id,t.source,t.target,e)},resetProperty(t,e,s){const i=e.slice(0,s);i.push(""),i.length%2>0&&i.push(""),this.$set(this.match.properties,t,i)}}},ri=ni,li=Object(_["a"])(ri,Je,Ye,!1,null,null,null),ci=li.exports,di=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row align-items-center justify-content-between"},[s("div",{staticClass:"col-auto"},[s("h2",[t._v(t._s(t.title))])]),t._t("header")],2),t._t("default"),s("b-alert",{staticClass:"mt-4 mb-0",attrs:{show:t.isSaved&&""!==t.tabError,variant:"warning"}},[t._v("\n    Successfully saved, but with errors:\n    "+t._s(t.tabError)+"\n  ")]),s("b-alert",{staticClass:"mt-4 mb-0",attrs:{show:!t.isSaved&&""!==t.tabError,variant:"danger"}},[t._v("\n    "+t._s(t.tabError)+"\n  ")])],2)},ui=[],hi={name:"TabContentStructure",props:{title:String,tabError:String,isSaved:Boolean}},pi=hi,mi=Object(_["a"])(pi,di,ui,!1,null,null,null),vi=mi.exports,_i={name:"App",mixins:[it],components:{Draggable:Mt.a,TabContentStructure:vi,Research:Dt,Resource:se,Match:He,MatchValidation:ci},data(){return{tabError:"",researchForm:"",idToLoad:"",jobId:"",jobTitle:"",jobDescription:"",jobLink:"",isSaved:!0,isUpdating:!1,isDownloading:!1,steps:["research","collections","alignments","validation","export"]}},computed:{hasChanges(){return!Boolean(this.$root.job)||JSON.stringify(this.$root.resources)!==JSON.stringify(this.$root.job["resources_form_data"])||JSON.stringify(this.$root.matches)!==JSON.stringify(this.$root.job["mappings_form_data"])},matchesWithResults(){return this.$root.matches.filter(t=>{return this.$root.alignments.find(e=>{return e.alignment===t.id&&"done"===e.status&&e.distinct_links_count>0})})}},methods:{isTabValid(t,e,s){return this.tabError=t?"":s,this.isSaved=e,!!t},validateResearchTab(){return this.isTabValid(this.$root.job,!1,"Please update or create your research first!")},validateCollectionsTab(t=!1){const e=this.$refs.resourceComponents.map(t=>t.validateResource()),s=e.includes(!1)?this.isTabValid(!1,t,"One or more resources contain errors!"):this.isTabValid(this.$root.resources.length>0,!1,"Please add at least one resource!");return(s||t)&&this.submit(),s},validateAlignmentsTab(t=!1){const e=this.$refs.matchComponents.map(t=>t.validateMatch()),s=e.includes(!1)?this.isTabValid(!1,t,"One or more alignments contain errors!"):this.isTabValid(this.$root.matches.length>0,!1,"Please add at least one alignment!");return(s||t)&&this.submit(),s},validateAndSave(t){switch(t){case 1:return this.validateCollectionsTab(!0);case 2:return this.validateAlignmentsTab(!0);default:return!1}},activateStep(t,e=!1){const s=this.steps.indexOf(t);if(s<0||"undefined"===typeof this.$refs.formWizard.tabs[s])return!1;for(let i=0;i<=s;i++)this.$set(this.$refs.formWizard.tabs[i],"checked",!0);this.$set(this.$refs.formWizard,"maxStep",s),e&&this.$refs.formWizard.changeTab(this.$refs.formWizard.activeTabIndex,s)},addResource(t){t&&t.target.blur(),this.$root.addResource()},addMatch(t){t&&t.target.blur(),this.$root.addMatch()},duplicateResource(t){this.$root.duplicateResource(t)},duplicateMatch(t){this.$root.duplicateMatch(t)},async createJob(t){const e=await this.$root.createJob(t);this.setJobId(e)},async updateJob(t){this.isUpdating=!0,await this.$root.updateJob(t),await this.getJobData(),this.isUpdating=!1},async setJobId(t){this.jobId=t;const e=new URL(window.location.href);e.searchParams.set("job_id",t),window.history.pushState(null,null,e.href),await this.getJobData()},async submit(){await this.$root.submit(),await this.getJobData()},async getJobData(){""!==this.jobId&&(await this.$root.loadJob(this.jobId),this.$root.job&&(this.jobTitle=this.$root.job.job_title,this.jobDescription=this.$root.job.job_description,this.jobLink=this.$root.job.job_link,this.activateStep("collections"),0===this.$root.resources.length&&this.$root.addResource(),0===this.$root.matches.length?this.$root.addMatch():this.activateStep("alignments"),this.refresh()))},async refresh(t=!1){t&&await Promise.all([this.$root.loadAlignments(),this.$root.loadClusterings()]);let e=!1,s=!1;this.$root.alignments.forEach(t=>{"done"===t.status&&t.distinct_links_count>0?e=!0:"done"!==t.status&&"failed"!==t.status&&(s=!0)}),this.$root.clusterings.forEach(t=>{"done"!==t.status&&"failed"!==t.status&&(s=!0)}),e&&(this.activateStep("validation"),this.activateStep("export")),s&&setTimeout(()=>{Promise.all([this.$root.loadAlignments(),this.$root.loadClusterings()]).then(()=>this.refresh())},2e3)},async refreshDownloadsInProgress(t=!1){t&&this.isDownloading||(this.isDownloading=!0,await this.$root.loadDownloadsInProgress(),this.$root.downloading.length>0?setTimeout(t=>this.refreshDownloadsInProgress(),2e3):this.isDownloading=!1)}},mounted(){const t=new URLSearchParams(window.location.search),e=t.get("hsid");if(e)return void window.opener.postMessage({"timbuctoo-hsid":e});const s=t.get("job_id");s&&(this.jobId=s,this.researchForm="existing",this.getJobData()),this.refreshDownloadsInProgress()}},fi=_i,gi=Object(_["a"])(fi,At,Rt,!1,null,null,null),bi=gi.exports,yi=s("6821"),Ci=s.n(yi),wi={data(){return{job:null,alignments:[],clusterings:[],resources:[],matches:[],datasets:{},downloaded:[],downloading:[]}},methods:{getDatasets(t,e){const s=t&&e?t+":"+e:t;return this.datasets.hasOwnProperty(s)?this.datasets[s]:{}},addResource(){this.resources.unshift({id:$i(this.resources),description:"",dataset:{timbuctoo_graphql:"https://repository.goldenagents.org/v5/graphql",timbuctoo_hsid:null,dataset_id:"",collection_id:"",published:!0},filter:{type:"AND",conditions:[]},limit:-1,related:[],related_array:!1})},addMatch(){this.matches.unshift({id:$i(this.matches),description:"",is_association:!1,label:"Alignment "+(this.matches.length+1),sources:[],targets:[],properties:[],match_against:null,methods:{type:"AND",conditions:[]}})},duplicateResource(t){const e=this.resources.findIndex(e=>e.id===t.id),s=$i(this.resources),i=xi(t),o={...i,id:s,label:void 0};Si(o.filter.conditions).forEach(t=>t.property[0]=s),this.resources.splice(e,0,o)},duplicateMatch(t){const e=this.matches.findIndex(e=>e.id===t.id),s=xi(t);this.matches.splice(e,0,{...s,id:$i(this.matches),label:"Alignment "+(this.matches.length+1)})},getResourceById(t,e=this.resources){return e.find(e=>ki(t)&&e.id===parseInt(t)||e.label===t)},getResourceByDatasetId(t,e=this.resources){return e.find(e=>e.dataset.dataset_id===t)},getMatchById(t,e=this.matches){return e.find(e=>ki(t)&&e.id===parseInt(t)||e.label===t)},createTargetsForProperties(t){return t.reduce((t,e)=>{if(2===e.length&&""===e[1])return t;const s=this.getResourceById(e[0]);let i=t.find(t=>t.graph===s.dataset.dataset_id);i||(i={graph:s.dataset.dataset_id,data:[]},t.push(i));let o=i.data.find(t=>t.entity_type===s.dataset.collection_id);return o||(o={entity_type:s.dataset.collection_id,properties:[]},i.data.push(o)),"__value__"===e[e.length-1]?o.properties.push(e.slice(1,-1)):"__value__"===e[e.length-2]?o.properties.push(e.slice(1,-2)):o.properties.push(e.slice(1)),t},[])},createReferencesForProperty(t,e){const s=this.getResourceById(t[0],e);if(t[0]=s.label,t.length<3)return t;if("__value__"===t[2])return t.slice(0,2);const i={label:Ci()(t[0]+t[1]+t[2]),dataset:{timbuctoo_graphql:s.dataset.timbuctoo_graphql,timbuctoo_hsid:s.dataset.timbuctoo_hsid,dataset_id:s.dataset.dataset_id,collection_id:t[2],published:s.dataset.published},related:[]};e.find(t=>t.label===i.label)||e.push(i);const o={resource:i.label,local_property:t[1],remote_property:"uri"};s.related.find(t=>JSON.stringify(t)===JSON.stringify(o))||s.related.push(o),s.related.length>1&&(s.related_array=!0);const a=[i.label,t[3],...t.slice(4)];return this.createReferencesForProperty(a,e)},async submit(){const t=xi(this.resources),e=xi(this.matches);e.forEach(e=>{["sources","targets"].forEach(t=>{e[t].forEach((s,i)=>{ki(s)&&(e[t][i]=this.getResourceById(s).label)})}),Si(e.methods.conditions).forEach(e=>{["sources","targets"].forEach(s=>{Object.keys(e[s]).forEach(i=>{e[s][i].forEach((o,a)=>{e[s][i][a].property=this.createReferencesForProperty(o.property,t)}),e[s][this.getResourceById(i).label]=e[s][i],delete e[s][i]})})}),e.value_targets=this.createTargetsForProperties(e.properties),delete e.properties}),t.forEach(e=>{e.filter&&e.filter.conditions&&e.filter.conditions.length>0?Si(e.filter.conditions).forEach(e=>{e.property=this.createReferencesForProperty(e.property,t)}):delete e.filter}),t.forEach(t=>{t.related&&(t.related.forEach(t=>{ki(t.resource)&&(t.resource=this.getResourceById(t.resource).label),t.local_property=[t.local_property],t.remote_property=[t.remote_property]}),t.related_array&&(t.related=[t.related])),delete t.related_array,delete t.id}),await this.updateJob({job_id:this.job.job_id,job_title:this.job.job_title,job_description:this.job.job_description,job_link:this.job.job_link,resources:t,matches:e,resources_original:this.resources,matches_original:this.matches})},async loadJob(t){const e=await Ii("/job/"+t);if(e.created_at=e.created_at?new Date(e.created_at):null,e.updated_at=e.updated_at?new Date(e.updated_at):null,this.job=e,this.job.resources_form_data){this.job.resources_form_data.forEach(t=>{t.hasOwnProperty("dataset_id")&&t.hasOwnProperty("collection_id")&&(t.dataset={timbuctoo_graphql:"https://repository.goldenagents.org/v5/graphql",timbuctoo_hsid:null,dataset_id:t.dataset_id,collection_id:t.collection_id,published:!0},delete t.dataset_id,delete t.collection_id)});const t=xi(this.job.resources_form_data),e=t.map(t=>({endpoint:t.dataset.timbuctoo_graphql,hsid:t.dataset.timbuctoo_hsid})).sort((t,e)=>{return t.hsid&&!e.hsid?-1:e.hsid&&!t.hsid?1:0}).filter((t,e,s)=>s.find(e=>e.endpoint===t.endpoint));await Promise.all(e.map(t=>this.loadDatasets(t.endpoint,t.hsid))),this.resources=t}this.job.mappings_form_data&&(this.matches=xi(this.job.mappings_form_data)),await Promise.all([this.loadAlignments(),this.loadClusterings()])},async loadAlignments(){const t=await Ii(`/job/${this.job.job_id}/alignments`);t.forEach(t=>{t.requested_at=t.requested_at?new Date(t.requested_at):null,t.processing_at=t.processing_at?new Date(t.processing_at):null,t.finished_at=t.finished_at?new Date(t.finished_at):null}),this.alignments=t},async loadClusterings(){const t=await Ii(`/job/${this.job.job_id}/clusterings`);t.forEach(t=>{t.requested_at=t.requested_at?new Date(t.requested_at):null,t.processing_at=t.processing_at?new Date(t.processing_at):null,t.finished_at=t.finished_at?new Date(t.finished_at):null}),this.clusterings=t},async createJob(t){const e=await Ii("/job/create/",t);return e.job_id},async updateJob(t){await Ii("/job/update/",t)},async runAlignment(t,e){return await this.submit(),Ii(`/job/${this.job.job_id}/run_alignment/${t}`,{restart:e})},async killAlignment(t){return Ii(`/job/${this.job.job_id}/kill_alignment/${t}`,{})},async getAlignment(t,e,s,i=0){const o=[];return e&&o.push(`cluster_id=${e}`),s&&o.push(`limit=${s}`),i&&o.push(`offset=${i}`),Ii(`/job/${this.job.job_id}/alignment/${t}?${o.join("&")}`)},async getClusters(t,e,s,i=0){const o=[];return e&&o.push(`association=${e}`),s&&o.push(`limit=${s}`),i&&o.push(`offset=${i}`),Ii(`/job/${this.job.job_id}/clusters/${t}?${o.join("&")}`)},async runClustering(t,e){return Ii(`/job/${this.job.job_id}/run_clustering/${t}`,{association_file:e})},async getClusterGraphs(t,e,s,i,o){const a=[];return void 0!==s&&a.push(`get_cluster=${s}`),void 0!==i&&a.push(`get_cluster_compact=${i}`),void 0!==o&&a.push(`get_reconciliation=${o}`),Ii(`/job/${this.job.job_id}/cluster/${t}/${e}/graph?${a.join("&")}`)},async validateLink(t,e,s,i){return Ii(`/job/${this.job.job_id}/validate/${t}`,{source:e,target:s,valid:i})},async getAssociationFiles(){return Ii("/association_files")},async loadDatasets(t,e){const s=t&&e?t+":"+e:t;if(!s||this.datasets.hasOwnProperty(s))return;const i=[`endpoint=${t}`];if(e&&i.push(`hsid=${e}`),this.datasets[s]=await Ii(`/datasets?${i.join("&")}`),e){const e={};Object.keys(this.datasets[s]).forEach(t=>{const i=this.datasets[s][t];i.published&&(e[t]=i)}),this.datasets[t]=e}},async loadDownloadsInProgress(){const t=await Ii("/downloads");this.downloaded=t.downloaded,this.downloading=t.downloading}}};function xi(t){return JSON.parse(JSON.stringify(t))}function ki(t){return Number.isInteger(t)||/^\d+$/.test(t)}function $i(t){let e=-1;return t.forEach(t=>{t.id>e&&(e=t.id)}),e+1}function Si(t){let e;return Array.isArray(t)?e=t:Array.isArray(t.conditions)&&(e=t.conditions),e?e.reduce((t,e)=>t.concat(Si(e)),[]):[t]}async function Ii(t,e){if(e){const s=await fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)});return s.json()}const s=await fetch(t);return s.json()}s("a89b");i["default"].use(o["a"]),i["default"].use(n.a),i["default"].use(l.a),i["default"].component("v-select",d.a),i["default"].component("fa-icon",u["a"]),i["default"].component("button-add",g),i["default"].component("button-delete",k),i["default"].component("button-info",P),i["default"].component("select-box",N),i["default"].component("loading",B),i["default"].component("handle",Y),i["default"].component("duration",tt),i["default"].component("property",rt),i["default"].component("download-progress",pt),i["default"].component("card",bt),i["default"].component("sub-card",$t),St["c"].add(It["a"],jt["f"],jt["d"],jt["b"],jt["k"],jt["n"],jt["j"],jt["c"],jt["m"],jt["h"],jt["a"],jt["l"],jt["i"],jt["e"],jt["g"]),i["default"].filter("capitalize",(function(t){return t?(t=t.toString(),t.charAt(0).toUpperCase()+t.slice(1)):""})),new i["default"]({mixins:[wi],render:t=>t(bi)}).$mount("#app")},6119:function(t,e,s){"use strict";var i=s("fee0"),o=s.n(i);o.a},"701f":function(t,e,s){"use strict";var i=s("00aa"),o=s.n(i);o.a},"8a48":function(t,e,s){},a89b:function(t,e,s){},a989:function(t,e,s){"use strict";var i=s("8a48"),o=s.n(i);o.a},bd33:function(t,e,s){},d11a:function(t,e,s){},e66a:function(t,e,s){"use strict";var i=s("d11a"),o=s.n(i);o.a},fdbe:function(t,e,s){"use strict";var i=s("1cab"),o=s.n(i);o.a},fee0:function(t,e,s){}});
//# sourceMappingURL=app.db0a372e.js.map