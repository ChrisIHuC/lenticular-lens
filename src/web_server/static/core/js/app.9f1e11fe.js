(function(t){function e(e){for(var i,a,n=e[0],l=e[1],c=e[2],u=0,p=[];u<n.length;u++)a=n[u],o[a]&&p.push(o[a][0]),o[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);d&&d(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],i=!0,n=1;n<s.length;n++){var l=s[n];0!==o[l]&&(i=!1)}i&&(r.splice(e--,1),t=a(a.s=s[0]))}return t}var i={},o={app:0},r=[];function a(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=i,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(s,i,function(e){return t[e]}.bind(null,i));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/static/core/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=e,n=n.slice();for(var c=0;c<n.length;c++)e(n[c]);var d=l;r.push(["56d7","chunk-vendors"]),s()})({"0367":function(t,e,s){"use strict";var i=s("a917"),o=s.n(i);o.a},"46ab":function(t,e,s){"use strict";var i=s("bd33"),o=s.n(i);o.a},"56d7":function(t,e,s){"use strict";s.r(e);var i=s("2b0e"),o=s("5f5b"),r=s("2ee4"),a=s.n(r),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{ref:"button",staticClass:"btn text-info p-0",attrs:{type:"button",title:t.title},on:{click:t.handleBtnClick}},[s("fa-icon",{attrs:{icon:"plus",size:t.size}})],1)},l=[],c={methods:{handleBtnClick(){this.$refs["button"].blur(),this.$emit("click")}},props:{size:{type:String,default:"lg"},title:String}},d=c,u=s("2877"),p=Object(u["a"])(d,n,l,!1,null,null,null),h=p.exports,m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{ref:"button",staticClass:"btn text-danger p-0",attrs:{type:"button",title:t.title},on:{click:t.handleBtnClick}},[s("fa-icon",{attrs:{icon:"trash-alt",size:t.size}})],1)},v=[],_={methods:{handleBtnClick(){this.$refs["button"].blur(),this.$emit("click")}},props:{size:{type:String,default:"lg"},title:String}},f=_,g=Object(u["a"])(f,m,v,!1,null,null,null),b=g.exports,y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"btn-info-popup"},[s("a",{staticClass:"btn btn-block text-info py-0",on:{click:function(e){t.$refs["info_"+t.uuid].show()}}},[s("fa-icon",{attrs:{icon:["far","question-circle"],size:"lg"}})],1),s("b-modal",{ref:"info_"+t.uuid,staticClass:"text-center",attrs:{id:"info_"+t.uuid,title:t.popup_title,size:t.popup_size,scrollable:"","hide-footer":"","return-focus":t.$root.$children[0].$el}},[t._t("default")],2)],1)},C=[];let w=0;var k={beforeCreate(){this.uuid=w.toString(),w++},props:{popup_size:{type:String,default:"xl"},popup_title:String}},x=k,$=(s("46ab"),Object(u["a"])(x,y,C,!1,null,null,null)),I=$.exports,S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("select",t._g(t._b({staticClass:"border-0 btn-outline-info form-control h-auto shadow",domProps:{value:t.value}},"select",t.$attrs,!1),t.inputListeners),[t._t("default")],2)},j=[],A={inheritAttrs:!1,props:["value"],computed:{inputListeners:function(){let t=this;return Object.assign({},this.$listeners,{input:function(e){e.target.blur(),t.$emit("input",e.target.value)}})}}},P=A,O=Object(u["a"])(P,S,j,!1,null,null,null),M=O.exports,R=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"d-flex justify-content-center"},[s("div",{staticClass:"spinner-border text-info",class:t.small?"small-spinner":"big-spinner",attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])])])},E=[],T={props:{small:!1}},N=T,L=(s("a989"),Object(u["a"])(N,R,E,!1,null,null,null)),F=L.exports,z=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row align-items-center"},[t.resourceInfo?[s("div",{staticClass:"property-resource read-only",class:{"btn-sm":t.small}},[t._v("\n      "+t._s(t.dataset.title)+"\n    ")]),s("div",{staticClass:"property-resource read-only mx-2",class:{"btn-sm":t.small}},[t._v("\n      "+t._s(t.resource.collection_id)+"\n    ")]),t.singular||t.readOnly?t._e():s("div",{staticClass:"col-auto pl-0 ml-0 my-1"},[s("button-add",{attrs:{size:"sm",title:"Add another property"},on:{click:function(e){return t.$emit("clone")}}}),t.allowDelete?s("button-delete",{staticClass:"ml-2",attrs:{size:"sm",title:"Remove this property"},on:{click:function(e){return t.$emit("delete")}}}):t._e()],1)]:t._e(),t._l(t.props,function(e){return[!Array.isArray(e.resources)&&e.inPath?s("div",{staticClass:"col-auto"},[s("fa-icon",{attrs:{icon:"arrow-right"}})],1):t._e(),""!==e.value[0]||t.readOnly?!Array.isArray(e.resources)&&e.inPath?[t.readOnly?s("div",{staticClass:"property-path read-only",class:{"btn-sm":t.small}},[t._v("\n        "+t._s(e.value[0])+"\n      ")]):s("button",{staticClass:"property-path",class:{"btn-sm":t.small},attrs:{type:"button"},on:{click:function(s){return t.$emit("resetProperty",e.idx)}}},[t._v("\n        "+t._s(e.value[0])+"\n      ")])]:t._e():s("div",{staticClass:"col-auto p-0 my-1",attrs:{value:e.value[0]}},[s("v-select",{class:{"is-invalid":t.errors.includes("value_"+e.idx),"form-control-sm":t.small},on:{input:function(s){return t.updateProperty(s,e.idx)}}},[Array.isArray(e.resources)?t._l(e.resources,function(e){return s("option",{key:e.id,domProps:{value:e.id}},[t._v("\n            "+t._s(e.label)+"\n          ")])}):[s("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("Choose a referenced collection")]),s("option",{attrs:{value:"__value__"}},[t._v("Value (do not follow reference)")]),t._l(Object.keys(e.resources),function(e){return s("option",{key:e,domProps:{value:e}},[t._v("\n            "+t._s(e)+"\n          ")])})]],2)],1),""!==e.value[0]&&"__value__"!==e.value[0]?[Array.isArray(e.resources)?t._e():s("div",{staticClass:"col-auto"},[s("fa-icon",{attrs:{icon:"arrow-right"}})],1),e.value[1]||t.readOnly?t.readOnly?s("div",{staticClass:"property-path read-only",class:{"btn-sm":t.small}},[t._v("\n        "+t._s(e.value[1])+"\n      ")]):s("button",{staticClass:"property-path",class:{"btn-sm":t.small},attrs:{type:"button"},on:{click:function(s){return t.$emit("resetProperty",e.idx+1)}}},[t._v("\n        "+t._s(e.value[1])+"\n      ")]):s("div",{staticClass:"col-auto p-0 my-1"},[s("v-select",{class:{"is-invalid":t.errors.includes("value_"+e.idx),"form-control-sm":t.small},attrs:{value:e.value[1]},on:{input:function(s){return t.updateProperty(s,e.idx+1)}}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Choose a property")]),t._l(Object.keys(e.properties),function(e){return s("option",{domProps:{value:e}},[t._v("\n            "+t._s(e)+"\n          ")])})],2)],1)]:t._e()]})],2)},V=[],G={data(){return{errors:[]}},methods:{validateField(t,e){return e?this.removeError(t):this.addError(t),!!e},addError(t){this.errors.includes(t)||this.errors.push(t)},removeError(t){const e=this.errors.indexOf(t);e>=0&&this.errors.splice(e,1)}}},D={name:"Property",mixins:[G],props:{property:Array,readOnly:{type:Boolean,default:!1},small:{type:Boolean,default:!1},singular:{type:Boolean,default:!1},allowDelete:{type:Boolean,default:!0},resourceInfo:{type:Boolean,default:!0},followReferencedCollection:{type:Boolean,default:!0}},computed:{resource(){return this.$root.getResourceById(this.property[0])},dataset(){return this.$root.datasets[this.resource.dataset_id]},props(){return new Array(Math.floor(this.property.length/2)).fill(null).map((t,e)=>{const s=2*e;return{idx:s,value:this.property.slice(s,s+2),resources:this.getResourcesForIndex(s),properties:this.getPropertiesForIndex(s),inPath:this.followReferencedCollection||this.readOnly||"__value__"!==this.property[s]}})}},methods:{validateProperty(){return this.errors=[],!this.props.map(t=>{const e="__value__"===t.value[0]||void 0===t.value.find(t=>""===t);return this.validateField(`value_${t.idx}`,e)}).includes(!1)},getResourcesForIndex(t){if(0===t)return this.$root.resources;const e=t>2?this.property[t-2]:this.resource.collection_id;return this.dataset.collections[e][this.property[t-1]].referencedCollections},getPropertiesForIndex(t){const e=0===t?this.resource.collection_id:this.property[t];return this.dataset.collections[e]},updateProperty(t,e){this.$set(this.property,e,t);const s=this.property.length>2?this.property.slice(-2)[0]:this.resource.collection_id,i=this.$utilities.getOrCreate(this.$set,this.dataset.collections[s][this.property.slice(-1)[0]],"referencedCollections",[]);this.property.slice(-1)[0]&&Object.keys(i).length>0&&(this.followReferencedCollection?this.property.push("",""):this.property.push("__value__",""))}}},B=D,J=Object(u["a"])(B,z,V,!1,null,null,null),U=J.exports,H=s("ad3d"),W=s("ecee"),q=s("b702"),Y=s("c074"),X=s("6821"),Z=s.n(X),K=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",attrs:{id:"app"}},[s("form-wizard",{ref:"formWizard",attrs:{title:"Lenticular Lenses II",subtitle:"Reconcile data for Golden Agents",color:"#efc501",shape:"square"},scopedSlots:t._u([{key:"next",fn:function(e){return 0===e.activeTabIndex&&!t.job_id||[1,2].includes(e.activeTabIndex)?[0!==e.activeTabIndex||t.job_id?t._e():[s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading||"existing"===t.idea_form},nativeOn:{click:function(e){e.preventDefault(),e.stopPropagation(),t.idea_form="existing"}}},[t._v("\n          Existing Idea\n        ")]),t._v("\n        Â \n        "),t.hasChanges?s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading||"new"===t.idea_form},nativeOn:{click:function(e){e.preventDefault(),e.stopPropagation(),t.idea_form="new"}}},[t._v("\n          New Idea\n        ")]):t._e()],[1,2,3].includes(e.activeTabIndex)?[t.hasChanges&&[1,2].includes(e.activeTabIndex)?s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading},nativeOn:{click:function(s){return s.stopPropagation(),t.validateAndSave(e.activeTabIndex)}}},[t._v("\n          Save\n        ")]):t._e(),s("wizard-button",{style:e.fillButtonStyle,attrs:{disabled:e.loading}},[t._v("\n          Save and next\n        ")])]:t._e()]:void 0}},{key:"finish",fn:function(e){return[t._v("â")]}}],null,!0)},[s("tab-content",{attrs:{title:"Idea","before-change":t.validateIdeaTab}},[s("tab-content-structure",{attrs:{title:"Idea",tab_error:t.tab_error,is_saved:t.is_saved},scopedSlots:t._u([{key:"header",fn:function(){return[t.$root.job?s("div",{staticClass:"col-auto"},[s("span",{staticClass:"badge badge-info"},[t._v("Created "+t._s(t.$root.job.created_at))])]):t._e()]},proxy:!0}])},[s("idea",{attrs:{job_id:t.job_id,job_title:t.job_title,job_description:t.job_description,idea_form:t.idea_form,is_updating:t.is_updating},on:{load:function(e){return t.setJobId(e)},create:function(e){return t.createJob(e)},update:function(e){return t.updateJob(e)}}})],1)],1),s("tab-content",{attrs:{title:"Collections","before-change":t.validateCollectionsTab}},[s("tab-content-structure",{attrs:{title:"Collections",tab_error:t.tab_error,is_saved:t.is_saved},scopedSlots:t._u([{key:"header",fn:function(){return[s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add a Collection",size:"2x"},on:{click:t.addResource}})],1)]},proxy:!0}])},t._l(t.$root.resources,function(e,i){return s("resource",{key:e.id,ref:"resourceComponents",refInFor:!0,attrs:{resource:e},on:{remove:function(e){return t.$root.resources.splice(i,1)}}})}),1)],1),s("tab-content",{attrs:{title:"Alignments","before-change":t.validateAlignmentsTab}},[s("tab-content-structure",{attrs:{title:"Alignment Specifications",tab_error:t.tab_error,is_saved:t.is_saved},scopedSlots:t._u([{key:"header",fn:function(){return[s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add an Alignment",size:"2x"},on:{click:t.addMatch}})],1)]},proxy:!0}])},t._l(t.$root.matches,function(e,i){return s("match",{key:e.id,ref:"matchComponents",refInFor:!0,attrs:{match:e},on:{duplicate:function(e){return t.duplicateMatch(e)},submit:t.submit,remove:function(e){return t.$root.matches.splice(i,1)},"update:label":function(t){e.label=t},refresh:function(e){return t.refreshAlignments(!0)}}})}),1)],1),s("tab-content",{attrs:{title:"Validation"}},[s("tab-content-structure",{attrs:{title:"Validation",tab_error:t.tab_error,is_saved:t.is_saved}},t._l(t.$root.matches,function(e){return t.$root.alignments.find(function(t){return t.alignment===e.id&&"Finished"===t.status})?s("match-validation",{key:e.id,attrs:{match:e},on:{refresh:function(e){return t.refreshClusterings(!0)}}}):t._e()}),1)],1),s("tab-content",{attrs:{title:"Export"}},[s("tab-content-structure",{attrs:{title:"Export",tab_error:t.tab_error,is_saved:t.is_saved}})],1)],1)],1)},Q=[],tt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",["new"===t.idea_form||t.job_id?s("div",{staticClass:"border p-4 mt-4 bg-light"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"h3",attrs:{for:"idea"}},[t._v("What's your idea?")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("title")},attrs:{type:"text",id:"idea",disabled:t.is_updating},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("title"),expression:"errors.includes('title')"}],staticClass:"invalid-feedback"},[t._v("\n        Please indicate a name for your idea\n      ")])]),s("div",{staticClass:"form-group pt-3"},[s("label",{staticClass:"h3",attrs:{for:"description"}},[t._v("Describe your idea")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("description")},attrs:{id:"description",disabled:t.is_updating},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}}),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("description"),expression:"errors.includes('description')"}],staticClass:"invalid-feedback"},[t._v("\n        Please indicate a description for your idea\n      ")])]),s("div",{staticClass:"form-group row justify-content-end align-items-center pt-3 mb-0"},[t.$root.job?s("div",{staticClass:"col-auto"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.$root.job.created_at!==t.$root.job.updated_at,expression:"$root.job.created_at !== $root.job.updated_at"}],staticClass:"badge badge-info"},[t._v("\n            Updated "+t._s(t.$root.job.updated_at)+"\n        ")])]):t._e(),s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:t.saveIdea}},[t._v("\n          "+t._s(t.job_id?"Update":"Create")+"\n        ")])],1)])]):t._e(),"existing"===t.idea_form||t.job_id?s("div",{staticClass:"bg-light border mt-4 p-4"},[s("div",{staticClass:"row justify-content-end align-items-center"},[s("span",{ref:"clipboard_copy_message",staticClass:"badge badge-info",attrs:{hidden:""}},[t._v("\n          Job ID copied to clipboard\n      ")]),t.job_id?[s("label",{staticClass:"h3 col-auto",attrs:{for:"job_id_copy"}},[t._v("Job ID")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.job_id,expression:"job_id"}],ref:"job_id_copy",staticClass:"col-md-3 col-auto",attrs:{type:"text",id:"job_id_copy",disabled:""},domProps:{value:t.job_id},on:{input:function(e){e.target.composing||(t.job_id=e.target.value)}}}),s("div",{staticClass:"col-auto"},[s("b-button",{on:{click:function(e){return t.copyToClipboard()}}},[s("fa-icon",{attrs:{icon:["far","clipboard"]}})],1)],1)]:[s("label",{staticClass:"h3 col-auto",attrs:{for:"id_to_load"}},[t._v("Existing Job ID")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.id_to_load,expression:"id_to_load"}],staticClass:"col-md-3 col-auto",attrs:{type:"text",id:"id_to_load"},domProps:{value:t.id_to_load},on:{input:function(e){e.target.composing||(t.id_to_load=e.target.value)}}}),s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.$emit("load",t.id_to_load)}}},[t._v("Load")])],1)]],2)]):t._e()])},et=[],st={name:"Idea",mixins:[G],data(){return{id_to_load:"",title:"",description:""}},props:{job_id:String,job_title:String,job_description:String,idea_form:String,is_updating:Boolean},methods:{validateIdea(){const t=this.validateField("title",this.title),e=this.validateField("description",this.description);return t&&e},saveIdea(){if(this.validateIdea()){const t=this.job_id?"update":"create";this.$emit(t,{job_id:this.job_id||void 0,job_title:this.title,job_description:this.description})}},copyToClipboard(){const t=this.$refs.job_id_copy,e=t.hasAttribute("disabled");e&&t.removeAttribute("disabled");const s=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.getSelection().removeAllRanges(),s&&document.getSelection().addRange(s),e&&t.setAttribute("disabled","disabled"),this.$refs.clipboard_copy_message.removeAttribute("hidden"),setTimeout(()=>this.$refs.clipboard_copy_message.setAttribute("hidden","hidden"),2e3)}},watch:{job_title(){this.job_title&&(this.title=this.job_title)},job_description(){this.job_description&&(this.description=this.job_description)}}},it=st,ot=Object(u["a"])(it,tt,et,!1,null,null,null),rt=ot.exports,at=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("card",{attrs:{id:"resource_"+t.resource.id,type:"resources",hasError:t.errors.length>0},scopedSlots:t._u([{key:"columns",fn:function(){return[s("div",{staticClass:"col-auto"},[s("button-delete",{attrs:{disabled:t.isUsedInAlignmentResults(),title:"Delete Collection"},on:{click:function(e){return t.$emit("remove")}}})],1)]},proxy:!0}]),model:{value:t.resource.label,callback:function(e){t.$set(t.resource,"label",e)},expression:"resource.label"}},[s("fieldset",{attrs:{disabled:t.isUsedInAlignmentResults()}},[s("sub-card",{attrs:{hasError:t.errors.includes("dataset")||t.errors.includes("collection")}},[s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-8"},[s("label",{attrs:{for:"dataset_"+t.resource.id}},[t._v("Dataset")]),s("v-select",{class:{"is-invalid":t.errors.includes("dataset")},attrs:{id:"dataset_"+t.resource.id},on:{change:function(e){t.resource.collection_id=""}},model:{value:t.resource.dataset_id,callback:function(e){t.$set(t.resource,"dataset_id",e)},expression:"resource.dataset_id"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Choose a dataset")]),t._l(t.$root.datasets,function(e,i){return s("option",{domProps:{value:i}},[t._v("\n              "+t._s(e.title)+"\n            ")])})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("dataset"),expression:"errors.includes('dataset')"}],staticClass:"invalid-feedback"},[t._v("\n            Please select a dataset\n          ")])],1),""!==t.resource.dataset_id?s("div",{staticClass:"form-group collection-input col-4"},[s("label",{attrs:{for:"collection_"+t.resource.id}},[t._v("Entity type")]),s("v-select",{class:{"is-invalid":t.errors.includes("collection")},attrs:{id:"collection_"+t.resource.id},model:{value:t.resource.collection_id,callback:function(e){t.$set(t.resource,"collection_id",e)},expression:"resource.collection_id"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Choose an entity type")]),t._l(t.$root.datasets[t.resource.dataset_id].collections,function(e,i){return s("option",{domProps:{value:i}},[t._v("\n              "+t._s(i)+"\n            ")])})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("collection"),expression:"errors.includes('collection')"}],staticClass:"invalid-feedback"},[t._v("\n            Please select an entity type\n          ")])],1):t._e()])]),""!==t.resource.collection_id?s("sub-card",{attrs:{label:"Filter",hasError:t.errors.includes("filters")}},[s("conditions-group",{ref:"filterGroupComponent",attrs:{"conditions-group":t.resource.filter,"is-root":!0,uid:"resource_"+t.resource.id+"_filter_group_0","validate-method-name":"validateFilterCondition"},on:{add:function(e){return t.addFilterCondition(e)}},scopedSlots:t._u([{key:"default",fn:function(e){return[s("resource-filter-condition",{ref:"filterConditionComponents",attrs:{condition:e.condition,index:e.index,resource:t.resource},on:{add:function(t){return e.add()},remove:function(t){return e.remove()}}})]}}],null,!1,569695416)})],1):t._e(),""!==t.resource.collection_id?s("sub-card",{attrs:{label:"Sample",hasError:t.errors.includes("limit")}},[s("div",{staticClass:"form-group row align-items-end mt-3"},[s("label",{staticClass:"col-auto",attrs:{for:"resource_"+t.resource.id+"_limit"}},[t._v("\n          Only use a sample of this amount of records (-1 is no limit):\n        ")]),s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.resource.limit,expression:"resource.limit",modifiers:{number:!0}}],staticClass:"form-control col-1",class:{"is-invalid":t.errors.includes("limit")},attrs:{type:"number",min:"-1",id:"resource_"+t.resource.id+"_limit"},domProps:{value:t.resource.limit},on:{input:function(e){e.target.composing||t.$set(t.resource,"limit",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("limit"),expression:"errors.includes('limit')"}],staticClass:"invalid-feedback"},[t._v("\n          Please provide a limit, or -1 if there is no limit\n        ")])]),s("div",{staticClass:"form-check"},[s("input",{directives:[{name:"model",rawName:"v-model.boolean",value:t.resource.random,expression:"resource.random",modifiers:{boolean:!0}}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"resource_"+t.resource.id+"_random"},domProps:{checked:Array.isArray(t.resource.random)?t._i(t.resource.random,null)>-1:t.resource.random},on:{change:function(e){var s=t.resource.random,i=e.target,o=!!i.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);i.checked?a<0&&t.$set(t.resource,"random",s.concat([r])):a>-1&&t.$set(t.resource,"random",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.resource,"random",o)}}}),s("label",{staticClass:"form-check-label",attrs:{for:"resource_"+t.resource.id+"_random"}},[t._v("Randomize order")])])]):t._e(),""!==t.resource.collection_id?s("sub-card",{attrs:{label:"Relations","add-button":"Add Relation",hasError:t.errors.find(function(t){return t.startsWith("relations_")})},on:{add:t.addRelation}},[0===t.resource.related.length?s("div",{staticClass:"font-italic mt-3"},[t._v("\n        No relations\n      ")]):t._e(),t.resource.related.length>0?s("div",{staticClass:"form-group form-check mt-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.resource.related_array,expression:"resource.related_array"}],staticClass:"form-check-input",attrs:{id:t.resource.label+"related_array",type:"checkbox"},domProps:{checked:Array.isArray(t.resource.related_array)?t._i(t.resource.related_array,null)>-1:t.resource.related_array},on:{change:function(e){var s=t.resource.related_array,i=e.target,o=!!i.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);i.checked?a<0&&t.$set(t.resource,"related_array",s.concat([r])):a>-1&&t.$set(t.resource,"related_array",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.resource,"related_array",o)}}}),s("label",{staticClass:"form-check-label",attrs:{for:t.resource.label+"related_array"}},[t._v("\n          Use relations as combined source\n        ")])]):t._e(),t._l(t.resource.related,function(e,i){return s("div",{staticClass:"row"},[s("div",{staticClass:"form-group col-4"},[s("label",{attrs:{for:"resource_"+t.resource.id+"_related_"+e.id+"_resource"}},[t._v("\n            Related collection\n          ")]),s("v-select",{class:{"is-invalid":t.errors.includes("relations_resource_"+i)},attrs:{id:"resource_"+t.resource.id+"_related_"+e.id+"_resource"},model:{value:e.resource,callback:function(s){t.$set(e,"resource",s)},expression:"relation.resource"}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Choose a collection")]),t._l(t.$root.resources,function(e){return e.id!==t.resource.id?s("option",{domProps:{value:e.id}},[t._v("\n              "+t._s(e.label)+"\n            ")]):t._e()})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("relations_resource_"+i),expression:"errors.includes(`relations_resource_${index}`)"}],staticClass:"invalid-feedback"},[t._v("\n            Please provide a related collection\n          ")])],1),e.resource>0?s("div",{staticClass:"form-group col-4"},[s("label",{attrs:{for:"resource_"+t.resource.id+"_related_"+e.id+"_local_property"}},[t._v("\n            Local property\n          ")]),s("v-select",{class:{"is-invalid":t.errors.includes("relations_local_prop_"+i)},model:{value:e.local_property,callback:function(s){t.$set(e,"local_property",s)},expression:"relation.local_property"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Select local property")]),t._l(t.$root.datasets[t.resource.dataset_id]["collections"][t.resource.collection_id],function(e,i){return s("option",{domProps:{value:i}},[t._v("\n              "+t._s(i)+"\n            ")])})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("relations_local_prop_"+i),expression:"errors.includes(`relations_local_prop_${index}`)"}],staticClass:"invalid-feedback"},[t._v("\n            Please provide a local property\n          ")])],1):t._e(),e.resource>0?s("div",{staticClass:"form-group col-3"},[s("label",{attrs:{for:"resource_"+t.resource.id+"_related_"+e.id+"_remote_property"}},[t._v("\n            Remote property\n          ")]),s("v-select",{class:{"is-invalid":t.errors.includes("relations_remote_prop_"+i)},model:{value:e.remote_property,callback:function(s){t.$set(e,"remote_property",s)},expression:"relation.remote_property"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Select remote property")]),t._l(t.getPropertiesForResource(e.resource),function(e,i){return s("option",{domProps:{value:i}},[t._v("\n              "+t._s(i)+"\n            ")])})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("relations_remote_prop_"+i),expression:"errors.includes(`relations_remote_prop_${index}`)"}],staticClass:"invalid-feedback"},[t._v("\n            Please provide a remote property\n          ")])],1):t._e(),s("div",{staticClass:"form-group col-1 align-self-end"},[s("button-delete",{on:{click:function(e){return t.resource.related.splice(i,1)}}})],1)])})],2):t._e()],1)])},nt=[],lt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border p-4 mt-4 bg-light",class:{"is-invalid":t.hasError}},[s("div",{staticClass:"sticky-top bg-light py-2",class:t.visible?"border-bottom":{}},[s("div",{staticClass:"row flex-nowrap align-items-center justify-content-between"},[s("div",{staticClass:"col-auto"},[s("fa-icon",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],attrs:{icon:"chevron-down",size:"2x"}})],1),s("div",{staticClass:"flex-shrink-1",class:[{"mr-auto":t.fillLabel},t.isEditing?"col":"col-auto"]},[t.isEditing?s("input",{ref:"editInput",staticClass:"form-control border-0",attrs:{type:"text",required:""},domProps:{value:t.value},on:{blur:function(e){t.editing=!1},input:function(e){return t.$emit("input",e.target.value)}}}):t.label?s("div",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],staticClass:"h2"},[t._v(t._s(t.label))]):s("div",{staticClass:"row",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[s("div",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],staticClass:"h2 col"},[t._v(t._s(t.value))]),s("button",{staticClass:"btn col-auto p-0",class:{invisible:!t.hovering},attrs:{type:"button",title:"Click to Edit"},on:{click:function(e){t.editing=!0}}},[s("fa-icon",{attrs:{icon:"pencil-alt",size:"lg"}})],1)]),t._t("title-extra")],2),t._t("columns")],2)]),s("b-collapse",{ref:t.id,attrs:{id:t.id,accordion:t.type+"-accordion",visible:t.openCard},on:{show:function(e){return t.$emit("show")},hide:function(e){return t.$emit("hide")},input:function(e){return t.withInput(e)}}},[t._t("default")],2)],1)},ct=[],dt={name:"Card",props:{id:String,type:String,label:String,value:String,openCard:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},fillLabel:{type:Boolean,default:!0}},data(){return{editing:!1,hovering:!1,visible:!1}},computed:{isEditing(){return!this.label&&(this.editing||""===this.value)}},methods:{withInput(t){this.visible=t,t?this.$emit("show"):this.$emit("hide")}},updated(){this.editing&&this.$refs.editInput.focus()}},ut=dt,pt=(s("d90f"),Object(u["a"])(ut,lt,ct,!1,null,"6ac0b857",null)),ht=pt.exports,mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bg-white border p-3",class:{"mt-4":!t.isFirst,"is-invalid":t.hasError}},[t.hasColumns||t.hasCollapse||t.label||t.hasInfo||t.addButton?s("div",{staticClass:"row align-items-center justify-content-between"},[t.hasCollapse?s("div",{staticClass:"col-auto"},[s("fa-icon",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.id,expression:"id"}],attrs:{icon:"chevron-down",size:"lg"}})],1):t._e(),t.label?s("div",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.hasCollapse?t.id:{},expression:"hasCollapse ? id : {}"}],staticClass:"col-auto pr-0",class:{"mr-auto":!t.hasInfo&&!t.addButton&&!t.hasMarginAuto}},[s("h3",[t._v(t._s(t.label))])]):t._e(),t.hasInfo?s("div",{staticClass:"col-auto pl-0",class:{"mr-auto":!t.addButton&&!t.hasMarginAuto}},[t._t("info")],2):t._e(),t._t("columns"),t.addButton?s("div",{staticClass:"col-auto ml-auto"},[s("button-add",{attrs:{title:t.addButton},on:{click:function(e){return t.$emit("add")}}})],1):t._e()],2):t._e(),t.hasCollapse?s("b-collapse",{ref:t.id,attrs:{id:t.id,accordion:t.type+"-accordion",visible:t.openCard},on:{show:function(e){return t.$emit("show")},hide:function(e){return t.$emit("hide")}}},[t._t("default")],2):t._t("default")],2)},vt=[],_t={name:"SubCard",props:{id:String,type:String,label:String,addButton:String,openCard:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},hasCollapse:{type:Boolean,default:!1},hasInfo:{type:Boolean,default:!1},hasMarginAuto:{type:Boolean,default:!1},hasColumns:{type:Boolean,default:!1},isFirst:{type:Boolean,default:!1}}},ft=_t,gt=Object(u["a"])(ft,mt,vt,!1,null,null,null),bt=gt.exports,yt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.conditionsGroup.conditions?s("div",{staticClass:"shadow p-3 border mt-3",class:[{"is-invalid":t.errors.length>0}].concat(t.styleClass)},[s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col-auto"},[s("fa-icon",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:t.uid,expression:"uid"}],attrs:{icon:"chevron-down",size:"lg"}})],1),t.conditionsGroup.conditions.length>0?s("div",{staticClass:"col"},[s("v-select",{model:{value:t.conditionsGroup.type,callback:function(e){t.$set(t.conditionsGroup,"type",e)},expression:"conditionsGroup.type"}},[s("option",{attrs:{value:"AND"}},[t._v("All conditions must be met (AND)")]),s("option",{attrs:{value:"OR"}},[t._v("At least one of the conditions must be met (OR)")])])],1):t._e(),t.conditionsGroup.conditions.length<1?s("div",{staticClass:"col font-italic"},[t._v("\n      No conditions\n\n      "),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes("conditions")?[t._v("\n          Please provide at least one condition\n        ")]:t._e()],2)]):t._e(),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row"},[!t.isRoot&&t.conditionsGroup.conditions.length>0?s("div",{staticClass:"col-auto"},[s("button-delete",{staticClass:"pt-1 pr-0",attrs:{title:"Delete this group"},on:{click:function(e){return t.$emit("remove",t.index)}}})],1):t._e(),s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add condition"},on:{click:function(e){return t.$emit("add",t.conditionsGroup)}}})],1)])])]),s("b-collapse",{ref:t.uid,attrs:{visible:"",id:t.uid}},t._l(t.conditionsGroup.conditions,function(e,i){return s("conditions-group",{key:i,ref:"conditionGroupComponents",refInFor:!0,attrs:{index:i,uid:t.uid+"_"+i,"conditions-group":e,"should-have-conditions":t.shouldHaveConditions,"validate-method-name":t.validateMethodName},on:{add:function(e){return t.$emit("add",e)},remove:function(e){return t.removeCondition(e)},promote:function(e){return t.promoteConditionGroup(e)},demote:function(e){return t.demoteConditionGroup(e)}},scopedSlots:t._u([{key:"default",fn:function(e){return[t._t("default",null,null,e)]}}],null,!0)})}),1)],1):s("div",[t._t("default",null,{index:t.index,condition:t.conditionsGroup,add:function(){return t.$emit("promote",t.index)},remove:function(){return t.$emit("remove",t.index)}})],2)},Ct=[],wt={name:"ConditionsGroup",mixins:[G],props:{uid:"",index:0,conditionsGroup:{},validateMethodName:String,isRoot:{type:Boolean,default:!1},shouldHaveConditions:{type:Boolean,default:!1}},computed:{styleClass(){const t=[];return this.isRoot&&t.push("mt-3"),this.isRoot||this.$parent.$parent.styleClass.includes("bg-primary-light")?t.push("bg-info-light","border-info"):t.push("bg-primary-light","border-primary"),t}},methods:{validateConditionsGroup(){let t=!0,e=!0,s=!0;return this.conditionsGroup.conditions&&this.conditionsGroup.conditions.length>0?e=!this.$refs.conditionGroupComponents.map(t=>t.validateConditionsGroup()).includes(!1):this.conditionsGroup.conditions&&this.shouldHaveConditions?t=this.validateField("conditions",this.conditionsGroup.conditions.length>0):!this.conditionsGroup.conditions&&this.validateMethodName&&this.$children.length>0&&"function"===typeof this.$children[0][this.validateMethodName]&&(s=this.$children[0][this.validateMethodName]()),t=this.validateField("conditions",t),e=this.validateField("group",e),s=this.validateField("children",s),t&&e&&s},removeCondition(t){this.conditionsGroup.conditions.splice(t,1),this.isRoot||1!==this.conditionsGroup.conditions.length||this.$emit("demote",this.index)},promoteConditionGroup(t){const e=this.conditionsGroup.conditions[t],s=JSON.parse(JSON.stringify(e)),i={type:"AND",conditions:[s]};this.$set(this.conditionsGroup.conditions,t,i),this.$emit("add",this.conditionsGroup.conditions[t])},demoteConditionGroup(t){const e=this.conditionsGroup.conditions[t].conditions[0],s=JSON.parse(JSON.stringify(e));this.$set(this.conditionsGroup.conditions,t,s)}}},kt=wt,xt=Object(u["a"])(kt,yt,Ct,!1,null,null,null),$t=xt.exports,It=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border border-dark p-3 mt-3"},[s("div",{staticClass:"row align-items-center justify-content-between mb-2"},[s("div",{staticClass:"col-auto"},[t._v("\n      Property:\n    ")]),s("div",{staticClass:"col"},[s("property",{ref:"propertyComponent",attrs:{property:t.condition.property,singular:!0,"resource-info":!1},on:{resetProperty:function(e){return t.resetProperty(t.condition.property,e)}}})],1),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-auto"},[s("button-delete",{staticClass:"pt-1 pr-0",attrs:{title:"Delete this Filter Condition"},on:{click:function(e){return t.$emit("remove",t.index)}}})],1),s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add Filter Condition and Create Group"},on:{click:function(e){return t.$emit("add")}}})],1)])])]),s("div",{staticClass:"form-row align-items-center"},[s("div",{staticClass:"col-3"},[s("v-select",{class:{"is-invalid":t.errors.includes("condition")},model:{value:t.condition.type,callback:function(e){t.$set(t.condition,"type",e)},expression:"condition.type"}},[s("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("Choose a filter type")]),s("option",{attrs:{value:"="}},[t._v("Equal to")]),s("option",{attrs:{value:"!="}},[t._v("Not equal to")]),s("option",{attrs:{value:"not_null"}},[t._v("Is not null")]),s("option",{attrs:{value:"date_is_within"}},[t._v("date is within")]),s("option",{attrs:{value:"appearances"}},[t._v("appearances of property")]),s("option",{attrs:{value:"ilike"}},[t._v("Contains (use % for wildcard)")])])],1),["=","!=","date_is_within","ilike"].indexOf(t.condition.type)>-1?s("div",{staticClass:"col-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.condition.value,expression:"condition.value"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("value")},attrs:{type:"text",placeholder:"Enter a value"},domProps:{value:t.condition.value},on:{input:function(e){e.target.composing||t.$set(t.condition,"value",e.target.value)}}})]):t._e(),"appearances"==t.condition.type?s("div",{staticClass:"col-2"},[s("v-select",{model:{value:t.condition.operator,callback:function(e){t.$set(t.condition,"operator",e)},expression:"condition.operator"}},[s("option",{attrs:{value:"<=",selected:""}},[t._v("Max.")]),s("option",{attrs:{value:">=",selected:""}},[t._v("Min.")]),s("option",{attrs:{value:"=",selected:""}},[t._v("Exactly")])])],1):t._e(),"appearances"==t.condition.type?s("div",{staticClass:"col-1"},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.condition.value,expression:"condition.value",modifiers:{number:!0}}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("value")},attrs:{type:"number",min:"0",step:"1"},domProps:{value:t.condition.value},on:{input:function(e){e.target.composing||t.$set(t.condition,"value",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]):t._e(),s("div",{staticClass:"form-check"},[s("input",{directives:[{name:"model",rawName:"v-model.boolean",value:t.condition.invert,expression:"condition.invert",modifiers:{boolean:!0}}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"resource_"+t.resource.id+"_condition_"+t.index+"_invert"},domProps:{checked:Array.isArray(t.condition.invert)?t._i(t.condition.invert,null)>-1:t.condition.invert},on:{change:function(e){var s=t.condition.invert,i=e.target,o=!!i.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);i.checked?a<0&&t.$set(t.condition,"invert",s.concat([r])):a>-1&&t.$set(t.condition,"invert",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.condition,"invert",o)}}}),s("label",{staticClass:"form-check-label",attrs:{for:"resource_"+t.resource.id+"_condition_"+t.index+"_invert"}},[t._v("Invert")])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("property")||t.errors.includes("condition")||t.errors.includes("value"),expression:"errors.includes('property') || errors.includes('condition') || errors.includes('value')"}],staticClass:"row"},[s("div",{staticClass:"invalid-feedback d-block pl-3"},[t.errors.includes("property")?[t._v("\n        Please select a property\n      ")]:t._e(),t.errors.includes("property")&&(t.errors.includes("condition")||t.errors.includes("value"))?[s("br")]:t._e(),t.errors.includes("condition")?[t._v("\n        Please provide a filter type\n      ")]:t.errors.includes("value")&&"appearances"===t.condition.type?[t._v("\n        Please provide a number for the condition\n      ")]:t.errors.includes("value")?[t._v("\n        Please provide a value for the condition\n      ")]:t._e()],2)])])},St=[],jt={name:"ResourceFilterCondition",mixins:[G],props:["resource","condition","index"],methods:{validateFilterCondition(){const t=this.validateField("property",this.$refs.propertyComponent.validateProperty()),e=this.validateField("condition",this.condition.type);let s=!1;return s=["=","!=","date_is_within","ilike"].includes(this.condition.type)?this.validateField("value",this.condition.value):"appearances"===this.condition.type?this.validateField("value",!isNaN(parseInt(this.condition.value))&&parseInt(this.condition.value)>0):this.validateField("value",!0),t&&e&&s},resetProperty(t,e){let s=t.slice(0,e);s.push(""),s.length%2>0&&s.push(""),this.$set(this.condition,"property",s)}}},At=jt,Pt=Object(u["a"])(At,It,St,!1,null,null,null),Ot=Pt.exports,Mt={name:"Resource",mixins:[G],components:{Card:ht,SubCard:bt,ConditionsGroup:$t,ResourceFilterCondition:Ot},data(){return{prevDatasetId:"",prevCollectionId:""}},props:{resource:Object},computed:{autoLabel(){if(this.prevDatasetId&&this.prevCollectionId){const t=this.$root.datasets[this.prevDatasetId].title;return`${t} [type: ${this.prevCollectionId}]`}return"Collection "+(this.resource.id+1)}},methods:{validateResource(){const t=this.validateField("dataset",this.resource.dataset_id&&this.$root.datasets.hasOwnProperty(this.resource.dataset_id)),e=this.$root.datasets[this.resource.dataset_id],s=this.validateField("collection",this.resource.collection_id&&e&&e.collections.hasOwnProperty(this.resource.collection_id)),i=parseInt(this.resource.limit),o=this.validateField("limit",!isNaN(i)&&(-1===i||i>0));let r=!0;this.errors=this.errors.filter(t=>!t.startsWith("relations_")),this.resource.related.forEach((t,s)=>{const i=this.$root.resources.find(e=>e.id===parseInt(t.resource)),o=this.validateField(`relations_resource_${s}`,t.resource&&i),a=e&&e.collections[this.resource.collection_id],n=this.validateField(`relations_local_prop_${s}`,t.local_property&&a&&a.hasOwnProperty(t.local_property)),l=i&&this.$root.datasets[i.dataset_id],c=l&&l.collections[i.collection_id],d=this.validateField(`relations_remote_prop_${s}`,t.remote_property&&c&&c.hasOwnProperty(t.remote_property));o&&n&&d||(r=!1)});let a=!0;return this.$refs.filterGroupComponent&&(a=this.$refs.filterGroupComponent.validateConditionsGroup()),a=this.validateField("filters",a),s&&t&&o&&r&&a},isUsedInAlignmentResults(){const t=this.$root.alignments.map(t=>t.alignment);for(let e=0;e<this.$root.matches.length;e++){const s=this.$root.matches[e];if(t.includes(s.id)&&(s.sources.includes(this.resource.id)||s.targets.includes(this.resource.id)))return!0}return!1},addRelation(t){t&&t.target.blur(),this.resource.related.push({resource:"",local_property:"",remote_property:""})},addFilterCondition(t){t.conditions.push({type:"",property:[this.resource.id,""]})},getPropertiesForResource(t){const e=this.$root.getResourceById(t);return this.$root.datasets[e.dataset_id]["collections"][e.collection_id]}},updated(){this.resource.label===this.autoLabel&&(this.prevDatasetId=this.resource.dataset_id,this.prevCollectionId=this.resource.collection_id,this.$set(this.resource,"label",this.autoLabel))},mounted(){this.prevDatasetId=this.resource.dataset_id,this.prevCollectionId=this.resource.collection_id,this.resource.label||this.$set(this.resource,"label",this.autoLabel)}},Rt=Mt,Et=Object(u["a"])(Rt,at,nt,!1,null,null,null),Tt=Et.exports,Nt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("card",{attrs:{id:"match_"+t.match.id,type:"matches",hasError:t.errors.length>0,fillLabel:!1},scopedSlots:t._u([{key:"title-extra",fn:function(){return[s("div",{staticClass:"col form-check pl-0 mt-1"},[s("b-form-checkbox",{attrs:{id:"match_"+t.match.id+"_is_association",disabled:!!t.alignment,title:"Check this box if this Alignment is intended for creating associations"},model:{value:t.match.is_association,callback:function(e){t.$set(t.match,"is_association",e)},expression:"match.is_association"}},[t._v("\n        Association\n      ")])],1)]},proxy:!0},{key:"columns",fn:function(){return[s("div",{staticClass:"col-auto ml-auto mr-auto"},[t.alignment?s("div",{staticClass:"bg-white border small p-2"},[s("div",{staticClass:"row align-items-center m-0"},[t.alignmentRunning?s("div",{staticClass:"col-auto"},[s("loading",{attrs:{small:!0}})],1):t._e(),s("div",{staticClass:"col-auto"},[s("div",[s("strong",[t._v("Request received at: ")]),t._v(t._s(t.alignment.requested_at)+"\n            ")]),t.alignment.processing_at?s("div",[s("strong",[t._v("Processing started at: ")]),t._v(t._s(t.alignment.processing_at)+"\n            ")]):t._e(),t.alignment.finished_at?s("div",[s("strong",[t._v("Processing finished at: ")]),t._v(t._s(t.alignment.finished_at)+"\n            ")]):t._e(),s("div",[s("strong",[t._v("Status: ")]),s("pre",{staticClass:"d-inline"},[t._v(t._s(t.alignment.status))])]),"Finished"===t.alignment.status?s("div",[s("strong",[t._v("Links found:")]),t._v(" "+t._s(t.alignment.links_count||0)+"\n            ")]):t._e()])])]):t._e()]),s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.$emit("duplicate",t.match)}}},[t._v("Duplicate")])],1),t.alignmentRunning?t._e():s("div",{staticClass:"col-auto"},[s("b-button",{attrs:{variant:"info"},on:{click:t.runAlignment}},[t._v("\n        Run\n        "),t.alignment?[t._v("again")]:t._e()],2)],1),s("div",{staticClass:"col-auto"},[s("button-delete",{attrs:{size:"2x",disabled:!!t.alignment,title:"Delete this Alignment"},on:{click:function(e){return t.$emit("remove")}}})],1)]},proxy:!0}]),model:{value:t.match.label,callback:function(e){t.$set(t.match,"label",e)},expression:"match.label"}},[s("fieldset",{attrs:{disabled:!!t.alignment}},[s("sub-card",{attrs:{label:"Sources","has-info":!0,"add-button":"Add a Collection as a Source",hasError:t.errors.includes("sources")||t.errors.includes("sources_select")},on:{add:function(e){return t.addMatchResource("sources",e)}},scopedSlots:t._u([{key:"info",fn:function(){return[s("match-sources-info")]},proxy:!0}])},[s("div",{staticClass:"row pl-5"},[s("div",{staticClass:"col"},[t._l(t.match.sources,function(e,i){return s("match-resource",{key:i,ref:"sourceResourceComponents",refInFor:!0,attrs:{match_resource_id:"source_"+i,match:t.match,match_resource:t.$root.getResourceById(e),resources_key:"sources"},on:{input:function(e){return t.updateMatchResource("sources",i,e)},remove:function(e){return t.deleteMatchResource("sources",i)}}})}),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes("sources")?[t._v("\n              Please provide at least one source\n            ")]:t._e()],2)],2)])]),s("sub-card",{attrs:{label:"Targets","has-info":!0,"add-button":"Add a Collection as a Target",hasError:t.errors.includes("targets")||t.errors.includes("targets_select")},on:{add:function(e){return t.addMatchResource("targets",e)}},scopedSlots:t._u([{key:"info",fn:function(){return[s("match-targets-info")]},proxy:!0}])},[s("div",{staticClass:"row pl-5"},[s("div",{staticClass:"col"},[t._l(t.match.targets,function(e,i){return s("match-resource",{key:i,ref:"targetResourceComponents",refInFor:!0,attrs:{match_resource_id:"target_"+i,match:t.match,match_resource:t.$root.getResourceById(e),resources_key:"targets"},on:{input:function(e){return t.updateMatchResource("targets",i,e)},remove:function(e){return t.deleteMatchResource("targets",i)}}})}),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes("targets")?[t._v("\n              Please provide at least one target\n            ")]:t._e()],2)],2)])]),s("sub-card",{attrs:{label:"Matching Methods","has-info":!0,hasError:t.errors.includes("matching-methods")},scopedSlots:t._u([{key:"info",fn:function(){return[s("match-matching-methods-info")]},proxy:!0}])},[s("conditions-group",{ref:"matchingMethodGroupComponent",attrs:{"conditions-group":t.match,"is-root":!0,"should-have-conditions":!0,uid:"match_"+t.match.id+"_group_0","validate-method-name":"validateMatchCondition"},on:{add:function(e){return t.addMatchCondition(e)}},scopedSlots:t._u([{key:"default",fn:function(t){return[s("match-condition",{attrs:{condition:t.condition,index:t.index},on:{add:function(e){return t.add()},remove:function(e){return t.remove()}}})]}}])})],1)],1)])},Lt=[],Ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"SOURCES"}},[s("div",{staticClass:"h2"},[t._v("COMPOSING VIRTUAL SOURCE FROM COLLECTIONS")]),s("img",{attrs:{width:"700px",src:"/static/images/VirtualCollection.png"}}),s("p",{staticClass:"h5 text-left pt-4 pb-4"},[t._v("\n    All collections of interest selected as sources are combined into\n    a "),s("strong",[t._v("SINGLE VIRTUAL COLLECTION")]),t._v("> with the resource's id and the value of the selected\n    properties. For a single dataset, multiple "),s("strong",[t._v("SEMANTICALLY SIMILAR PROPERTIES")]),t._v(" can be\n    selected.\n  ")]),s("hr"),s("img",{staticClass:"pb-4",attrs:{width:"1000px",src:"/static/images/Documentation.png"}})])},zt=[],Vt={},Gt=Object(u["a"])(Vt,Ft,zt,!1,null,null,null),Dt=Gt.exports,Bt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"TARGETS"}},[s("div",{staticClass:"h2"},[t._v("MATCHING SOURCE AGAINST TARGET")]),s("img",{attrs:{src:"/static/images/Source_Target.png",width:"800px"}}),s("ul",{staticClass:"text-left pt-5"},[s("li",[t._v("Several collections can be selected as "),s("span",{staticClass:"text-info"},[t._v("SOURCE")]),t._v(".")]),s("li",[t._v("Several collections can be selected as "),s("span",{staticClass:"text-info"},[t._v("TARGET")]),t._v(".")]),s("li",[t._v("For each collection, be it the "),s("span",{staticClass:"text-info"},[t._v("TARGET")]),t._v(" or the "),s("span",{staticClass:"text-info"},[t._v("SOURCE")]),t._v(" several properties can be selected.\n    ")]),s("li",[t._v("Overall, "),s("strong",[t._v("ALL")]),t._v(" selected properties "),s("strong",[t._v("MUST")]),t._v(" be concistent for a\n      particuilar the type of "),s("span",{staticClass:"text-info"},[t._v("MATCHING METHOD")]),t._v(" in mind.\n    ")])]),s("hr")])},Jt=[],Ut={},Ht=Object(u["a"])(Ut,Bt,Jt,!1,null,null,null),Wt=Ht.exports,qt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"MATCHING METHODS AND LOGICAL OPERATOR"}},[s("div",{staticClass:"h3 pt-5 text-info"},[t._v("Simple Matching Scenario-1")]),s("img",{attrs:{width:"700px",src:"/static/images/4_MethodSimple.png"}}),s("div",{staticClass:"h5"},[t._v("Matching two datasets using "),s("strong",[t._v("one")]),t._v(" property per dataset")]),s("div",{staticClass:"h3 pt-5 text-info"},[t._v("Simple Matching Scenario-2")]),s("img",{attrs:{width:"700px",src:"/static/images/5_MethodProp.png"}}),s("div",{staticClass:"h5"},[t._v("\n    More than one property per dataset is allowed."),s("br"),t._v("\n    Only, all aligned property should be semantically similar.\n  ")]),s("div",{staticClass:"h3 pt-5 text-info"},[t._v("\n    Simple Matching Scenario-3\n  ")]),s("img",{attrs:{width:"700px",src:"/static/images/6_MethodDs.png"}}),s("div",{staticClass:"h5"},[t._v("\n    More than one dataset is allowed for a "),s("span",{staticClass:"text-info"},[t._v("SOURCE")]),t._v(" or a\n    "),s("span",{staticClass:"text-info"},[t._v("TARGET")]),t._v("."),s("br"),t._v("\n    Only, all aligned property should be semantically similar."),s("br"),t._v("\n    The logical expression provide a human readable of how it is implemented.\n  ")]),s("div",{staticClass:"h3 pt-5 text-info"},[t._v("Complex Matching Scenario")]),s("img",{attrs:{width:"700px",src:"/static/images/7_MethodFull.png"}}),s("div",{staticClass:"h5"},[t._v("\n    More than one method is allowed."),s("br"),t._v("\n    Within each method, a "),s("strong",[t._v("DISJUNCTION")]),t._v(" ("),s("span",{staticClass:"text-info"},[t._v("OR")]),t._v(") operator is\n    applied over each pair of properties "),s("strong",[t._v("across")]),t._v(" two datasets."),s("br"),t._v("\n    A "),s("strong",[t._v("DISJUNCTION")]),t._v(" ("),s("span",{staticClass:"text-info"},[t._v("OR")]),t._v(") OR "),s("strong",[t._v("CONJUNCTION")]),t._v("\n    ("),s("span",{staticClass:"text-info"},[t._v("AND")]),t._v(") operator is necessary whenever more than one methods is\n    required."),s("br")])])},Yt=[],Xt={},Zt=Object(u["a"])(Xt,qt,Yt,!1,null,null,null),Kt=Zt.exports,Qt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row align-items-center"},[t.match_resource?s("div",{staticClass:"ml-3",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[t._v("\n    "+t._s(t.match_resource.label)+"\n  ")]):s("div",{staticClass:"col-auto pr-0",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[s("v-select",{class:{"is-invalid":t.errors.includes("resource")},attrs:{value:t.match_resource,id:"match_"+t.match.id+"_resource_label_"+t.match_resource_id},on:{input:function(e){t.$emit("input",e),t.hovering=!1}}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Choose a collection")]),t._l(t.resources,function(e){return s("option",{domProps:{value:e.id}},[t._v(t._s(e.label)+"\n      ")])})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("resource"),expression:"errors.includes('resource')"}],staticClass:"invalid-feedback"},[t._v("\n      Please select a collection\n    ")])],1),s("div",{staticClass:"col-auto pl-0",on:{mouseenter:function(e){t.hovering=!0},mouseleave:function(e){t.hovering=!1}}},[s("button-delete",{class:"btn-sm pt-1"+t.showOnHover,attrs:{size:"sm"},on:{click:function(e){return t.$emit("remove")}}})],1)])},te=[],ee={name:"MatchResource",mixins:[G],data(){return{hovering:!1}},props:{match:Object,match_resource:Object,match_resource_id:String,resources_key:String},computed:{resources(){return this.$root.resources.filter(t=>{return!this.match[this.resources_key].includes(t.id.toString())})},showOnHover(){return this.hovering?"":" invisible"}},methods:{validateResource(){return this.validateField("resource",this.match_resource&&""!==this.match_resource)}}},se=ee,ie=Object(u["a"])(se,Qt,te,!1,null,null,null),oe=ie.exports,re=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border border-dark p-3 mt-3"},[s("div",{staticClass:"row align-items-start justify-content-between mb-2"},[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row"},[s("label",{staticClass:"h4 col-auto"},[t._v("Method")]),s("div",{staticClass:"col-auto"},[s("v-select",{class:{"is-invalid":t.errors.includes("method_name")},on:{input:t.handleMethodIndexChange},model:{value:t.condition.method_name,callback:function(e){t.$set(t.condition,"method_name",e)},expression:"condition.method_name"}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Select a method")]),t._l(t.matchingMethods,function(e,i){return s("option",{domProps:{value:i}},[t._v(t._s(e.label))])})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("method_name"),expression:"errors.includes('method_name')"}],staticClass:"invalid-feedback"},[t._v("\n            Please specify a matching method\n          ")])],1)])]),s("div",{staticClass:"col-4"},[s("div",{staticClass:"row"},t._l(t.methodValueTemplate.items,function(e,i){return s("div",{staticClass:"col"},[s("div",{staticClass:"form-group"},[s("label",[s("span",[t._v("\n                                  "+t._s(e.label)+"\n                              ")]),"number"===typeof e.type?s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.condition.method_value[e.key],expression:"condition.method_value[item.key]",modifiers:{number:!0}}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("method_value_"+e.key)},attrs:{type:"number",step:"0.1"},domProps:{value:t.condition.method_value[e.key]},on:{input:function(s){s.target.composing||t.$set(t.condition.method_value,e.key,t._n(s.target.value))},blur:function(e){return t.$forceUpdate()}}}):t._e(),e.type.hasOwnProperty("type")&&"matching_label"===e.type.type?s("select",{directives:[{name:"model",rawName:"v-model",value:t.condition.method_value[e.key].value,expression:"condition.method_value[item.key].value"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("method_value_"+e.key)},on:{change:function(s){var i=Array.prototype.filter.call(s.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.condition.method_value[e.key],"value",s.target.multiple?i:i[0])}}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Select a Mapping")]),t._l(t.$root.matches,function(e){return s("option",{domProps:{value:e.id}},[t._v(t._s(e.label))])})],2):t._e(),e.choices?s("select",{directives:[{name:"model",rawName:"v-model",value:t.condition.method_value[e.key],expression:"condition.method_value[item.key]"}],staticClass:"form-control",class:{"is-invalid":t.errors.includes("method_value_"+e.key)},on:{change:function(s){var i=Array.prototype.filter.call(s.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.condition.method_value,e.key,s.target.multiple?i:i[0])}}},[s("option",{attrs:{disabled:"",selected:"",value:""}},[t._v("Select an option")]),t._l(e.choices,function(e,i){return s("option",{domProps:{value:e}},[t._v(t._s(i)+"\n                ")])})],2):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes("method_value_"+e.key),expression:"errors.includes(`method_value_${item.key}`)"}],staticClass:"invalid-feedback"},[t._v("\n                Please specify a valid value\n              ")])])])])}),0)]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-auto"},[s("button-delete",{staticClass:"pt-1 pr-0",attrs:{title:"Delete this Method"},on:{click:function(e){return t.$emit("remove",t.index)}}})],1),s("div",{staticClass:"col-auto"},[s("button-add",{attrs:{title:"Add Method and Create Group"},on:{click:function(e){return t.$emit("add")}}})],1)])])]),t._l(["sources","targets"],function(e){return s("div",{staticClass:"row pl-5 mb-3"},[s("div",{staticClass:"col"},[s("div",{staticClass:"row"},[s("div",{staticClass:"h4 col-auto"},[t._v(t._s(t._f("capitalize")(e))+" properties")]),t.unusedResources[e].length>0?s("div",{staticClass:"col-auto form-group"},[s("v-select",{on:{input:function(s){return t.condition[e][s].push({property:[s,""]})}}},[s("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("Add property for Collection:")]),t._l(t.unusedResources[e],function(e){return s("option",{domProps:{value:e}},[t._v("\n              "+t._s(t.$root.getResourceById(e).label)+"\n            ")])})],2)],1):t._e()]),t._l(t.condition[e],function(i){return t._l(i,function(o,r){return s("div",{staticClass:"row"},[s("div",{staticClass:"col ml-5 p-3 border-top"},[o.property?s("property",{ref:"propertyComponents",refInFor:!0,attrs:{property:o.property},on:{clone:function(t){return i.splice(r+1,0,{property:[i[r]["property"][0],""]})},delete:function(e){return t.$delete(i,r)},resetProperty:function(e){return t.resetProperty(i,r,e)}}}):t._e(),s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col-auto h5"},[t._v("Transformers")]),s("div",{staticClass:"col-auto p-0"},[s("button-add",{staticClass:"btn-sm",attrs:{size:"sm",title:"Add Transformer"},on:{click:function(e){t.$utilities.getOrCreate(t.$set,o,"transformers",[]).push("")}}})],1),t._l(o.transformers,function(i,r){return s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col-auto pr-0"},[s("v-select",{class:{"is-invalid":t.errors.includes(e+"_transformers")},model:{value:o.transformers[r],callback:function(e){t.$set(o.transformers,r,e)},expression:"resource.transformers[index]"}},[s("option",{attrs:{value:"",selected:"",disabled:""}},[t._v("Select a function")]),t._l(t.transformers,function(e){return s("option",{domProps:{value:e}},[t._v(t._s(e)+"\n                      ")])})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.errors.includes(e+"_transformers"),expression:"errors.includes(`${resources_key}_transformers`)"}],staticClass:"invalid-feedback"},[t._v("\n                      Please specify a transformer or remove the transformer\n                    ")])],1),s("div",{staticClass:"col-auto p-0"},[s("button-delete",{staticClass:"btn-sm",attrs:{size:"sm"},on:{click:function(t){return o.transformers.splice(r,1)}}})],1)])])})],2)],1)])})}),s("div",{staticClass:"invalid-feedback d-block"},[t.errors.includes(e)?[t._v("\n          Please specify at least one property\n        ")]:t._e()],2)],2)])})],2)},ae=[],ne={matchingMethods:{"=":{label:"Exact Match",items:[]},LL_SOUNDEX:{label:"Similar Soundex",items:[{key:"threshold",label:"Similarity threshold",type:.7,minValue:0,maxValue:1}]},BLOOTHOOFT_REDUCT:{label:"Same Bloothooft Reduction",items:[{key:"name_type",label:"Type of Name",type:"",choices:{"First name":"first_name","Family name":"family name"}},{key:"threshold",label:"Similarity threshold",type:.7,minValue:0,maxValue:1}]},BLOOTHOOFT_REDUCT_APPROX:{label:"Similar Bloothooft Reduction",items:[{key:"name_type",label:"Type of Name",type:"",choices:{"First name":"first_name","Family name":"family name"}},{key:"threshold",label:"Similarity threshold",type:.7,minValue:0,maxValue:1}]},TRIGRAM_DISTANCE:{label:"Trigram distance",items:[{key:"threshold",label:"Similarity threshold",type:.3,minValue:0,maxValue:1}]},LEVENSHTEIN:{label:"Levenshtein distance",items:[{key:"max_distance",label:"Maximum distance",type:1,minValue:0}]},TIME_DELTA:{label:"Time Delta",items:[{key:"days",label:"",type:0,minValue:0},{key:"multiplier",label:"",type:"",choices:{Years:365,Months:30,Days:1}}]},SAME_YEAR_MONTH:{label:"Same Year/Month",items:[{key:"date_part",label:"",type:"",choices:{Year:"year",Month:"month","Year and Month":"year_month"}}]},DISTANCE_IS_BETWEEN:{label:"Distance is between",items:[{key:"distance_start",label:"Start",type:0},{key:"distance_end",label:"End",type:0}]},IS_IN_SET:{label:"Is a Match in Set",items:[{key:"alignment",label:"",type:{type:"matching_label"}}]}},transformers:["ecartico_full_name","to_date_immutable"]},le={name:"MatchCondition",mixins:[G],data(){return{transformers:ne.transformers,matchingMethods:ne.matchingMethods}},props:["condition","index"],computed:{methodValueTemplate(){return this.matchingMethods.hasOwnProperty(this.condition.method_name)?this.matchingMethods[this.condition.method_name]:{label:"",items:[]}},unusedResources(){let t=["sources","targets"],e={};return t.forEach(t=>{e[t]=Object.keys(this.condition[t]).filter(e=>this.condition[t][e].length<1)}),e}},methods:{validateMatchCondition(){const t=this.validateField("method_name",this.condition.method_name.length>0);let e=!0;this.errors=this.errors.filter(t=>!t.startsWith("method_value_")),this.methodValueTemplate.items.forEach(t=>{const s=this.condition.method_value[t.key];let i=!0;t.hasOwnProperty("minValue")&&(isNaN(parseFloat(s))||parseFloat(s)<t.minValue)&&(i=!1),t.hasOwnProperty("maxValue")&&(isNaN(parseFloat(s))||parseFloat(s)>t.maxValue)&&(i=!1),t.hasOwnProperty("choices")&&!Object.values(t.choices).includes(s)&&(i=!1),"IS_IN_SET"!==this.condition.method_name||void 0!==s.value&&""!==s.value||(i=!1),this.validateField(`method_value_${t.key}`,i)||(e=!1)});const s=!this.$refs.propertyComponents.map(t=>t.validateProperty()).includes(!1);let i=!0;return["sources","targets"].forEach(t=>{Object.keys(this.condition[t]).forEach(e=>{this.validateField(t,this.condition[t][e].length>0)||(i=!1),this.condition[t][e].forEach(e=>{e.hasOwnProperty("transformers")&&!this.validateField(`${t}_transformers`,!e.transformers.includes(""))&&(i=!1)})})}),t&&e&&s&&i},handleMethodIndexChange(){this.condition.method_value={},this.methodValueTemplate.items.forEach(t=>{this.condition.method_value[t.key]=t.type})},resetProperty(t,e,s){let i=t[e].property,o=i.slice(0,s);o.push(""),o.length%2>0&&o.push(""),this.$set(t[e],"property",o)}}},ce=le,de=Object(u["a"])(ce,re,ae,!1,null,null,null),ue=de.exports,pe={name:"Match",mixins:[G],components:{Card:ht,SubCard:bt,MatchSourcesInfo:Dt,MatchTargetsInfo:Wt,MatchMatchingMethodsInfo:Kt,MatchResource:oe,MatchCondition:ue,ConditionsGroup:$t},props:{match:Object},computed:{alignment(){return this.$root.alignments.find(t=>t.alignment===this.match.id)},alignmentRunning(){return this.alignment&&"Finished"!==this.alignment.status&&!this.alignment.status.startsWith("FAILED")}},methods:{validateMatch(){const t=this.validateField("sources",this.match.sources.length>0),e=this.validateField("targets",this.match.targets.length>0),s=this.validateField("sources_select",!this.$refs.sourceResourceComponents.map(t=>t.validateResource()).includes(!1)),i=this.validateField("targets_select",!this.$refs.targetResourceComponents.map(t=>t.validateResource()).includes(!1));let o=!0;return this.$refs.matchingMethodGroupComponent&&(o=this.$refs.matchingMethodGroupComponent.validateConditionsGroup()),o=this.validateField("matching-methods",o),t&&e&&s&&i&&o},addMatchCondition(t){t.conditions.push({method_name:"",method_value:{},sources:this.match.sources.reduce((t,e)=>{return t[e]=[{property:[e,""]}],t},{}),targets:this.match.targets.reduce((t,e)=>{return t[e]=[{property:[e,""]}],t},{})})},addMatchResource(t,e){e&&e.target.blur(),this.match[t].push("")},updateMatchResource(t,e,s){const i=e=>{e.conditions.forEach(e=>{this.$set(e[t],s,[{property:[s,""]}]),e.conditions&&i(e)})},o=this.match[t][e];this.$set(this.match[t],e,s),i(this.match),this.updateProperties(o,s)},deleteMatchResource(t,e){const s=e=>{e.conditions.forEach(e=>{this.$delete(e[t],i),e.conditions&&s(e)})},i=this.match[t][e];this.match[t].length<1&&this.addMatchResource(t),s(this.match),this.$delete(this.match[t],e),this.updateProperties(i)},updateProperties(t,e){const s=this.match.sources.find(e=>e===t),i=this.match.targets.find(e=>e===t),o=this.match.properties.findIndex(e=>e[0]===t);o>=0&&!s&&!i&&this.match.properties.splice(o,1),e&&!this.match.properties.find(t=>t[0]===e)&&this.match.properties.push([e,""])},scrollTo(t){this.$refs[t].$el.parentNode.scrollIntoView({behavior:"smooth",block:"start"})},async runAlignment(t=!1){if(!this.validateMatch())return;const e=await this.$root.runAlignment(this.match.id,t);"exists"===e.result&&confirm("This Alignment job already exists.\nDo you want to overwrite it with the current configuration?")&&await this.runAlignment(!0),this.$emit("refresh")}},mounted(){this.match.sources.length<1&&this.addMatchResource("sources"),this.match.targets.length<1&&this.addMatchResource("targets")}},he=pe,me=Object(u["a"])(he,Nt,Lt,!1,null,null,null),ve=me.exports,_e=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("card",{attrs:{id:"clusters_match_"+t.match.id,type:"clusters-matches",label:t.match.label,"fill-label":!1,"open-card":t.show},on:{show:function(e){return t.updateShow("open")},hide:function(e){return t.updateShow("close")}},scopedSlots:t._u([{key:"columns",fn:function(){return[s("div",{staticClass:"col-auto d-flex flex-column align-items-center ml-auto mr-auto"},[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"bg-white border small p-2"},[s("div",{staticClass:"row align-items-center m-0"},[t.clusteringRunning?s("div",{staticClass:"col-auto"},[s("loading",{attrs:{small:!0}})],1):t._e(),s("div",{staticClass:"col-auto"},[s("div",[s("strong",[t._v("Links: ")]),t._v("\n                "+t._s(t.alignment.links_count)+"\n              ")]),s("div",[s("strong",[t._v("Clustering request: ")]),t.clustering?[t._v(t._s(t.clustering.requested_at))]:[t._v("-")]],2),s("div",[s("strong",[t._v("Clustering started at: ")]),t.clustering&&t.clustering.processing_at?[t._v(t._s(t.clustering.processing_at))]:[t._v("-")]],2),s("div",[s("strong",[t._v("Clustering finished at: ")]),t.clustering&&t.clustering.finished_at?[t._v(t._s(t.clustering.finished_at))]:[t._v("-")]],2),s("div",[s("strong",[t._v("Status: ")]),t.clustering?s("pre",{staticClass:"d-inline"},[t._v(t._s(t.clustering.status))]):s("pre",{staticClass:"d-inline"},[t._v("Not yet clustered")])])]),s("div",{staticClass:"col-auto"},[s("div",[s("strong",[t._v("Clusters: ")]),t.clustering&&"Finished"===t.clustering.status?[t._v("\n                  "+t._s(t.clustering.clusters_count)+"\n                ")]:[t._v("-")]],2),s("div",[s("strong",[t._v("Extended Clusters: ")]),t.clustering&&"Finished"===t.clustering.status?[t._v("\n                  "+t._s(t.clustering.extended_count||0)+"\n                ")]:[t._v("-")]],2),s("div",[s("strong",[t._v("Clusters with Cycles: ")]),t.clustering&&"Finished"===t.clustering.status?[t._v("\n                  "+t._s(t.clustering.cycles_count||0)+"\n                ")]:[t._v("-")]],2),s("div",[s("strong",[t._v("Clusters not Extended: ")]),t.clustering&&"Finished"===t.clustering.status?[t._v("\n                  "+t._s(t.clustering.clusters_count-t.clustering.extended_count)+"\n                ")]:[t._v("-")]],2),s("div",[s("strong",[t._v("Clusters without Cycles: ")]),t.clustering&&"Finished"===t.clustering.status?[t._v("\n                  "+t._s(t.clustering.clusters_count-t.clustering.cycles_count)+"\n                ")]:[t._v("-")]],2)])])])]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"btn-toolbar mt-2",attrs:{role:"toolbar","aria-label":"Toolbar"}},[s("div",{staticClass:"btn-group btn-group-toggle mr-2"},[s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showInfo}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showInfo,expression:"showInfo"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showInfo)?t._i(t.showInfo,null)>-1:t.showInfo},on:{change:[function(e){var s=t.showInfo,i=e.target,o=!!i.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);i.checked?a<0&&(t.showInfo=s.concat([r])):a>-1&&(t.showInfo=s.slice(0,a).concat(s.slice(a+1)))}else t.showInfo=o},t.updateShow]}}),s("fa-icon",{attrs:{icon:"info-circle"}}),t._v("\n              Alignment specs\n            ")],1),s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showPropertySelection}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showPropertySelection,expression:"showPropertySelection"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showPropertySelection)?t._i(t.showPropertySelection,null)>-1:t.showPropertySelection},on:{change:[function(e){var s=t.showPropertySelection,i=e.target,o=!!i.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);i.checked?a<0&&(t.showPropertySelection=s.concat([r])):a>-1&&(t.showPropertySelection=s.slice(0,a).concat(s.slice(a+1)))}else t.showPropertySelection=o},t.updateShow]}}),s("fa-icon",{attrs:{icon:"cog"}}),t._v("\n              Properties\n            ")],1),s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showAllLinks}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showAllLinks,expression:"showAllLinks"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showAllLinks)?t._i(t.showAllLinks,null)>-1:t.showAllLinks},on:{change:[function(e){var s=t.showAllLinks,i=e.target,o=!!i.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);i.checked?a<0&&(t.showAllLinks=s.concat([r])):a>-1&&(t.showAllLinks=s.slice(0,a).concat(s.slice(a+1)))}else t.showAllLinks=o},function(e){return t.updateShow("links")}]}}),s("fa-icon",{attrs:{icon:"list"}}),t._v("\n              Links\n            ")],1),t.clustering&&!t.clusteringRunning?s("label",{staticClass:"btn btn-secondary btn-sm",class:{active:t.showClusters}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showClusters,expression:"showClusters"}],attrs:{type:"checkbox",autocomplete:"off"},domProps:{checked:Array.isArray(t.showClusters)?t._i(t.showClusters,null)>-1:t.showClusters},on:{change:[function(e){var s=t.showClusters,i=e.target,o=!!i.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);i.checked?a<0&&(t.showClusters=s.concat([r])):a>-1&&(t.showClusters=s.slice(0,a).concat(s.slice(a+1)))}else t.showClusters=o},function(e){return t.updateShow("clusters")}]}}),s("fa-icon",{attrs:{icon:"list"}}),t._v("\n              Clusters\n            ")],1):t._e()])])])]),s("div",{staticClass:"col-auto d-flex flex-column align-items-center"},[s("div",{staticClass:"col-auto"},[t.clustering&&!t.clusteringRunning?s("button",{staticClass:"btn btn-info my-1",attrs:{type:"button",disabled:""===t.association,title:""===t.association?"Choose an association first":""},on:{click:function(e){return t.runClustering(e)}}},[t._v("\n          Reconcile\n        ")]):t.clustering||t.clusteringRunning?t._e():s("button",{staticClass:"btn btn-info my-1",attrs:{type:"button"},on:{click:function(e){return t.runClustering(e)}}},[t._v("\n          Cluster\n          "),""!==t.association?[t._v(" & Reconcile")]:t._e()],2)]),t.associationFiles?s("div",{staticClass:"col-auto"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.association,expression:"association"}],staticClass:"col-auto form-control association-select my-1",attrs:{id:"match_"+t.match.id+"_association"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.association=e.target.multiple?s:s[0]}}},[s("option",{attrs:{value:""}},[t._v("No association")]),t._l(t.associationFiles,function(e){return s("option",{domProps:{value:e}},[t._v("\n            "+t._s(e)+"\n          ")])})],2)]):t._e()])]},proxy:!0}])},[t.showInfo?s("match-info",{attrs:{match:t.match}}):t._e(),t.showPropertySelection?s("sub-card",{attrs:{id:"properties_card_"+t.match.id,type:"properties",label:"Property selection","has-margin-auto":!0,"has-columns":!0},scopedSlots:t._u([{key:"columns",fn:function(){return[s("div",{staticClass:"col-auto ml-auto"},[s("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:t.saveProperties}},[t._v("\n          Save\n        ")])])]},proxy:!0}],null,!1,2678689879)},[s("div",{staticClass:"mt-4"},t._l(t.match.properties,function(e,i){return e[0]?s("property",{key:i,staticClass:"mx-0",attrs:{property:e,singular:!1,"follow-referenced-collection":!1,"allow-delete":t.match.properties.findIndex(function(t){return t[0]===e[0]})!==i},on:{clone:function(e){return t.match.properties.splice(i+1,0,[t.match.properties[i][0],""])},delete:function(e){return t.$delete(t.match.properties,i)},resetProperty:function(s){return t.resetProperty(i,e,s)}}}):t._e()}),1)]):t._e(),t.loading?s("loading",{staticClass:"mt-4"}):t._e(),!t.loading&&t.showClusters&&t.clustering&&!t.clusteringRunning?[s("sub-card",{attrs:{label:"Clusters","open-card":!0,"has-collapse":!0,"has-margin-auto":!!t.clusterIdSelected,id:"clusters-list",type:"clusters-list"},scopedSlots:t._u([{key:"columns",fn:function(){return[t.clusterIdSelected?[s("div",{staticClass:"col-auto small ml-auto mr-auto"},[s("strong",[t._v("Selected cluster: ")]),t._v("\n            "+t._s(t.clusterIdSelected)+"\n          ")]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"btn-group btn-group-toggle"},[s("label",{staticClass:"btn btn-sm btn-secondary",class:{active:"links"===t.clusterView}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.clusterView,expression:"clusterView"}],attrs:{type:"radio",value:"links",autocomplete:"off"},domProps:{checked:t._q(t.clusterView,"links")},on:{change:function(e){t.clusterView="links"}}}),s("fa-icon",{attrs:{icon:"align-justify"}}),t._v("\n                Show links\n              ")],1),t.hasProperties?s("label",{staticClass:"btn btn-sm btn-secondary",class:{active:"visualize"===t.clusterView}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.clusterView,expression:"clusterView"}],attrs:{type:"radio",value:"visualize",autocomplete:"off"},domProps:{checked:t._q(t.clusterView,"visualize")},on:{change:function(e){t.clusterView="visualize"}}}),s("fa-icon",{attrs:{icon:"project-diagram"}}),t._v("\n                Visualize\n              ")],1):t._e(),t.hasProperties?s("label",{staticClass:"btn btn-sm btn-secondary",class:{active:"visualize-compact"===t.clusterView}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.clusterView,expression:"clusterView"}],attrs:{type:"radio",value:"visualize-compact",autocomplete:"off"},domProps:{checked:t._q(t.clusterView,"visualize-compact")},on:{change:function(e){t.clusterView="visualize-compact"}}}),s("fa-icon",{attrs:{icon:"project-diagram"}}),t._v("\n                Visualize compact\n              ")],1):t._e(),t.hasProperties&&t.association?s("label",{staticClass:"btn btn-sm btn-secondary",class:{active:"visualize-reconciled"===t.clusterView}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.clusterView,expression:"clusterView"}],attrs:{type:"radio",value:"visualize-reconciled",autocomplete:"off"},domProps:{checked:t._q(t.clusterView,"visualize-reconciled")},on:{change:function(e){t.clusterView="visualize-reconciled"}}}),s("fa-icon",{attrs:{icon:"project-diagram"}}),t._v("\n                Visualize reconciled\n              ")],1):t._e()])])]:t._e()]},proxy:!0}],null,!1,2573374136)},[s("div",{staticClass:"bg-white px-3 py-1 mt-4 mb-2"},[s("div",{staticClass:"row font-weight-bold"},[s("div",{staticClass:"col"},[t._v("Id")]),s("div",{staticClass:"col"},[t._v("Extended")]),s("div",{staticClass:"col"},[t._v("Reconciled")]),s("div",{staticClass:"col"},[t._v("Size")]),s("div",{staticClass:"col"},[t._v("Links")]),s("div",{staticClass:"col-4"},[t._v("Property")])])]),s("virtual-list",{attrs:{size:58,remain:5,item:t.clusterItem,itemcount:t.clustering.clusters_count,itemprops:t.getClusterItemProps}})],1),!t.loading&&t.showClusters&&t.clusterIdSelected&&t.hasProperties&&t.clusterView.startsWith("visualize")?s("cluster-visualization",{attrs:{show:t.clusterView,"clustering-id":t.clustering.clustering_id,"cluster-id":t.clusterIdSelected,"cluster-data":t.clusters[t.clusterIdSelected],properties:t.match.properties,association:t.association}}):t._e()]:t._e(),!t.loading&&t.showLinks?s("virtual-list",{staticClass:"mt-4",attrs:{size:130,remain:5,item:t.linkItem,pagemode:!0,itemcount:t.showAllLinks?t.links.length:t.clusterLinks.length,itemprops:t.getLinkItemProps}}):t._e()],2)},fe=[],ge=s("89c1"),be=s.n(ge),ye=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("sub-card",{staticClass:"match-info"},[s("p",{staticClass:"font-weight-bold mb-2"},[t._v("Matching")]),s("matching-method-group-info",{attrs:{matching_method_group:t.match,is_root:!0}})],1)},Ce=[],we=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.matching_method_group.conditions?s("div",{class:{"border shadow p-2":!t.is_root}},[t._l(t.matching_method_group.conditions,function(e,i){return[s("matching-method-group-info",{key:i,attrs:{matching_method_group:e}}),i<t.matching_method_group.conditions.length-1?s("p",{staticClass:"font-weight-bold my-2 text-info"},[t._v("\n      "+t._s(t.matching_method_group.type)+"\n    ")]):t._e()]})],2):t.matching_method_group.conditions?t._e():s("match-condition-info",{attrs:{condition:t.matching_method_group}})},ke=[],xe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border shadow p-2"},[t._l(t.condition.sources,function(e){return t._l(e,function(e){return s("div",{staticClass:"row mx-0"},[s("div",{staticClass:"col-auto"},[s("property",{attrs:{property:e.property,"read-only":!0,small:!0}})],1),e.transformers?s("p",{staticClass:"font-weight-bold m-0"},[t._v("\n        with transformers "+t._s(e.transformers.join(", "))+"\n      ")]):t._e()])})}),s("p",{staticClass:"font-weight-bold m-0"},[t._v("against")]),t._l(t.condition.targets,function(e){return t._l(e,function(e){return s("div",{staticClass:"row mx-0"},[s("div",{staticClass:"col-auto"},[s("property",{attrs:{property:e.property,"read-only":!0,small:!0}})],1),e.transformers?s("p",{staticClass:"font-weight-bold m-0"},[t._v("\n        with transformers\n        "),s("span",{staticClass:"text-info"},[t._v(t._s(e.transformers.join(", ")))])]):t._e()])})}),s("p",{staticClass:"font-weight-bold m-0"},[t._v("\n    using\n\n    "),s("span",{staticClass:"text-info"},[t._v(t._s(t.methodValueTemplate.label))]),t.methodValueTemplate.items.length>0?[t._v("\n      [ "),s("span",{domProps:{innerHTML:t._s(t.methodValuePropsHumanReadable)}}),t._v(" ]\n    ")]:t._e()],2)],2)},$e=[],Ie={name:"MatchConditionInfo",data(){return{transformers:ne.transformers,matchingMethods:ne.matchingMethods}},props:{condition:Object},computed:{methodValueTemplate(){return this.matchingMethods.hasOwnProperty(this.condition.method_name)?this.matchingMethods[this.condition.method_name]:{label:"",items:[]}},methodValuePropsHumanReadable(){return this.methodValueTemplate.items.map(t=>{let e=this.condition.method_value[t.key];return"IS_IN_SET"===this.condition.method_name?e=this.$root.matches.find(t=>t.id===e.value).label:t.choices&&(e=Object.keys(t.choices).find(s=>t.choices[s]===e)),t.label?`<span class="text-info">${t.label} = ${e}</span>`:`<span class="text-info">${e}</span>`}).join(" and ")}}},Se=Ie,je=Object(u["a"])(Se,xe,$e,!1,null,null,null),Ae=je.exports,Pe={name:"MatchingMethodGroupInfo",components:{MatchConditionInfo:Ae},props:{is_root:{type:Boolean,default:!1},matching_method_group:{}}},Oe=Pe,Me=Object(u["a"])(Oe,we,ke,!1,null,null,null),Re=Me.exports,Ee={name:"MatchInfo",components:{SubCard:bt,MatchingMethodGroupInfo:Re},props:{match:Object}},Te=Ee,Ne=(s("7bc4"),Object(u["a"])(Te,ye,Ce,!1,null,null,null)),Le=Ne.exports,Fe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.showResourceInfo?s("div",t._l(t.propsGrouped,function(e){return s("div",{staticClass:"row m-0"},[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row mb-1"},[s("div",{staticClass:"property-resource btn-sm read-only"},[t._v("\n          "+t._s(e.title)+"\n        ")]),s("div",{staticClass:"property-resource btn-sm read-only mx-2"},[t._v("\n          "+t._s(e.collectionId)+"\n        ")])]),s("div",{staticClass:"row"},t._l(e.propsAndValues,function(e){return s("div",{staticClass:"col-auto ml-4"},[s("div",{staticClass:"property-path btn-sm read-only"},[t._v("\n            "+t._s(e.property[1])+"\n          ")]),t._l(e.values,function(e){return s("div",{staticClass:"property-value btn-sm read-only ml-2"},[t._v("\n            "+t._s(e)+"\n          ")])})],2)}),0)])])}),0):s("div",t._l(t.propsGrouped,function(e,i){return s("div",{staticClass:"row m-0"},[s("div",{staticClass:"property-path btn-sm read-only"},[t._v("\n      "+t._s(i)+"\n    ")]),t._l(e,function(e){return s("div",{staticClass:"property-value btn-sm read-only ml-2"},[t._v("\n      "+t._s(e)+"\n    ")])})],2)}),0)},ze=[],Ve={name:"Properties",props:{properties:Array,showResourceInfo:{type:Boolean,default:!0}},computed:{propsGrouped(){return this.showResourceInfo?this.propsByResource():this.propsByName()}},methods:{propsByResource(){return this.properties.reduce((t,e)=>{if(!t.hasOwnProperty(e.property[0])){const s=this.$root.getResourceById(e.property[0]),i=this.$root.datasets[s.dataset_id];t[e.property[0]]={collectionId:s.collection_id,title:i.title,propsAndValues:[]}}return t[e.property[0]].propsAndValues.push(e),t},{})},propsByName(){return this.properties.reduce((t,e)=>{return t.hasOwnProperty(e.property[1])||(t[e.property[1]]=[]),t[e.property[1]].push(...e.values),t},{})}}},Ge=Ve,De=Object(u["a"])(Ge,Fe,ze,!1,null,null,null),Be=De.exports,Je=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"border p-3",class:[{"mt-4":!t.isFirst}].concat(t.bgColor)},[s("div",{staticClass:"row align-items-center flex-nowrap"},[s("div",{staticClass:"col-auto d-flex flex-column align-items-center"},[s("div",{staticClass:"col-auto"},[s("span",{staticClass:"font-weight-bold font-italic"},[t._v("# "+t._s(t.index+1))])]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"btn btn-sm bg-info-light border border-info text-info read-only m-1"},[s("span",{staticClass:"font-weight-bold"},[t._v("Strength")]),s("br"),t._v("\n          "+t._s(t.strength)+"\n        ")])])]),s("div",{staticClass:"col"},[s("div",{staticClass:"row justify-content-center flex-nowrap"},[s("div",{staticClass:"property-path btn-sm read-only"},[t._v("\n          Source URI\n        ")]),s("div",{staticClass:"property-value btn-sm read-only ml-2"},[t._v("\n          "+t._s(t.source)+"\n        ")]),s("button",{staticClass:"property-value btn-sm read-only ml-2",attrs:{type:"button"},on:{click:t.copySourceUriToClipboard}},[s("fa-icon",{attrs:{icon:["far","clipboard"]}})],1)]),s("div",{staticClass:"row justify-content-center flex-nowrap"},[s("div",{staticClass:"property-path btn-sm read-only"},[t._v("\n          Target URI\n        ")]),s("div",{staticClass:"property-value btn-sm read-only ml-2"},[t._v("\n          "+t._s(t.target)+"\n        ")]),s("button",{staticClass:"property-value btn-sm read-only ml-2",attrs:{type:"button"},on:{click:t.copyTargetUriToClipboard}},[s("fa-icon",{attrs:{icon:["far","clipboard"]}})],1)]),t.sourceProperties.length>0||t.targetProperties.length>0?s("div",{staticClass:"row flex-nowrap border-top mt-2 pt-2"},[s("div",{staticClass:"col"},[s("div",{staticClass:"font-weight-bold mb-2"},[t._v("Source properties:")]),s("properties",{attrs:{properties:t.sourceProperties,"show-resource-info":!1}})],1),s("div",{staticClass:"col"},[s("div",{staticClass:"font-weight-bold mb-2"},[t._v("Target properties:")]),s("properties",{attrs:{properties:t.targetProperties,"show-resource-info":!1}})],1)]):t._e()]),s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row flex-column align-items-center"},[s("div",{staticClass:"col-auto"},[s("button",{staticClass:"btn btn-sm btn-success m-1",attrs:{type:"button"},on:{click:function(e){return t.$emit("accepted")}}},[s("fa-icon",{attrs:{icon:"check"}}),t._v("\n            Accept\n          ")],1)]),s("div",{staticClass:"col-auto"},[s("button",{staticClass:"btn btn-sm btn-danger m-1",attrs:{type:"button"},on:{click:function(e){return t.$emit("declined")}}},[s("fa-icon",{attrs:{icon:"times"}}),t._v("\n            Decline\n          ")],1)])])])])])},Ue=[],He={name:"MatchLink",components:{Properties:Be},props:{index:Number,state:String,source:String,sourceValues:Array,target:String,targetValues:Array,strength:String,isFirst:Boolean},computed:{bgColor(){return"accepted"===this.state?"bg-success":"declined"===this.state?"bg-danger":"bg-white"},sourceProperties(){return this.sourceValues.map(t=>{return{property:[this.$root.getResourceByDatasetId(t.dataset).id,t.property],values:t.values}})},targetProperties(){return this.targetValues.map(t=>{return{property:[this.$root.getResourceByDatasetId(t.dataset).id,t.property],values:t.values}})}},methods:{async copySourceUriToClipboard(){await navigator.clipboard.writeText(this.source)},async copyTargetUriToClipboard(){await navigator.clipboard.writeText(this.target)}}},We=He,qe=Object(u["a"])(We,Je,Ue,!1,null,null,null),Ye=qe.exports,Xe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bg-white border clickable p-3",class:{"mt-2":!t.isFirst,"bg-info-light":t.selected},on:{click:function(e){return t.$emit("select:clusterId",t.clusterId)}}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col font-weight-bold"},[t._v("\n      "+t._s(t.clusterId)+"\n    ")]),s("div",{staticClass:"col",class:"ext_"+t.clusterData.extended},[t._v("\n      "+t._s(t.clusterData.extended)+"\n    ")]),s("div",{staticClass:"col",class:"ext_"+t.clusterData.reconciled},[t._v("\n      "+t._s(t.clusterData.reconciled)+"\n    ")]),s("div",{staticClass:"col"},[t._v("\n      "+t._s(t.clusterData.nodes.length)+"\n    ")]),s("div",{staticClass:"col"},[t._v("\n      "+t._s(t.clusterData.links.length)+"\n    ")]),s("div",{staticClass:"col-4"},[s("properties",{attrs:{properties:t.props,"show-resource-info":!1}})],1)])])},Ze=[],Ke={name:"Clustering",components:{Properties:Be},props:{clusterId:String,clusterData:Object,properties:Object,selected:!1,isFirst:!1},computed:{resources(){const t=this.clusterData.links.flatMap(t=>t).map(t=>t.substring(1,t.length-1)),e=this.clusterData.nodes.map(t=>t.substring(1,t.length-1));return[...new Set(t.concat(e))]},props(){const t=Object.entries(this.properties).filter(([t,e])=>this.resources.includes(t)).flatMap(([t,e])=>e).reduce((t,e)=>{const s=[this.$root.getResourceByDatasetId(e.dataset).id,e.property];let i=t.find(t=>t.property[0]===s[0]&&t.property[1]===s[1]);return i||(i={property:s,values:[]},t.push(i)),i.values.push(...e.values),t},[]);return t.forEach(t=>t.values=[...new Set(t.values)]),t}}},Qe=Ke,ts=(s("0367"),Object(u["a"])(Qe,Xe,Ze,!1,null,null,null)),es=ts.exports,ss=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("sub-card",{attrs:{label:t.label,"has-info":!0,"has-columns":!0},scopedSlots:t._u([{key:"info",fn:function(){return["visualize-compact"===t.show?s("cluster-visualization-compact-info"):"visualize-reconciled"===t.show?s("cluster-visualization-reconciled-info"):s("cluster-visualization-info")]},proxy:!0},{key:"columns",fn:function(){return[s("div",{staticClass:"col-auto ml-auto"},[t.association?s("button",{staticClass:"btn btn-info mr-4",attrs:{type:"button"},on:{click:function(e){return t.getGraphData("cluster")}}},[t._v("\n        Load Original Clusters\n      ")]):t._e()])]},proxy:!0}])},[s("svg",{staticClass:"plot mt-3",attrs:{visible:!Boolean(t.association),id:"graph-cluster"}}),s("b-modal",{ref:"visualizationPopup",attrs:{id:"visualization_popup",title:"CLUSTER DETAIL",size:"xl","hide-footer":"","return-focus":t.$root.$children[0].$el,static:!0}},[s("svg",{staticClass:"plot",attrs:{id:"graph-cluster-popup"}})])],1)},is=[],os=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"CLUSTER VISUALIZATION"}},[s("div",{staticClass:"text-left"},[s("div",{staticClass:"h2"},[t._v("Identity Link Network (ILN)")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      This provides additional information of Identity Link Clusters:\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[t._v("Identity Link Clusters.")]),s("li",[t._v("Visualize a cluster and interact with it.")]),s("li",[t._v("An improved visualisation (particularly important for large clusters).")]),s("li",[t._v("Reconcile a cluster using additional information such relation.")])]),s("div",{staticClass:"h3 pt-4"},[t._v("An ILN of "),s("strong",[t._v("Meulder Hans")]),t._v(" in the Turtle Language")]),s("p",{staticClass:"h5 pt-4 pb-4 pl-5"},[t._v("\n      This is an example of links discovered using an approximate string similarity on\n      "),s("strong",[t._v("Ecartico")]),t._v(", "),s("strong",[t._v("Baptism")]),t._v(", "),s("strong",[t._v("Marriage")]),t._v(" and\n      "),s("strong",[t._v("Burial")]),t._v(" for married Amsterdammers between 1600 and 1650. These links are\n      specifically the ones that link different occurrences of "),s("strong",[t._v("Meulder Hans")]),t._v(".\n    ")]),s("textarea",{staticClass:"ml-5 mb-1",attrs:{disabled:"",cols:"75",rows:"18"}},[t._v("      @prefix baptism: <http://goldenagents.org/uva/SAA/person/IndexOpDoopregister/> .\n      @prefix ecartico: <http://www.vondel.humanities.uva.nl/ecartico/persons/> .\n      @prefix marriage: <http://goldenagents.org/uva/SAA/person/IndexOpOndertrouwregister/> .\n      @prefix owl: <http://www.w3.org/2002/07/owl#> .\n\n      baptism:saaId24678323p2 owl:sameAs ecartico:15747 .\n      baptism:saaId24678323p2 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24519437p2 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24285260p2 owl:sameAs baptism:saaId24519437p2 .\n      marriage:saaId26379331p1 owl:sameAs ecartico:15747 .\n      baptism:saaId24519437p2 owl:sameAs ecartico:15747 .\n      baptism:saaId24519437p2 owl:sameAs marriage:saaId26377774p1 .\n      baptism:saaId24285260p2 owl:sameAs ecartico:15747 .\n      baptism:saaId24285260p2 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24519437p2 owl:sameAs baptism:saaId24678323p2 .\n      marriage:saaId26377774p1 owl:sameAs ecartico:15747 .\n      marriage:saaId26377774p1 owl:sameAs marriage:saaId26379331p1 .\n      baptism:saaId24285260p2 owl:sameAs baptism:saaId24678323p2 .\n    ")]),s("div",{staticClass:"h3 pt-4"},[t._v("Visualizing an ILN of "),s("strong",[t._v("Meulder Hans")])]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      The cluster of "),s("strong",[t._v("Meulder Hans")]),t._v(" is composed of 6 nodes (potentially the same person)\n      using 13 link. The links in plain black represent an exact match (link strength = 1) while those in\n      dotted red represent a link of strength below 1. The color of the node depicts the data-source it is\n      stemmed from. So in this real example cluster,\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[t._v("Three nodes are from "),s("strong",[t._v("Baptism")]),t._v(";")]),s("li",[t._v("Two nodes are from "),s("strong",[t._v("Marriage")]),t._v(" and;")]),s("li",[t._v("One is from "),s("strong",[t._v("Ecartico")]),t._v(".")])]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/1 Meulder Hans (Cluster).jpg",width:"700",height:"600"}})])])])},rs=[],as={},ns=Object(u["a"])(as,os,rs,!1,null,null,null),ls=ns.exports,cs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"CLUSTER VISUALIZATION"}},[s("div",{staticClass:"text-left"},[s("div",{staticClass:"h3"},[t._v("A Compact Representation of Meulder Hans' ILN")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      The compact representation of a cluster allows for the display of large clusters and a comprehensive\n      aggravation of nodes. The approach groups nodes base on similar link strength starting from the\n      highest strength in the identity network. From the original cluster, two sub-groups of nodes can be\n      identified using the link strength of 1 (black plain link) together.\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[t._v("Sub-group-1: Two nodes are linked with strength 1")]),s("li",[t._v("Sub-group-2: Three nodes are linked with strength 1")]),s("li",[t._v("Sub-group-3: One isolated node")])]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      The subgroups are then interconnected using an aggregated link represented by the highest strength.\n      Using such approach sub-groups and their interconnections are now clearly visible.\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      Each compact node contains 3 type of information:\n    ")]),s("ul",{staticClass:"h5 ml-5"},[s("li",[s("strong",[t._v("N")]),t._v(" indicating the number of nodes aggregated by the compact node.")]),s("li",[s("strong",[t._v("L")]),t._v(" indicating the number of links.")]),s("li",[s("strong",[t._v("S")]),t._v(" indicating the strength of the links that enabled the aggregation.")]),s("li",[t._v("The last information (not present in this example but visible in the second compact example of\n        size 35) removes a percentage of the node's color to indicate the number of missing links for the\n        number of nodes aggregated\n      ")])]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/1 Meulder Hans (Cluster).jpg",width:"700"}}),s("p",{staticClass:"h5 pt-4 pl-5 font-weight-bold"},[t._v("\n        Original Cluster\n      ")])]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/2 Meulder Hans (Cluster-Compact).jpg",width:"700"}}),s("p",{staticClass:"h5 pt-4 pl-5 font-weight-bold"},[t._v("\n        Compact Cluster\n      ")])]),s("div",{staticClass:"h3 pt-4"},[t._v("Large ILN Versus its Compact Version")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      This is an example of a bigger cluster of size 35 potentially representing "),s("strong",[t._v("Pieterss\n      Grietje")]),t._v(". The larger an ILN gets, the less comprehensive it is visually. Especially when it\n      highlight a mesh topology. For this very reason, the compact version of the visual ILN is of\n      importance for visual aid for validation purposes.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/1  Pieters Grietje (Cluster).jpg",width:"800"}})]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      This is the compact version of a cluster of size 35 potentially representing "),s("strong",[t._v("Pieterss\n      Grietje")]),t._v(". In this examople, 35 nodes are now converted into 4 compact nodes of size 25, 3, 2\n      and two. The last two nodes are of size one. The compact node of size 25 is composed of 294 limks\n      insted of 300. Meaning 6 links are missing.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/2  Pieters Grietje (Cluster-Compact).jpg",width:"800"}})]),s("div",{staticClass:"h3 pt-5"},[t._v("Expanding a Compact Node with Double-Click")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      For a better validation experience, each of the compact nodes can be expanded. This allows a\n      detailed understanding on the type of network (START - LINE - MESH) that defines the aggragated\n      node. When a compact node (sub-cluster) is double-clicked, for example the one of size 3, it is\n      highlighted in red as shown in on the left side the figure below, and its expanded version is\n      ploted, as shown in the right side of the figure.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/3 Meulder Hans (Cluster-Compact Selected).jpg",width:"1000"}})])])])},ds=[],us={},ps=Object(u["a"])(us,cs,ds,!1,null,null,null),hs=ps.exports,ms=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button-info",{attrs:{popup_title:"RECONCILED CLUSTER VISUALIZATION"}},[s("div",{staticClass:"text-left"},[s("div",{staticClass:"h2"},[t._v("Reconciling an ILN")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      We enable the reconciliation of an ILN using relations between discovered ILN. For the current\n      example, the relation used is the marital status meaning married people. In this example, the ILN to\n      reconcile is the one of "),s("strong",[t._v("Meulder Hans")]),t._v(". It is the one in "),s("strong",[t._v("blue")]),t._v(" and it\n      connect to two other clusters using purple dotted lines. Reading the graph, the other two clusters\n      indicate that "),s("strong",[t._v("Meulder Hans")]),t._v(" appears to be connected to two women: **Petsinck\n      Catharina (orange)"),s("strong",[t._v(" and ")]),t._v("Jans Fijtje (green)**.\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      We provide two representation where the first picture presents a compact representation of all\n      clusters while the second representation presents a non compact representation of the investigated\n      cluster: "),s("strong",[t._v("Meulder Hans")]),t._v(".\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      Now, given this additional marital status, is it plausible that all nodes representing "),s("strong",[t._v("Meulder\n      Hans")]),t._v(" are indeed representing the same person?\n    ")]),s("p",{staticClass:"h5 pt-4 pl-5"},[t._v("\n      To answer this questions, we make use of the existence of "),s("strong",[t._v("cycle")]),t._v(" to materialise\n      strong evidence.\n    ")]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/4 Meulder Hans (Cluster-Compact Compact-Evidence).jpg",width:"900"}})]),s("div",{staticClass:"text-center pt-4"},[s("img",{attrs:{src:"/static/images/5 Meulder Hans (Cluster-Compact Evidence).jpg",width:"900"}})]),s("div",{staticClass:"h2 pt-4"},[t._v("Reconciled Nodes")])])])},vs=[],_s={},fs=Object(u["a"])(_s,ms,vs,!1,null,null,null),gs=fs.exports,bs=s("5698");function ys(t,e,s,i){var o,r,a,n=Math.PI,l=20,c=null,d=bs["h"](bs["i"]),u=bs["j"](s),p=bs["j"](i),h=b(u),m=bs["j"]("body").append("div").attr("class","tooltip").style("opacity",0);function v(t){return 16*Math.log2(t+1)}function _(t){return bs["a"]().innerRadius(0).outerRadius(function(t){return t.nodes?.7*v(t.nodes):t.size?0:void 0}).startAngle(0).endAngle(function(t){return t.missing_links?-t.missing_links*n*2:0})}function f(t,e,s){t.selectAll("g").remove();var i=null,a=null,n=t.node().getBoundingClientRect();function c(){i.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),a.attr("cx",function(t){return t.x=Math.max(10,Math.min(n.width-200,t.x))}).attr("cy",function(t){return t.y=Math.max(10,Math.min(n.height-10,t.y))}).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}i=t.append("g").attr("class","links").selectAll("line").data(e.links).enter().append("line").style("stroke-width",function(t){return Math.sqrt(t.value)+1}).style("stroke",function(t){return t.strength<1?"red":t.color?t.color:"black"}).style("stroke-dasharray",function(t){return t.dash?t.dash:"3,"+String(20*(1-t.strength))}).on("mouseover.tooltip",function(t){m.transition().duration(300).style("opacity",.8),m.html(function(){var e="";return t.strength&&(e="&nbsp Strength: "+t.strength+"&nbsp<br>"),t.count&&(e+="&nbsp Links: "+t.count+"&nbsp"),e}).style("left",bs["c"].pageX+"px").style("top",bs["c"].pageY+10+"px")}).on("mouseout.tooltip",function(){m.transition().duration(100).style("opacity",0)}),i.exit().remove(),a=t.append("g").attr("class","nodes").selectAll("g").data(e.nodes).enter().append("g"),a.append("circle").attr("r",function(t){return t.investigated&&"false"===String(t.investigated)?0:t.nodes?v(t.nodes)+2:t.size>5?1.2*t.size:0}).attr("fill","white").style("stroke",function(t){return o&&t===o?"red":r&&t===r?"red":"black"}).style("stroke-width",4).style("stroke-dasharray",function(t){return t.satellite?"10,3":"10,0"}),a.append("circle").attr("r",function(t){return t.nodes?v(t.nodes):t.size?t.size:5}).attr("fill",function(t){return o&&t===o?"red":d(t.group)}).on("dblclick",e=>y(t,e)).style("stroke",function(t){return t.investigated&&"true"===String(t.investigated)?"white":t.nodes?"black":t.size>5?"white":"black"}).style("stroke-width",2).call(bs["b"]().on("start",e=>C(t,e)).on("drag",w).on("end",e=>k(t,e))),a.append("path").attr("d",_(l)).attr("fill","white"),a.append("text").text(function(t){return t.label?t.label:t.id}).attr("x",function(t){return t.nodes?.9*v(t.nodes)+8:t.size?.9*t.size+8:void 0}).attr("y",3),a.append("svg:text").attr("dx",function(t){return t.nodes&&t.nodes>2?-v(t.nodes)/3:-10}).attr("dy",3).text(function(t){if(t.nodes)return"N:"+t.nodes}).style("font-weight","bold"),a.append("svg:text").attr("dx",function(t){if(t.nodes&&t.nodes>2){var e=t.nodes*(t.nodes-1)/2;return t.missing_links>0?"L:"+Math.round(e*(1-t.missing_links))+"/"+e:"L:"+e,-v(t.nodes)/3}}).attr("dy",15).text(function(t){if(t.nodes&&t.nodes>2){var e=t.nodes*(t.nodes-1)/2;return t.missing_links>0?"L:"+Math.round(e*(1-t.missing_links))+"/"+e:"L:"+e}}),a.append("svg:text").attr("dx",-8).attr("dy",function(t){if(t.nodes)return v(t.nodes)+13}).text(function(t){if(t.strength&&t.nodes&&t.nodes>1)return Number.parseFloat(String(t.strength))?"S:"+Math.round(1e3*t.strength)/1e3:"S:"+t.strength}).style("font-weight","bold"),a.append("title").text(function(t){return t.id}),a.exit().remove(),s.nodes(e.nodes).on("tick",c),s.force("link").links(e.links)}function g(e){c=e,Cs(p),t.$on("shown",()=>{a=b(p),f(p,e,a)}),t.show()}function b(t){var e=t.node().getBoundingClientRect();return bs["g"]().force("link",bs["e"]().id(function(t){return t.id}).distance(function(t){return t.dist_factor?v(t.dist_factor[0])+v(t.dist_factor[1])+.8*t.distance:t.distance})).force("charge",bs["f"]()).force("center",bs["d"](e.width/2,e.height/2))}function y(t,s){o=s,s.child?(t===u?f(u,e,h):t===p&&f(p,c,a),g(s.child)):t===u?f(u,e,h):t===p&&f(p,c,a)}function C(t,s){bs["c"].active||(t===u?h.alphaTarget(.2).restart(e):t===p&&a.alphaTarget(.2).restart(c)),s.fx=s.x,s.fy=s.y}function w(t){t.fx=bs["c"].x,t.fy=bs["c"].y}function k(t,e){bs["c"].active||(t===u?h.alphaTarget(0):t===p&&a.alphaTarget(0))}f(u,e,h)}function Cs(t){t="string"===typeof t?bs["j"](t):t,t.selectAll("*").remove()}var ws={name:"ClusterVisualization",components:{SubCard:bt,ClusterVisualizationInfo:ls,ClusterVisualizationCompactInfo:hs,ClusterVisualizationReconciledInfo:gs},data(){return{clusterGraph:null,clusterGraphCompact:null,reconciliationGraph:null}},props:{show:String,properties:Array,clusterData:Object,clusterId:String,clusteringId:String,association:String},computed:{label(){switch(this.show){case"visualize-compact":return"Visualization of Compact Cluster";case"visualize-reconciled":return"Visualization of Reconciled Cluster";case"visualize":default:return"Visualization of Cluster"}}},methods:{draw(t){Cs("svg#graph-cluster"),ys(this.$refs.visualizationPopup,t,"svg#graph-cluster","svg#graph-cluster-popup")},async getGraphData(t){Cs("svg#graph-cluster");const e=this.properties.map(t=>{const e=this.$root.getResourceById(t[0]);return{dataset:e.dataset_id,entity_type:e.collection_id,property:t[1]}}),s=await this.$root.getClusterGraphs(this.clusteringId,this.clusterId,{cluster_data:this.clusterData,properties:e,get_cluster:!Boolean(this.association)||"cluster"===t,get_reconciliation:"yes"===this.clusterData.extended,associations:"yes"===this.clusterData.extended?this.association:""});this.clusterGraph=s.cluster_graph,this.clusterGraphCompact=s.cluster_graph_compact,this.reconciliationGraph=s.reconciliation_graph,this.drawShown()},drawShown(){switch(this.show){case"visualize-compact":this.clusterGraphCompact&&this.draw(this.clusterGraphCompact);break;case"visualize-reconciled":this.reconciliationGraph&&this.draw(this.reconciliationGraphDrawn);break;case"visualize":default:this.clusterGraph&&this.draw(this.clusterGraph)}}},mounted(){this.clusterId&&this.getGraphData()},watch:{clusterId(){this.getGraphData()},show(){this.drawShown()}}},ks=ws,xs=(s("bc3e"),Object(u["a"])(ks,ss,is,!1,null,"0d07b602",null)),$s=xs.exports,Is={name:"MatchValidation",components:{VirtualList:be.a,Card:ht,SubCard:bt,MatchInfo:Le,Properties:Be,MatchLink:Ye,Clustering:es,ClusterVisualization:$s},data(){return{show:!1,showInfo:!1,showPropertySelection:!1,showAllLinks:!1,showClusters:!1,loading:!1,links:[],linkItem:Ye,clusters:{},clusterItem:es,clusterIdSelected:null,clusterView:"",association:"",properties:{},associationFiles:[],linkStates:{}}},props:{match:Object},computed:{clusterIds(){return Object.keys(this.clusters)},hasProperties(){return!this.match.properties.map(t=>""!==t[1]).includes(!1)},alignment(){return this.$root.alignments.find(t=>t.alignment===this.match.id)},clustering(){return this.$root.clusterings.find(t=>t.alignment===this.match.id)},clusteringRunning(){return this.clustering&&"Finished"!==this.clustering.status&&!this.clustering.status.startsWith("FAILED")},showLinks(){return this.showAllLinks||this.showClusterLinks},showClusterLinks(){return this.showClusters&&this.clusterIdSelected&&"links"===this.clusterView},selectedCluster(){return this.clusterIdSelected?this.clusters[this.clusterIdSelected]:null},clusterLinks(){return this.selectedCluster?this.selectedCluster.links.map(t=>{const e=t[0].substring(1,t[0].length-1),s=t[1].substring(1,t[1].length-1),i=this.getLinkHash(e,s),o=this.selectedCluster.strengths.hasOwnProperty(i)?this.selectedCluster.strengths[i][0]:"0";return[e,s,o]}):[]}},methods:{updateShow(t){const e=this.showInfo||this.showPropertySelection||this.showAllLinks||this.showClusters;"open"!==t||e?"close"===t&&e&&(this.showInfo=!1,this.showPropertySelection=!1,this.showAllLinks=!1,this.showClusters=!1):this.showInfo=!0,this.show!==e&&(this.show=e),"links"===t&&this.showClusters?this.showClusters=!1:"clusters"===t&&this.showAllLinks&&(this.showAllLinks=!1),(this.showAllLinks||this.showClusters)&&this.getLinksOrClusters()},async saveProperties(){await this.$root.submit(),await this.getLinksOrClusters(!0)},async runClustering(){const t=""!==this.association?this.association:null;await this.$root.runClustering(this.match.id,t),this.$emit("refresh")},async getLinksOrClusters(t=!1){if(!this.loading){if(this.showClusters&&this.clustering&&"Finished"===this.clustering.status&&0===Object.keys(this.clusters).length?(this.loading=!0,this.links=[],await this.getClusters()):this.showClusters&&this.clustering&&this.clusteringRunning||0!==this.links.length||(this.loading=!0,this.clusters={},await this.getLinks()),this.hasProperties&&(t||0===Object.keys(this.properties).length)){this.loading=!0;const t=this.$root.getTargetsForMatch(this.match.id);this.properties=await this.$root.getPropertiesForAlignment(this.match.id,t)}this.loading=!1}},async getLinks(){this.links=await this.$root.getAlignment(this.match.id)},async getClusters(){this.clustering&&"Finished"===this.clustering.status&&(this.clusters=await this.$root.getClusters(this.clustering.clustering_id,this.association))},getClusterItemProps(t){const e=this.clusterIds[t];return{props:{clusterId:e,clusterData:this.clusters[e],properties:this.properties,selected:this.clusterIdSelected===e,isFirst:0===t},on:{"select:clusterId":t=>this.clusterIdSelected=t}}},getLinkItemProps(t){const e=this.showAllLinks?this.links[t]:this.clusterLinks[t];return{props:{index:t,state:this.linkStates[this.getLinkHash(e[0],e[1])],source:e[0],sourceValues:this.properties[e[0]]||[],target:e[1],targetValues:this.properties[e[1]]||[],strength:parseFloat(e[2]).toFixed(3),isFirst:0===t},on:{accepted:()=>this.acceptLink(e[0],e[1]),declined:()=>this.declineLink(e[0],e[1])}}},getLinkHash(t,e){const s=t<e?`('<${t}>', '<${e}>')`:`('<${e}>', '<${t}>')`,i=this.$utilities.md5(s).substring(0,15);return`key_H${i}`},acceptLink(t,e){this.$set(this.linkStates,this.getLinkHash(t,e),"accepted")},declineLink(t,e){this.$set(this.linkStates,this.getLinkHash(t,e),"declined")},resetProperty(t,e,s){const i=e.slice(0,s);i.push(""),i.length%2>0&&i.push(""),this.$set(this.match.properties,t,i)}},async mounted(){this.associationFiles=await this.$root.getAssociationFiles()}},Ss=Is,js=(s("a2ad"),Object(u["a"])(Ss,_e,fe,!1,null,null,null)),As=js.exports,Ps=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row align-items-center justify-content-between"},[s("div",{staticClass:"col-auto"},[s("h2",[t._v(t._s(t.title))])]),t._t("header")],2),t._t("default"),s("b-alert",{staticClass:"mt-4 mb-0",attrs:{show:t.is_saved&&""!==t.tab_error,variant:"warning"}},[t._v("\n    Successfully saved, but with errors:\n    "+t._s(t.tab_error)+"\n  ")]),s("b-alert",{staticClass:"mt-4 mb-0",attrs:{show:!t.is_saved&&""!==t.tab_error,variant:"danger"}},[t._v("\n    "+t._s(t.tab_error)+"\n  ")])],2)},Os=[],Ms={name:"TabContentStructure",props:{title:String,tab_error:String,is_saved:Boolean}},Rs=Ms,Es=Object(u["a"])(Rs,Ps,Os,!1,null,null,null),Ts=Es.exports,Ns={name:"App",mixins:[G],components:{TabContentStructure:Ts,Idea:rt,Resource:Tt,Match:ve,MatchValidation:As},data(){return{tab_error:"",idea_form:"",id_to_load:"",job_id:"",job_title:"",job_description:"",is_saved:!0,is_updating:!1,steps:["idea","collections","alignments","validation","export"]}},computed:{hasChanges(){return!Boolean(this.$root.job)||JSON.stringify(this.$root.resources)!==JSON.stringify(this.$root.job["resources_form_data"])||JSON.stringify(this.$root.matches)!==JSON.stringify(this.$root.job["mappings_form_data"])}},methods:{isTabValid(t,e,s){return this.tab_error=t?"":s,this.is_saved=e,!!t},validateIdeaTab(){return this.isTabValid(this.$root.job,!1,"Please update or create your idea first!")},validateCollectionsTab(t=!1){const e=this.$refs.resourceComponents.map(t=>t.validateResource()),s=e.includes(!1)?this.isTabValid(!1,t,"One or more resources contain errors!"):this.isTabValid(this.$root.resources.length>0,!1,"Please add at least one resource!");return(s||t)&&this.submit(),s},validateAlignmentsTab(t=!1){const e=this.$refs.matchComponents.map(t=>t.validateMatch()),s=e.includes(!1)?this.isTabValid(!1,t,"One or more alignments contain errors!"):this.isTabValid(this.$root.matches.length>0,!1,"Please add at least one alignment!");return(s||t)&&this.submit(),s},validateAndSave(t){switch(t){case 1:return this.validateCollectionsTab(!0);case 2:return this.validateAlignmentsTab(!0);default:return!1}},activateStep(t,e=!1){const s=this.steps.indexOf(t);if(s<0||"undefined"===typeof this.$refs.formWizard.tabs[s])return!1;for(let i=0;i<=s;i++)this.$set(this.$refs.formWizard.tabs[i],"checked",!0);this.$set(this.$refs.formWizard,"maxStep",s),e&&this.$refs.formWizard.changeTab(this.$refs.formWizard.activeTabIndex,s)},addResource(t){t&&t.target.blur(),this.$root.addResource()},addMatch(t){t&&t.target.blur(),this.$root.addMatch()},duplicateMatch(t){this.$root.duplicateMatch(t)},async createJob(t){const e=await this.$root.createJob(t);this.setJobId(e)},async updateJob(t){this.is_updating=!0,await this.$root.updateJob(t),await this.getJobData(),this.is_updating=!1},async setJobId(t){this.$set(this,"job_id",t);let e=new URL(window.location.href);e.searchParams.set("job_id",t),window.history.pushState(null,null,e.href),await this.getJobData()},async submit(){await this.$root.submit(),await this.getJobData()},async getJobData(){""!==this.job_id&&(await this.$root.loadJob(this.job_id),this.$root.job&&(this.job_title=this.$root.job.job_title,this.job_description=this.$root.job.job_description,this.activateStep("collections"),0===this.$root.resources.length&&this.$root.addResource(),0===this.$root.matches.length?this.$root.addMatch():this.activateStep("alignments"),this.refreshAlignments(),this.refreshClusterings()))},async refreshAlignments(t=!1){t&&await this.$root.loadAlignments();let e=!1,s=!1;this.$root.alignments.forEach(t=>{"Finished"===t.status?e=!0:t.status.startsWith("FAILED")||(s=!0)}),e&&(this.activateStep("validation"),this.activateStep("export")),s&&setTimeout(()=>this.$root.loadAlignments().then(()=>this.refreshAlignments()),5e3)},async refreshClusterings(t=!1){t&&await this.$root.loadClusterings();let e=!1;this.$root.clusterings.forEach(t=>{"Finished"===t.status||t.status.startsWith("FAILED")||(e=!0)}),e&&setTimeout(()=>this.$root.loadClusterings().then(()=>this.refreshClusterings()),5e3)}},async mounted(){await this.$root.loadDatasets();const t=new URLSearchParams(window.location.search),e=t.get("job_id");e&&(this.job_id=e,this.idea_form="existing",this.getJobData())}},Ls=Ns,Fs=Object(u["a"])(Ls,K,Q,!1,null,null,null),zs=Fs.exports,Vs=s("369b"),Gs=s.n(Vs),Ds={data(){return{job:null,alignments:[],clusterings:[],resources:[],matches:[],datasets:null}},methods:{addResource(){this.resources.push({dataset_id:"",collection_id:"",id:Us(this.resources),filter:{type:"AND",conditions:[]},limit:-1,related:[],related_array:!1})},addMatch(){this.matches.push({id:Us(this.matches),is_association:!1,label:"Alignment "+(this.matches.length+1),sources:[],targets:[],properties:[],type:"AND",conditions:[]})},duplicateMatch(t){const e=Bs(t);this.matches.push({...e,id:Us(this.matches),label:"Alignment "+(this.matches.length+1)})},getResourceById(t,e=this.resources){return e.find(e=>Js(t)&&e.id===parseInt(t)||e.label===t)},getResourceByDatasetId(t,e=this.resources){return e.find(e=>e.dataset_id===t)},getMatchById(t,e=this.matches){return e.find(e=>Js(t)&&e.id===parseInt(t)||e.label===t)},getTargetsForMatch(t){const e=this.getMatchById(t);return e.properties.reduce((t,e)=>{const s=this.getResourceById(e[0]);let i=t.find(t=>t.graph===s.dataset_id);i||(i={graph:s.dataset_id,data:[]},t.push(i));let o=i.data.find(t=>t.entity_type===s.collection_id);return o||(o={entity_type:s.collection_id,properties:[]},i.data.push(o)),o.properties.push(e[1]),t},[])},createReferencesForProperty(t,e){const s=this.getResourceById(t[0],e);if(t[0]=s.label,t.length<3)return t;if("__value__"===t[2])return t.slice(0,2);const i={label:this.$utilities.md5(t[0]+t[1]+t[2]),collection_id:t[2],dataset_id:s.dataset_id,related:[]};e.find(t=>t.label===i.label)||e.push(i);const o={resource:i.label,local_property:t[1],remote_property:"uri"};s.related.find(t=>JSON.stringify(t)===JSON.stringify(o))||s.related.push(o),s.related.length>1&&(s.related_array=!0);const r=[i.label,t[3],...t.slice(4)];return this.createReferencesForProperty(r,e)},async submit(){const t=Bs(this.resources),e=Bs(this.matches);e.forEach(e=>{["sources","targets"].forEach(t=>{e[t].forEach((s,i)=>{Js(s)&&(e[t][i]=this.getResourceById(s).label)})}),Hs(e.conditions).forEach(e=>{["sources","targets"].forEach(s=>{Object.keys(e[s]).forEach(i=>{e[s][i].forEach((o,r)=>{e[s][i][r].property=this.createReferencesForProperty(o.property,t)}),e[s][this.getResourceById(i).label]=e[s][i],delete e[s][i]})})}),delete e.properties}),t.forEach(e=>{e.filter&&e.filter.conditions&&e.filter.conditions.length>0?Hs(e.filter.conditions).forEach(e=>{e.property=this.createReferencesForProperty(e.property,t)}):delete e.filter}),t.forEach(t=>{t.related&&(t.related.forEach(t=>{Js(t.resource)&&(t.resource=this.getResourceById(t.resource).label),t.local_property=[t.local_property],t.remote_property=[t.remote_property]}),t.related_array&&(t.related=[t.related])),delete t.related_array,delete t.id}),await this.updateJob({job_id:this.job.job_id,job_title:this.job.job_title,job_description:this.job.job_description,resources:t,matches:e,resources_original:this.resources,matches_original:this.matches})},async loadJob(t){this.job=await Ws("/job/"+t),this.job.resources_form_data&&(this.resources=Bs(this.job.resources_form_data)),this.job.mappings_form_data&&(this.matches=Bs(this.job.mappings_form_data)),await Promise.all([this.loadAlignments(),this.loadClusterings()])},async loadAlignments(){this.alignments=await Ws(`/job/${this.job.job_id}/alignments`)},async loadClusterings(){this.clusterings=await Ws(`/job/${this.job.job_id}/clusterings`)},async createJob(t){const e=await Ws("/job/create/",t);return e.job_id},async updateJob(t){await Ws("/job/update/",t)},async runAlignment(t,e){return await this.submit(),Ws(`/job/${this.job.job_id}/run_alignment/${t}`,{restart:e})},async getAlignment(t){return qs(`/job/${this.job.job_id}/alignment/${t}`)},async getPropertiesForAlignment(t,e){return Ws(`/job/${this.job.job_id}/alignment/${t}/properties`,{targets:e})},async getClusters(t,e){return Ws(`/job/${this.job.job_id}/clusters/${t}?association=${e}`)},async runClustering(t,e){return Ws(`/job/${this.job.job_id}/run_clustering/${t}`,{association_file:e})},async getClusterGraphs(t,e,s){return Ws(`/job/${this.job.job_id}/cluster/${t}/${e}/graph`,s)},async getAssociationFiles(){return Ws("/association_files")},async loadDatasets(){if(this.datasets)return;const t=await Ws("/datasets");Object.keys(t).forEach(e=>{const s=t[e];Object.keys(s.collections).forEach(t=>{const e=s.collections[t];Object.keys(e).forEach(t=>{const i=e[t];if(i.hasOwnProperty("referencedCollections")){const t=i.referencedCollections;i.referencedCollections={},t.filter(t=>"tim_unknown"!==t).forEach(t=>i.referencedCollections[t]=s.collections[t])}})})}),this.datasets=t}}};function Bs(t){return JSON.parse(JSON.stringify(t))}function Js(t){return Number.isInteger(t)||/^\d+$/.test(t)}function Us(t){let e=-1;return t.forEach(t=>{t.id>e&&(e=t.id)}),e+1}function Hs(t){let e;return Array.isArray(t)?e=t:Array.isArray(t.conditions)&&(e=t.conditions),e?e.reduce((t,e)=>t.concat(Hs(e)),[]):[t]}async function Ws(t,e){if(e){const s=await fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)});return s.json()}const s=await fetch(t);return s.json()}function qs(t){return new Promise((e,s)=>{Gs.a.parse(t,{download:!0,fastMode:!0,skipEmptyLines:!0,delimiter:",",complete:t=>e(t.data),error:t=>s(t)})})}s("a89b"),s("da93");i["default"].use(o["a"]),i["default"].use(a.a),i["default"].component("button-add",h),i["default"].component("button-delete",b),i["default"].component("button-info",I),i["default"].component("v-select",M),i["default"].component("loading",F),i["default"].component("property",U),i["default"].component("fa-icon",H["a"]),W["c"].add(q["b"],q["a"],Y["d"],Y["b"],Y["i"],Y["l"],Y["h"],Y["c"],Y["k"],Y["f"],Y["a"],Y["j"],Y["g"],Y["e"]),i["default"].prototype.$utilities={md5:Z.a,getOrCreate(t,e,s,i){return"undefined"===typeof e[s]&&t(e,s,i),e[s]}},i["default"].filter("capitalize",function(t){return t?(t=t.toString(),t.charAt(0).toUpperCase()+t.slice(1)):""}),new i["default"]({mixins:[Ds],render:t=>t(zs)}).$mount("#app")},"7bc4":function(t,e,s){"use strict";var i=s("f306"),o=s.n(i);o.a},8199:function(t,e,s){},"8a48":function(t,e,s){},"9dce":function(t,e,s){},a2ad:function(t,e,s){"use strict";var i=s("8199"),o=s.n(i);o.a},a89b:function(t,e,s){},a917:function(t,e,s){},a989:function(t,e,s){"use strict";var i=s("8a48"),o=s.n(i);o.a},b5ab:function(t,e,s){},bc3e:function(t,e,s){"use strict";var i=s("9dce"),o=s.n(i);o.a},bd33:function(t,e,s){},d90f:function(t,e,s){"use strict";var i=s("b5ab"),o=s.n(i);o.a},f306:function(t,e,s){}});
//# sourceMappingURL=app.9f1e11fe.js.map